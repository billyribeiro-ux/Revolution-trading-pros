# Windsurf AI Rules - Revolution Trading Pros v2
## Apple Principal Engineer ICT Level 7 Standards | January 2026

---

# ğŸš¨ ABSOLUTE PRIME DIRECTIVE: ZERO ERRORS TOLERANCE

## â›” STOP - READ THIS FIRST BEFORE ANY ACTION

**Every single change MUST result in ZERO errors, ZERO warnings, and ZERO regressions.**

This is not a suggestion. This is an absolute requirement. If you cannot guarantee a change is 100% error-free with evidence, DO NOT make the change.

---

## ğŸ”’ MANDATORY VERIFICATION PROTOCOL

### BEFORE Making ANY Change:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRE-CHANGE VERIFICATION CHECKLIST (ALL REQUIRED)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ 1. READ the ENTIRE file being modified (not just the area)  â”‚
â”‚  â–¡ 2. TRACE every import - where does it come from?            â”‚
â”‚  â–¡ 3. TRACE every export - what files depend on this?          â”‚
â”‚  â–¡ 4. IDENTIFY all type definitions involved                   â”‚
â”‚  â–¡ 5. MAP the component/function hierarchy                     â”‚
â”‚  â–¡ 6. CHECK for existing tests that might break                â”‚
â”‚  â–¡ 7. VERIFY current state: `pnpm run check` passes            â”‚
â”‚  â–¡ 8. DOCUMENT what you're changing and WHY                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DURING Every Change:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CHANGE EXECUTION RULES (MANDATORY)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ Change ONE thing at a time - never batch unrelated changes  â”‚
â”‚  â–¡ Keep all existing imports unless explicitly removing        â”‚
â”‚  â–¡ Preserve all type annotations - never weaken types          â”‚
â”‚  â–¡ Maintain backward compatibility of exports                  â”‚
â”‚  â–¡ Update ALL files that import/use the changed code           â”‚
â”‚  â–¡ Update ALL related type definitions                         â”‚
â”‚  â–¡ Update ALL related tests                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AFTER Every Change:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST-CHANGE VERIFICATION (ALL MUST PASS)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ Run: pnpm run check        â†’ MUST show 0 errors             â”‚
â”‚  â–¡ Run: pnpm run lint         â†’ MUST show 0 errors, 0 warnings â”‚
â”‚  â–¡ Run: pnpm run build        â†’ MUST complete successfully     â”‚
â”‚  â–¡ Run: pnpm run test         â†’ ALL tests MUST pass            â”‚
â”‚  â–¡ Verify: No new TypeScript errors in ANY file                â”‚
â”‚  â–¡ Verify: No new ESLint warnings in ANY file                  â”‚
â”‚  â–¡ Verify: No console errors in browser                        â”‚
â”‚  â–¡ Verify: No hydration mismatches                             â”‚
â”‚  â–¡ Verify: No runtime errors                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ CRITICAL: DEPENDENCY TRACING PROTOCOL

**Before modifying ANY file, you MUST create a dependency map:**

```typescript
// EXAMPLE: Before modifying Button.svelte

/* 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * DEPENDENCY MAP FOR: src/lib/components/ui/Button.svelte
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * 
 * THIS FILE IMPORTS FROM:
 * â”œâ”€â”€ svelte (Snippet type)
 * â”œâ”€â”€ $lib/types/components.ts (ButtonVariant, ButtonSize)
 * â””â”€â”€ $lib/utils/cn.ts (cn function)
 * 
 * THIS FILE IS IMPORTED BY:
 * â”œâ”€â”€ src/lib/components/ui/index.ts (re-export)
 * â”œâ”€â”€ src/routes/+page.svelte
 * â”œâ”€â”€ src/routes/dashboard/+page.svelte
 * â”œâ”€â”€ src/routes/auth/login/+page.svelte
 * â”œâ”€â”€ src/lib/components/forms/LoginForm.svelte
 * â”œâ”€â”€ src/lib/components/forms/SignupForm.svelte
 * â””â”€â”€ 14 other files...
 * 
 * TYPES AFFECTED:
 * â”œâ”€â”€ ButtonProps (this file)
 * â””â”€â”€ ComponentProps (src/lib/types/components.ts)
 * 
 * TESTS THAT COVER THIS:
 * â”œâ”€â”€ src/lib/components/ui/Button.test.ts
 * â””â”€â”€ src/tests/e2e/auth.spec.ts
 * 
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */
```

**If you cannot produce this map, you don't understand the file well enough to modify it.**

---

## ğŸ”´ CRITICAL: RIPPLE EFFECT PREVENTION

When you change a file, you MUST update ALL affected files:

### Scenario: Changing a Component's Props

```
CHANGE: Adding required prop `variant` to Button.svelte

RIPPLE EFFECT - ALL THESE MUST BE UPDATED:
â”œâ”€â”€ Button.svelte          â† Add the prop
â”œâ”€â”€ Button.test.ts         â† Update test fixtures
â”œâ”€â”€ index.ts               â† Verify re-export still works
â”œâ”€â”€ +page.svelte (x14)     â† Add variant prop to all usages
â”œâ”€â”€ LoginForm.svelte       â† Add variant prop
â”œâ”€â”€ SignupForm.svelte      â† Add variant prop
â””â”€â”€ types/components.ts    â† Update ButtonProps type
```

### Scenario: Changing a Type Definition

```
CHANGE: Modifying User type in types/auth.ts

RIPPLE EFFECT - ALL THESE MUST BE UPDATED:
â”œâ”€â”€ types/auth.ts          â† Modify the type
â”œâ”€â”€ stores/user.svelte.ts  â† Update store usage
â”œâ”€â”€ hooks.server.ts        â† Update locals.user
â”œâ”€â”€ +layout.server.ts      â† Update load function
â”œâ”€â”€ api/auth/+server.ts    â† Update response types
â”œâ”€â”€ UserAvatar.svelte      â† Update prop types
â”œâ”€â”€ UserMenu.svelte        â† Update prop types
â””â”€â”€ ALL tests using User   â† Update test fixtures
```

### Scenario: Changing a Utility Function

```
CHANGE: Modifying formatCurrency() in utils/format.ts

RIPPLE EFFECT - ALL THESE MUST BE UPDATED:
â”œâ”€â”€ utils/format.ts        â† Modify function
â”œâ”€â”€ utils/format.test.ts   â† Update tests
â”œâ”€â”€ PriceDisplay.svelte    â† Verify usage
â”œâ”€â”€ TradeCard.svelte       â† Verify usage
â”œâ”€â”€ Portfolio.svelte       â† Verify usage
â””â”€â”€ ALL files importing formatCurrency
```

---

## ğŸ”´ CRITICAL: TYPE SAFETY ENFORCEMENT

### NEVER DO THIS:

```typescript
// âŒ BANNED - Using 'any'
let data: any = fetchData();

// âŒ BANNED - Using 'as' to force types
const user = data as User;

// âŒ BANNED - Non-null assertion without proof
const name = user!.name;

// âŒ BANNED - Ignoring TypeScript errors
// @ts-ignore
// @ts-expect-error

// âŒ BANNED - Optional chaining without handling undefined
const value = obj?.prop?.nested; // What if it's undefined?
```

### ALWAYS DO THIS:

```typescript
// âœ… CORRECT - Explicit types
let data: ApiResponse<User> = await fetchData();

// âœ… CORRECT - Type guards
function isUser(data: unknown): data is User {
  return typeof data === 'object' && data !== null && 'id' in data;
}

if (isUser(data)) {
  const user = data; // TypeScript knows this is User
}

// âœ… CORRECT - Exhaustive checks
function handleStatus(status: 'pending' | 'success' | 'error'): string {
  switch (status) {
    case 'pending': return 'Loading...';
    case 'success': return 'Done!';
    case 'error': return 'Failed';
    default: {
      const _exhaustive: never = status;
      throw new Error(`Unhandled status: ${_exhaustive}`);
    }
  }
}

// âœ… CORRECT - Proper null handling
const value = obj?.prop?.nested ?? defaultValue;
if (value === undefined) {
  throw new Error('Expected value to be defined');
}
```

---

## ğŸ”´ CRITICAL: IMPORT/EXPORT INTEGRITY

### Before Removing ANY Import:

1. Search the ENTIRE file for usage
2. Check if it's re-exported
3. Check if it's used in types
4. Check if it's used in comments/docs

### Before Changing ANY Export:

1. Find ALL files that import it
2. Check for dynamic imports
3. Check for re-exports in index files
4. Update ALL consumers

### Import Statement Rules:

```typescript
// âœ… CORRECT - Explicit named imports
import { Button, Card, Modal } from '$lib/components/ui';
import type { User, Session } from '$lib/types';

// âœ… CORRECT - Type-only imports
import type { PageData } from './$types';

// âŒ BANNED - Wildcard imports (hides dependencies)
import * as Components from '$lib/components';

// âŒ BANNED - Unnamed default imports
import something from './module';
```

---

## ğŸ”´ CRITICAL: FILE CREATION RULES

### Before Creating a NEW File:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NEW FILE CHECKLIST                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ Does this file need to exist? Can existing file be used?    â”‚
â”‚  â–¡ Is the file in the correct directory?                       â”‚
â”‚  â–¡ Does the filename follow project conventions?               â”‚
â”‚  â–¡ Have you added it to the appropriate index.ts?              â”‚
â”‚  â–¡ Have you created the corresponding test file?               â”‚
â”‚  â–¡ Have you created the corresponding types?                   â”‚
â”‚  â–¡ Have you updated any barrel exports?                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After Creating a NEW File:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST-CREATION VERIFICATION                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–¡ File compiles without errors                                â”‚
â”‚  â–¡ File is properly exported from index                        â”‚
â”‚  â–¡ Types are properly exported                                 â”‚
â”‚  â–¡ Tests are created and passing                               â”‚
â”‚  â–¡ No circular dependencies introduced                         â”‚
â”‚  â–¡ pnpm run check still passes                                 â”‚
â”‚  â–¡ pnpm run build still passes                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”´ CRITICAL: ERROR RECOVERY PROTOCOL

### If You Introduce an Error:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERROR RECOVERY STEPS                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. STOP immediately - do not make more changes                â”‚
â”‚  2. READ the full error message carefully                      â”‚
â”‚  3. TRACE the error to its source                              â”‚
â”‚  4. UNDERSTAND why the error occurred                          â”‚
â”‚  5. FIX the root cause, not the symptom                        â”‚
â”‚  6. VERIFY the fix doesn't introduce new errors                â”‚
â”‚  7. RUN full verification suite again                          â”‚
â”‚  8. DOCUMENT what caused the error for future reference        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Common Error Patterns to AVOID:

```typescript
// âŒ ERROR: Fixing type error by weakening types
// Before: Property 'x' does not exist on type 'Y'
// BAD FIX: (obj as any).x

// âœ… CORRECT: Add proper type definition or type guard

// âŒ ERROR: Fixing import error by removing usage
// Before: Cannot find module 'X'
// BAD FIX: Just delete the import and usage

// âœ… CORRECT: Install package, fix path, or create module

// âŒ ERROR: Fixing undefined error with optional chaining everywhere
// Before: Cannot read property 'x' of undefined
// BAD FIX: obj?.x?.y?.z?.whatever

// âœ… CORRECT: Ensure data is loaded before accessing, add proper guards
```

---

## ğŸ¯ PRIME DIRECTIVE (EXPANDED)

**Before ANY code modification, you MUST:**

1. **READ and UNDERSTAND** the entire file being modified - not just the function, the WHOLE file
2. **TRACE all imports** - open each imported file and understand what it provides
3. **TRACE all exports** - find every file that imports from this file
4. **IDENTIFY all type definitions** - follow the type chain to its source
5. **MAP the component/function hierarchy** - understand the call stack
6. **MAP state flow** - where does data come from? Where does it go? What transforms it?
7. **CHECK for related files** - tests, types, stores, utilities
8. **CHECK for side effects** - does this code trigger other code?
9. **UNDERSTAND the business logic** - what is this feature trying to accomplish?
10. **VERIFY current state** - run `pnpm run check` BEFORE making changes
11. **CREATE a rollback plan** - know how to undo your changes

**NEVER make changes without full context. Ask if unclear.**

**NEVER proceed if `pnpm run check` shows errors BEFORE your changes - fix those first.**

---

## ğŸ“¦ Technology Stack Reference

### Frontend
- **Framework:** SvelteKit 2.50.1 + Svelte 5.48.2
- **Styling:** Tailwind CSS v4.1.18 (NEW SYNTAX)
- **Build:** Vite 7.3.1
- **Testing:** Playwright 1.58.0 + Vitest 4.0.18
- **Deployment:** Cloudflare Pages
- **Charts:** Lightweight Charts, D3.js
- **3D:** Three.js + Threlte
- **Validation:** Zod v4
- **Animation:** GSAP 3.14.2, Lottie, Vivus

### Backend
- **Language:** Rust 2021 Edition
- **Framework:** Axum 0.7 + Tower
- **Runtime:** Tokio 1.35
- **Database:** PostgreSQL (SQLx 0.8)
- **Cache:** Redis/Upstash
- **Storage:** Cloudflare R2
- **Search:** Meilisearch 0.26
- **Auth:** JWT + Argon2

---

## ğŸ”¥ SVELTE 5 MANDATORY PATTERNS (January 2026)

### Runes - ALWAYS USE THESE

```svelte
<script lang="ts">
  // âœ… CORRECT - Svelte 5 Runes
  let count = $state(0);
  let doubled = $derived(count * 2);
  let items = $state<Item[]>([]);
  
  // âœ… CORRECT - Props with defaults
  let { 
    title, 
    onClose, 
    variant = 'primary' 
  }: { 
    title: string; 
    onClose: () => void; 
    variant?: 'primary' | 'secondary';
  } = $props();
  
  // âœ… CORRECT - Bindable props
  let { value = $bindable() }: { value: string } = $props();
  
  // âœ… CORRECT - Effects
  $effect(() => {
    console.log('Count changed:', count);
    // Cleanup function
    return () => {
      console.log('Cleanup');
    };
  });
  
  // âœ… CORRECT - Untracked reads
  $effect(() => {
    const currentCount = $state.snapshot(items);
    // Use snapshot for non-reactive reads
  });
  
  // âŒ NEVER USE - Svelte 4 Legacy
  // export let prop;        // BANNED
  // $: derived = x * 2;     // BANNED
  // let:item                // BANNED
  // <slot />                // BANNED
</script>
```

### Snippets Replace Slots - MANDATORY

```svelte
<!-- âœ… CORRECT - Svelte 5 Snippets -->
<script lang="ts">
  import type { Snippet } from 'svelte';
  
  let { 
    children,
    header,
    footer 
  }: { 
    children: Snippet;
    header?: Snippet;
    footer?: Snippet<[{ count: number }]>;
  } = $props();
</script>

{#if header}
  {@render header()}
{/if}

{@render children()}

{#if footer}
  {@render footer({ count: 42 })}
{/if}

<!-- Usage -->
<MyComponent>
  {#snippet header()}
    <h1>Title</h1>
  {/snippet}
  
  <p>Main content (children)</p>
  
  {#snippet footer(data)}
    <span>Count: {data.count}</span>
  {/snippet}
</MyComponent>

<!-- âŒ NEVER USE -->
<!-- <slot />                    BANNED -->
<!-- <slot name="header" />      BANNED -->
<!-- let:item                    BANNED -->
```

### Event Handlers - Svelte 5 Style

```svelte
<!-- âœ… CORRECT - Svelte 5 -->
<button onclick={handleClick}>Click</button>
<input oninput={(e) => value = e.currentTarget.value} />
<form onsubmit={handleSubmit}>

<!-- âŒ NEVER USE - Svelte 4 -->
<!-- on:click={handler}     BANNED -->
<!-- on:input={handler}     BANNED -->
<!-- on:submit|preventDefault  BANNED -->
```

### Component Events - Callback Props

```svelte
<!-- âœ… CORRECT - Svelte 5 callback props -->
<script lang="ts">
  let { 
    onSelect,
    onChange,
    onClose 
  }: { 
    onSelect?: (item: Item) => void;
    onChange?: (value: string) => void;
    onClose?: () => void;
  } = $props();
  
  function handleSelect(item: Item) {
    onSelect?.(item);
  }
</script>

<!-- âŒ NEVER USE createEventDispatcher -->
<!-- import { createEventDispatcher } from 'svelte';  BANNED -->
<!-- dispatch('select', item);                         BANNED -->
```

### Stores in Svelte 5

```svelte
<script lang="ts">
  import { userStore } from '$lib/stores/user.svelte';
  
  // âœ… CORRECT - Direct access (stores are reactive by default)
  // userStore.value is reactive
  
  // For writable stores in .svelte.ts files:
  // export const count = $state(0);
</script>

<!-- âŒ NEVER USE $ prefix for store subscription -->
<!-- {$userStore}  - Only use if absolutely necessary -->
```

---

## ğŸ¨ TAILWIND CSS v4.1.18 - NEW SYNTAX (January 2026)

### Configuration - CSS-First Approach

```css
/* app.css - Tailwind v4 configuration */
@import "tailwindcss";

/* Theme customization */
@theme {
  /* Colors */
  --color-brand-primary: #3b82f6;
  --color-brand-secondary: #10b981;
  --color-surface-dark: #0f0f0f;
  --color-surface-card: #1a1a1a;
  --color-surface-elevated: #262626;
  
  /* Typography */
  --font-sans: 'Inter', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  
  /* Spacing */
  --spacing-container: clamp(1rem, 5vw, 3rem);
  
  /* Animations */
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
  --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
  
  /* Shadows */
  --shadow-card: 0 4px 6px -1px rgb(0 0 0 / 0.3);
  --shadow-elevated: 0 20px 25px -5px rgb(0 0 0 / 0.4);
}

/* Dark mode variants */
@variant dark (&:where(.dark, .dark *));

/* Custom utilities */
@utility scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
  &::-webkit-scrollbar {
    display: none;
  }
}

@utility text-balance {
  text-wrap: balance;
}

/* Container queries */
@utility container-sm {
  container-type: inline-size;
  container-name: card;
}
```

### Usage in Components

```svelte
<!-- âœ… CORRECT - Tailwind v4 -->
<div class="
  bg-surface-card 
  text-white/90
  rounded-2xl 
  p-6
  shadow-card
  hover:shadow-elevated
  transition-shadow
  duration-300
  ease-smooth
">
  <h2 class="text-xl font-semibold text-balance">Title</h2>
</div>

<!-- Container queries -->
<div class="container-sm">
  <div class="@sm:flex @md:grid @md:grid-cols-2">
    <!-- Responsive based on container, not viewport -->
  </div>
</div>
```

---

## ğŸ¬ NETFLIX-GRADE UI/UX ANIMATIONS

### GSAP Integration Pattern

```svelte
<script lang="ts">
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  
  gsap.registerPlugin(ScrollTrigger);
  
  let container: HTMLElement;
  let cards: HTMLElement[] = $state([]);
  
  $effect(() => {
    if (!container) return;
    
    // Staggered card entrance
    const ctx = gsap.context(() => {
      gsap.from(cards, {
        y: 100,
        opacity: 0,
        duration: 0.8,
        stagger: 0.1,
        ease: 'power3.out',
        scrollTrigger: {
          trigger: container,
          start: 'top 80%',
          toggleActions: 'play none none reverse'
        }
      });
    }, container);
    
    return () => ctx.revert();
  });
</script>

<div bind:this={container} class="grid grid-cols-4 gap-6">
  {#each items as item, i}
    <div bind:this={cards[i]} class="card">
      <!-- Content -->
    </div>
  {/each}
</div>
```

### Netflix Card Hover Effect

```svelte
<script lang="ts">
  import { gsap } from 'gsap';
  
  let card: HTMLElement;
  let isHovered = $state(false);
  
  function handleMouseEnter() {
    isHovered = true;
    gsap.to(card, {
      scale: 1.05,
      y: -10,
      boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.5)',
      duration: 0.3,
      ease: 'power2.out'
    });
  }
  
  function handleMouseLeave() {
    isHovered = false;
    gsap.to(card, {
      scale: 1,
      y: 0,
      boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)',
      duration: 0.3,
      ease: 'power2.out'
    });
  }
</script>

<div
  bind:this={card}
  class="
    relative 
    rounded-xl 
    overflow-hidden 
    cursor-pointer
    transform-gpu
    will-change-transform
  "
  onmouseenter={handleMouseEnter}
  onmouseleave={handleMouseLeave}
>
  <img 
    src={thumbnail} 
    alt={title}
    class="w-full aspect-video object-cover"
    loading="lazy"
  />
  
  {#if isHovered}
    <div 
      class="
        absolute inset-0 
        bg-gradient-to-t from-black/90 via-black/50 to-transparent
        flex flex-col justify-end
        p-4
      "
    >
      <h3 class="text-lg font-bold">{title}</h3>
      <p class="text-sm text-white/70 line-clamp-2">{description}</p>
    </div>
  {/if}
</div>
```

### Page Transitions

```svelte
<!-- +layout.svelte -->
<script lang="ts">
  import { page } from '$app/stores';
  import { gsap } from 'gsap';
  
  let { children } = $props();
  let container: HTMLElement;
  
  $effect(() => {
    // Track page changes
    const currentPath = $page.url.pathname;
    
    gsap.fromTo(
      container,
      { opacity: 0, y: 20 },
      { opacity: 1, y: 0, duration: 0.4, ease: 'power2.out' }
    );
  });
</script>

<div bind:this={container}>
  {@render children()}
</div>
```

### Skeleton Loading States

```svelte
<script lang="ts">
  let { isLoading = false }: { isLoading?: boolean } = $props();
</script>

{#if isLoading}
  <div class="animate-pulse space-y-4">
    <div class="h-48 bg-surface-elevated rounded-xl"></div>
    <div class="h-4 bg-surface-elevated rounded w-3/4"></div>
    <div class="h-4 bg-surface-elevated rounded w-1/2"></div>
  </div>
{:else}
  {@render children()}
{/if}
```

---

## ğŸ“ SVELTEKIT 2.x PATTERNS

### Load Functions - Type-Safe

```typescript
// +page.ts
import type { PageLoad } from './$types';
import { error, redirect } from '@sveltejs/kit';

export const load: PageLoad = async ({ params, fetch, parent }) => {
  // Always await parent data if needed
  const parentData = await parent();
  
  const response = await fetch(`/api/items/${params.id}`);
  
  if (!response.ok) {
    if (response.status === 404) {
      throw error(404, { message: 'Item not found' });
    }
    throw error(500, { message: 'Failed to load item' });
  }
  
  const item = await response.json();
  
  return {
    item,
    meta: {
      title: item.name,
      description: item.description
    }
  };
};
```

### Form Actions - Type-Safe

```typescript
// +page.server.ts
import type { Actions, PageServerLoad } from './$types';
import { fail, redirect } from '@sveltejs/kit';
import { z } from 'zod';

const CreateItemSchema = z.object({
  name: z.string().min(1).max(100),
  price: z.coerce.number().positive(),
  description: z.string().optional()
});

export const actions: Actions = {
  create: async ({ request, locals }) => {
    const formData = await request.formData();
    const data = Object.fromEntries(formData);
    
    const result = CreateItemSchema.safeParse(data);
    
    if (!result.success) {
      return fail(400, {
        errors: result.error.flatten().fieldErrors,
        values: data
      });
    }
    
    try {
      const item = await locals.api.createItem(result.data);
      throw redirect(303, `/items/${item.id}`);
    } catch (e) {
      return fail(500, { 
        message: 'Failed to create item',
        values: data 
      });
    }
  }
};
```

### API Routes - RESTful

```typescript
// +server.ts
import type { RequestHandler } from './$types';
import { json, error } from '@sveltejs/kit';
import { z } from 'zod';

export const GET: RequestHandler = async ({ url, locals }) => {
  const page = Number(url.searchParams.get('page')) || 1;
  const limit = Math.min(Number(url.searchParams.get('limit')) || 20, 100);
  
  const items = await locals.api.getItems({ page, limit });
  
  return json({
    items,
    pagination: {
      page,
      limit,
      total: items.total
    }
  });
};

export const POST: RequestHandler = async ({ request, locals }) => {
  const body = await request.json();
  
  // Validate with Zod
  const schema = z.object({
    name: z.string(),
    value: z.number()
  });
  
  const result = schema.safeParse(body);
  
  if (!result.success) {
    throw error(400, { message: 'Invalid request body' });
  }
  
  const item = await locals.api.createItem(result.data);
  
  return json(item, { status: 201 });
};
```

### Hooks - Auth & Error Handling

```typescript
// hooks.server.ts
import type { Handle, HandleServerError } from '@sveltejs/kit';
import { sequence } from '@sveltejs/kit/hooks';

const auth: Handle = async ({ event, resolve }) => {
  const token = event.cookies.get('auth_token');
  
  if (token) {
    try {
      const user = await verifyToken(token);
      event.locals.user = user;
    } catch {
      event.cookies.delete('auth_token', { path: '/' });
    }
  }
  
  return resolve(event);
};

const logging: Handle = async ({ event, resolve }) => {
  const start = performance.now();
  const response = await resolve(event);
  const duration = performance.now() - start;
  
  console.log(`${event.request.method} ${event.url.pathname} - ${duration.toFixed(2)}ms`);
  
  return response;
};

export const handle = sequence(auth, logging);

export const handleError: HandleServerError = async ({ error, event }) => {
  console.error('Server error:', error);
  
  return {
    message: 'An unexpected error occurred',
    code: 'INTERNAL_ERROR'
  };
};
```

---

## ğŸ¦€ RUST/AXUM PATTERNS

### Handler Structure

```rust
use axum::{
    extract::{Path, Query, State, Json},
    http::StatusCode,
    response::IntoResponse,
};
use serde::{Deserialize, Serialize};
use validator::Validate;

#[derive(Debug, Deserialize, Validate)]
pub struct CreateItemRequest {
    #[validate(length(min = 1, max = 100))]
    name: String,
    
    #[validate(range(min = 0.01))]
    price: f64,
    
    #[validate(length(max = 1000))]
    description: Option<String>,
}

#[derive(Debug, Serialize)]
pub struct ItemResponse {
    id: uuid::Uuid,
    name: String,
    price: f64,
    created_at: chrono::DateTime<chrono::Utc>,
}

pub async fn create_item(
    State(state): State<AppState>,
    Json(payload): Json<CreateItemRequest>,
) -> Result<impl IntoResponse, AppError> {
    payload.validate()?;
    
    let item = state.db.create_item(&payload).await?;
    
    Ok((StatusCode::CREATED, Json(ItemResponse::from(item))))
}

pub async fn get_item(
    State(state): State<AppState>,
    Path(id): Path<uuid::Uuid>,
) -> Result<impl IntoResponse, AppError> {
    let item = state.db
        .get_item(id)
        .await?
        .ok_or(AppError::NotFound)?;
    
    Ok(Json(ItemResponse::from(item)))
}
```

### Error Handling

```rust
use axum::{
    http::StatusCode,
    response::{IntoResponse, Response},
    Json,
};
use serde_json::json;

#[derive(Debug)]
pub enum AppError {
    NotFound,
    Unauthorized,
    Forbidden,
    BadRequest(String),
    Internal(anyhow::Error),
    Validation(validator::ValidationErrors),
    Database(sqlx::Error),
}

impl IntoResponse for AppError {
    fn into_response(self) -> Response {
        let (status, message) = match self {
            AppError::NotFound => (StatusCode::NOT_FOUND, "Resource not found".to_string()),
            AppError::Unauthorized => (StatusCode::UNAUTHORIZED, "Unauthorized".to_string()),
            AppError::Forbidden => (StatusCode::FORBIDDEN, "Forbidden".to_string()),
            AppError::BadRequest(msg) => (StatusCode::BAD_REQUEST, msg),
            AppError::Internal(e) => {
                tracing::error!("Internal error: {:?}", e);
                (StatusCode::INTERNAL_SERVER_ERROR, "Internal server error".to_string())
            }
            AppError::Validation(e) => (StatusCode::BAD_REQUEST, format!("{}", e)),
            AppError::Database(e) => {
                tracing::error!("Database error: {:?}", e);
                (StatusCode::INTERNAL_SERVER_ERROR, "Database error".to_string())
            }
        };

        (status, Json(json!({ "error": message }))).into_response()
    }
}

impl From<sqlx::Error> for AppError {
    fn from(e: sqlx::Error) -> Self {
        AppError::Database(e)
    }
}

impl From<validator::ValidationErrors> for AppError {
    fn from(e: validator::ValidationErrors) -> Self {
        AppError::Validation(e)
    }
}
```

### Database Queries - SQLx

```rust
use sqlx::{PgPool, FromRow};
use uuid::Uuid;
use chrono::{DateTime, Utc};

#[derive(Debug, FromRow)]
pub struct Item {
    pub id: Uuid,
    pub name: String,
    pub price: rust_decimal::Decimal,
    pub description: Option<String>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}

impl ItemRepository {
    pub async fn create(&self, req: &CreateItemRequest) -> Result<Item, sqlx::Error> {
        sqlx::query_as!(
            Item,
            r#"
            INSERT INTO items (name, price, description)
            VALUES ($1, $2, $3)
            RETURNING id, name, price, description, created_at, updated_at
            "#,
            req.name,
            rust_decimal::Decimal::from_f64_retain(req.price).unwrap(),
            req.description
        )
        .fetch_one(&self.pool)
        .await
    }
    
    pub async fn get_by_id(&self, id: Uuid) -> Result<Option<Item>, sqlx::Error> {
        sqlx::query_as!(
            Item,
            r#"
            SELECT id, name, price, description, created_at, updated_at
            FROM items
            WHERE id = $1 AND deleted_at IS NULL
            "#,
            id
        )
        .fetch_optional(&self.pool)
        .await
    }
    
    pub async fn list(
        &self,
        page: i64,
        limit: i64,
    ) -> Result<(Vec<Item>, i64), sqlx::Error> {
        let offset = (page - 1) * limit;
        
        let items = sqlx::query_as!(
            Item,
            r#"
            SELECT id, name, price, description, created_at, updated_at
            FROM items
            WHERE deleted_at IS NULL
            ORDER BY created_at DESC
            LIMIT $1 OFFSET $2
            "#,
            limit,
            offset
        )
        .fetch_all(&self.pool)
        .await?;
        
        let total: (i64,) = sqlx::query_as(
            "SELECT COUNT(*) FROM items WHERE deleted_at IS NULL"
        )
        .fetch_one(&self.pool)
        .await?;
        
        Ok((items, total.0))
    }
}
```

---

## âœ… TESTING REQUIREMENTS

### Unit Tests - Vitest

```typescript
// component.test.ts
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/svelte';
import Button from './Button.svelte';

describe('Button', () => {
  it('renders with correct text', () => {
    render(Button, { props: { children: () => 'Click me' } });
    expect(screen.getByRole('button')).toHaveTextContent('Click me');
  });
  
  it('calls onClick when clicked', async () => {
    const onClick = vi.fn();
    render(Button, { props: { onClick } });
    
    await fireEvent.click(screen.getByRole('button'));
    
    expect(onClick).toHaveBeenCalledOnce();
  });
  
  it('is disabled when loading', () => {
    render(Button, { props: { isLoading: true } });
    expect(screen.getByRole('button')).toBeDisabled();
  });
});
```

### E2E Tests - Playwright

```typescript
// tests/auth.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Authentication', () => {
  test('user can log in', async ({ page }) => {
    await page.goto('/login');
    
    await page.getByLabel('Email').fill('test@example.com');
    await page.getByLabel('Password').fill('password123');
    await page.getByRole('button', { name: 'Sign In' }).click();
    
    await expect(page).toHaveURL('/dashboard');
    await expect(page.getByText('Welcome back')).toBeVisible();
  });
  
  test('shows error for invalid credentials', async ({ page }) => {
    await page.goto('/login');
    
    await page.getByLabel('Email').fill('wrong@example.com');
    await page.getByLabel('Password').fill('wrongpassword');
    await page.getByRole('button', { name: 'Sign In' }).click();
    
    await expect(page.getByText('Invalid credentials')).toBeVisible();
    await expect(page).toHaveURL('/login');
  });
});
```

### Rust Tests

```rust
#[cfg(test)]
mod tests {
    use super::*;
    use axum_test::TestServer;
    
    async fn setup() -> TestServer {
        let app = create_app().await;
        TestServer::new(app).unwrap()
    }
    
    #[tokio::test]
    async fn test_create_item() {
        let server = setup().await;
        
        let response = server
            .post("/api/items")
            .json(&json!({
                "name": "Test Item",
                "price": 29.99
            }))
            .await;
        
        response.assert_status_created();
        
        let body: ItemResponse = response.json();
        assert_eq!(body.name, "Test Item");
    }
    
    #[tokio::test]
    async fn test_get_nonexistent_item() {
        let server = setup().await;
        
        let response = server
            .get(&format!("/api/items/{}", Uuid::new_v4()))
            .await;
        
        response.assert_status_not_found();
    }
}
```

---

## ğŸš¨ CODE QUALITY ENFORCEMENT

### TypeScript Strict Mode - MANDATORY

```json
// tsconfig.json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "exactOptionalPropertyTypes": true,
    "noUncheckedIndexedAccess": true
  }
}
```

### ESLint Rules - Svelte 5

```javascript
// eslint.config.js
import svelte from 'eslint-plugin-svelte';

export default [
  ...svelte.configs['flat/recommended'],
  {
    rules: {
      'svelte/no-unused-svelte-ignore': 'error',
      'svelte/valid-compile': 'error',
      '@typescript-eslint/no-explicit-any': 'error',
      '@typescript-eslint/explicit-function-return-type': 'warn',
      'no-console': ['warn', { allow: ['warn', 'error'] }]
    }
  }
];
```

---

## ğŸ”´ MANDATORY VERIFICATION COMMANDS

### Run These Commands After EVERY Change:

```bash
# Frontend verification sequence (run ALL of these)
cd frontend

# 1. TypeScript/Svelte type checking
pnpm run check
# MUST OUTPUT: "0 errors"

# 2. Linting
pnpm run lint
# MUST OUTPUT: No errors, no warnings

# 3. Build verification
pnpm run build
# MUST OUTPUT: Build successful, no errors

# 4. Unit tests
pnpm run test
# MUST OUTPUT: All tests passed

# 5. E2E tests (for significant changes)
pnpm run test:e2e
# MUST OUTPUT: All tests passed
```

```bash
# Backend verification sequence (run ALL of these)
cd backend

# 1. Compilation check
cargo check
# MUST OUTPUT: No errors, no warnings (with --deny warnings)

# 2. Linting
cargo clippy -- -D warnings
# MUST OUTPUT: No errors, no warnings

# 3. Build
cargo build --release
# MUST OUTPUT: Build successful

# 4. Tests
cargo test
# MUST OUTPUT: All tests passed

# 5. Format check
cargo fmt --check
# MUST OUTPUT: No formatting issues
```

### What Each Command Catches:

| Command | Catches |
|---------|---------|
| `pnpm run check` | TypeScript errors, Svelte compilation errors, missing imports |
| `pnpm run lint` | Code style issues, unused variables, potential bugs |
| `pnpm run build` | Build-time errors, bundling issues, missing dependencies |
| `pnpm run test` | Logic errors, regressions, broken functionality |
| `cargo check` | Rust compilation errors, borrow checker issues |
| `cargo clippy` | Rust idiom violations, potential bugs, performance issues |

---

## ğŸ“‹ PRE-COMMIT CHECKLIST (Evidence-Based)

Before submitting ANY code change, provide EVIDENCE for each item:

### Verification Evidence Required:

- [ ] **Full file context understood** 
  - Evidence: "Read [filename] lines 1-XXX, understood [purpose]"
  
- [ ] **Dependencies traced** 
  - Evidence: "This file imports from: [list]. Imported by: [list]"
  
- [ ] **Types are correct** 
  - Evidence: "`pnpm run check` output: 0 errors"
  
- [ ] **Svelte 5 syntax** 
  - Evidence: "Verified: using $state, $derived, $props - no legacy syntax"
  
- [ ] **Tailwind v4 syntax** 
  - Evidence: "Using @theme variables, no deprecated classes"
  
- [ ] **Tests written/updated** 
  - Evidence: "`pnpm run test` output: X tests passed, 0 failed"
  
- [ ] **Animations smooth** 
  - Evidence: "Tested in browser, 60fps confirmed via DevTools"
  
- [ ] **Accessibility checked** 
  - Evidence: "ARIA labels present, keyboard nav tested"
  
- [ ] **Error states handled** 
  - Evidence: "Loading, error, empty states all implemented"
  
- [ ] **Mobile responsive** 
  - Evidence: "Tested at 375px, 768px, 1024px, 1440px"
  
- [ ] **No TypeScript errors** 
  - Evidence: "`pnpm run check` shows 0 errors"
  
- [ ] **No ESLint errors** 
  - Evidence: "`pnpm run lint` shows 0 errors, 0 warnings"
  
- [ ] **Build succeeds**
  - Evidence: "`pnpm run build` completed successfully"
  
- [ ] **Related files updated** 
  - Evidence: "Updated: [list of files], verified imports in: [list]"
  
- [ ] **No regressions introduced**
  - Evidence: "Ran full test suite, all X tests pass"

---

## ğŸ¯ COMPONENT ARCHITECTURE

### File Structure

```
src/lib/components/
â”œâ”€â”€ ui/                    # Primitive UI components
â”‚   â”œâ”€â”€ Button/
â”‚   â”‚   â”œâ”€â”€ Button.svelte
â”‚   â”‚   â”œâ”€â”€ Button.test.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ features/              # Feature-specific components
â”‚   â”œâ”€â”€ trading/
â”‚   â”‚   â”œâ”€â”€ Chart/
â”‚   â”‚   â”œâ”€â”€ OrderBook/
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â””â”€â”€ layout/               # Layout components
    â”œâ”€â”€ Header/
    â”œâ”€â”€ Sidebar/
    â””â”€â”€ ...
```

### Component Template

```svelte
<!--
  @component ComponentName
  @description Brief description of what this component does
  
  @example
  ```svelte
  <ComponentName title="Hello" onSelect={handleSelect} />
  ```
-->
<script lang="ts">
  import type { Snippet } from 'svelte';
  
  // Types
  interface Props {
    /** The title to display */
    title: string;
    /** Called when an item is selected */
    onSelect?: (id: string) => void;
    /** Optional children content */
    children?: Snippet;
  }
  
  // Props
  let { 
    title,
    onSelect,
    children
  }: Props = $props();
  
  // State
  let isOpen = $state(false);
  
  // Derived
  let displayTitle = $derived(title.toUpperCase());
  
  // Effects
  $effect(() => {
    // Setup
    return () => {
      // Cleanup
    };
  });
  
  // Handlers
  function handleClick() {
    isOpen = !isOpen;
    onSelect?.(title);
  }
</script>

<div class="component-root">
  <button onclick={handleClick}>
    {displayTitle}
  </button>
  
  {#if isOpen && children}
    {@render children()}
  {/if}
</div>

<style>
  /* Component-scoped styles if needed */
</style>
```

---

## ğŸ”’ SECURITY REQUIREMENTS

### Input Validation - Always Use Zod

```typescript
import { z } from 'zod';

// Define schemas
export const UserSchema = z.object({
  email: z.string().email(),
  password: z.string().min(8).max(100),
  name: z.string().min(1).max(100).optional()
});

// Use in form actions
const result = UserSchema.safeParse(formData);
if (!result.success) {
  return fail(400, { errors: result.error.flatten() });
}
```

### XSS Prevention

```svelte
<script lang="ts">
  import DOMPurify from 'isomorphic-dompurify';
  
  let { htmlContent }: { htmlContent: string } = $props();
  
  let sanitized = $derived(DOMPurify.sanitize(htmlContent));
</script>

<!-- Safe HTML rendering -->
{@html sanitized}
```

### CSRF Protection

```typescript
// hooks.server.ts
import { dev } from '$app/environment';

export const handle: Handle = async ({ event, resolve }) => {
  // Verify CSRF for mutations
  if (['POST', 'PUT', 'DELETE', 'PATCH'].includes(event.request.method)) {
    const origin = event.request.headers.get('origin');
    const host = event.request.headers.get('host');
    
    if (!dev && origin !== `https://${host}`) {
      return new Response('CSRF validation failed', { status: 403 });
    }
  }
  
  return resolve(event);
};
```

---

## ğŸ“± RESPONSIVE DESIGN - January 2026 Device Data

### Apple Device Viewport Reference (CSS/Logical Pixels)

#### iPhones (2024-2025)
| Device | Width | Height | Screen |
|--------|-------|--------|--------|
| iPhone 17 Pro Max | 440px | 956px | 6.9" |
| iPhone 17 Pro | 402px | 874px | 6.3" |
| iPhone 17 | 402px | 874px | 6.3" |
| iPhone Air | 420px | 912px | 6.5" |
| iPhone 16e | 390px | 844px | 6.1" |
| iPhone 16 Pro Max | 440px | 956px | 6.9" |
| iPhone 16 Pro | 402px | 874px | 6.3" |
| iPhone 16 Plus | 430px | 932px | 6.7" |
| iPhone 16 | 393px | 852px | 6.1" |
| iPhone 15 Pro Max | 430px | 932px | 6.7" |
| iPhone 15 Pro | 393px | 852px | 6.1" |
| iPhone SE (3rd) | 375px | 667px | 4.7" |

#### iPads (2024-2025)
| Device | Width | Height | Screen |
|--------|-------|--------|--------|
| iPad Pro 13" (7th) | 1032px | 1376px | 13" |
| iPad Pro 11" (7th) | 834px | 1210px | 11" |
| iPad Air 13" (6th) | 1024px | 1366px | 13" |
| iPad Air 11" (6th) | 820px | 1180px | 11" |
| iPad Mini (7th) | 744px | 1133px | 8.3" |
| iPad 10th gen | 820px | 1180px | 10.9" |

### Tailwind v4 Breakpoint Configuration

```css
/* app.css - Tailwind v4 January 2026 Breakpoints */
@import "tailwindcss";

@theme {
  /* Reset defaults and set custom breakpoints */
  --breakpoint-*: initial;
  
  /* 
   * Mobile-first breakpoints based on January 2026 device data
   * Covers: iPhones 14-17, iPads, laptops, desktops
   */
  --breakpoint-xs: 20rem;      /* 320px - Legacy small phones */
  --breakpoint-sm: 24.5rem;    /* 392px - iPhone 16/17 standard */
  --breakpoint-md: 48rem;      /* 768px - iPad Mini portrait, tablets */
  --breakpoint-lg: 64rem;      /* 1024px - iPad landscape, small laptops */
  --breakpoint-xl: 80rem;      /* 1280px - Laptops, small desktops */
  --breakpoint-2xl: 96rem;     /* 1536px - Large desktops */
  --breakpoint-3xl: 120rem;    /* 1920px - Ultra-wide, 4K monitors */
}
```

### Breakpoint Summary Table

| Breakpoint | Min-Width | Rem | Target Devices |
|------------|-----------|-----|----------------|
| **default** | 0px | 0 | All phones (base mobile styles) |
| **xs** | 320px | 20rem | Legacy phones, small screens |
| **sm** | 392px | 24.5rem | iPhone 16/17 series, modern phones |
| **md** | 768px | 48rem | iPad Mini, tablets portrait |
| **lg** | 1024px | 64rem | iPad landscape, laptops |
| **xl** | 1280px | 80rem | Desktops, external monitors |
| **2xl** | 1536px | 96rem | Large desktops |
| **3xl** | 1920px | 120rem | Ultra-wide, 4K displays |

### Key Viewport Clusters (2026 Market Data)

**Mobile (~70% of traffic):**
- 360-393px â†’ Android phones, iPhone 14-16 standard
- 402-440px â†’ iPhone 17 series, Pro Max models

**Tablet (~15% of traffic):**
- 744-834px â†’ iPad Mini to iPad Air portrait
- 1024-1032px â†’ iPad landscape

**Desktop (~15% of traffic):**
- 1366px â†’ Common laptop resolution
- 1440px â†’ Standard desktop
- 1920px â†’ Full HD monitors
- 2560px+ â†’ 4K and ultra-wide

### Mobile-First Component Pattern

```svelte
<div class="
  /* â•â•â• BASE - Mobile (0-391px) â•â•â• */
  flex flex-col gap-4 p-4 text-sm
  
  /* â•â•â• SM - Modern phones (392px+) â•â•â• */
  /* iPhone 16/17 standard, larger Android */
  sm:gap-5 sm:text-base
  
  /* â•â•â• MD - Tablets portrait (768px+) â•â•â• */
  /* iPad Mini, iPad Air portrait */
  md:flex-row md:gap-6 md:p-6
  
  /* â•â•â• LG - Tablets landscape / Laptops (1024px+) â•â•â• */
  /* iPad landscape, MacBook Air */
  lg:gap-8 lg:p-8 lg:max-w-5xl lg:mx-auto
  
  /* â•â•â• XL - Desktops (1280px+) â•â•â• */
  /* External monitors, large laptops */
  xl:max-w-6xl xl:gap-10
  
  /* â•â•â• 2XL - Large desktops (1536px+) â•â•â• */
  /* iMac, large external monitors */
  2xl:max-w-7xl 2xl:p-10
  
  /* â•â•â• 3XL - Ultra-wide / 4K (1920px+) â•â•â• */
  /* Studio Display, Pro Display XDR */
  3xl:max-w-[1800px]
">
  <!-- Content -->
</div>
```

### Container Queries for Component-Level Responsiveness

```svelte
<!-- Parent container -->
<div class="@container">
  <div class="
    /* Component responds to container, not viewport */
    flex flex-col gap-2
    
    @sm:flex-row @sm:gap-4
    @md:gap-6
    @lg:gap-8
  ">
    <!-- Content adapts to available space -->
  </div>
</div>
```

### Touch Target Requirements (WCAG 2.2 / Apple HIG)

```svelte
<!-- Minimum touch targets for mobile -->
<button class="
  /* Minimum 44x44px touch target (Apple HIG) */
  min-h-[44px] min-w-[44px]
  
  /* Or use padding to achieve target size */
  px-4 py-3
  
  /* Adequate spacing between targets */
  /* Minimum 8px gap recommended */
">
  Click Me
</button>
```

### Netflix-Style Responsive Grid

```svelte
<div class="
  grid gap-4
  
  /* Mobile: 2 columns */
  grid-cols-2
  
  /* Tablet: 3-4 columns */
  md:grid-cols-3
  lg:grid-cols-4
  
  /* Desktop: 5-6 columns */
  xl:grid-cols-5
  2xl:grid-cols-6
  
  /* Ultra-wide: 7+ columns */
  3xl:grid-cols-7
">
  {#each items as item}
    <div class="aspect-video rounded-lg overflow-hidden">
      <!-- Card content -->
    </div>
  {/each}
</div>
```

---

## ğŸ”„ STATE MANAGEMENT

### Global Stores - .svelte.ts Pattern

```typescript
// stores/user.svelte.ts
import type { User } from '$lib/types';

class UserStore {
  user = $state<User | null>(null);
  isLoading = $state(false);
  
  isAuthenticated = $derived(this.user !== null);
  
  async login(email: string, password: string) {
    this.isLoading = true;
    try {
      const response = await fetch('/api/auth/login', {
        method: 'POST',
        body: JSON.stringify({ email, password })
      });
      this.user = await response.json();
    } finally {
      this.isLoading = false;
    }
  }
  
  logout() {
    this.user = null;
  }
}

export const userStore = new UserStore();
```

### Context for Component Trees

```svelte
<!-- Parent.svelte -->
<script lang="ts">
  import { setContext } from 'svelte';
  
  const theme = $state({ mode: 'dark' });
  setContext('theme', theme);
</script>

<!-- Child.svelte -->
<script lang="ts">
  import { getContext } from 'svelte';
  
  const theme = getContext<{ mode: string }>('theme');
</script>
```

---

## ğŸ“Š PERFORMANCE OPTIMIZATION

### Image Optimization

```svelte
<script lang="ts">
  import { decode } from 'blurhash';
  
  let { src, alt, blurhash }: Props = $props();
  let isLoaded = $state(false);
</script>

<div class="relative aspect-video">
  {#if !isLoaded && blurhash}
    <canvas 
      class="absolute inset-0 w-full h-full"
      use:renderBlurhash={blurhash}
    />
  {/if}
  
  <img
    {src}
    {alt}
    loading="lazy"
    decoding="async"
    onload={() => isLoaded = true}
    class="w-full h-full object-cover transition-opacity duration-300"
    class:opacity-0={!isLoaded}
  />
</div>
```

### Code Splitting

```typescript
// Lazy load heavy components
const Chart = await import('$lib/components/Chart.svelte');

// Dynamic imports in routes
export const load = async () => {
  const data = await import('./heavy-data.json');
  return { data: data.default };
};
```

### Memoization

```svelte
<script lang="ts">
  let items = $state<Item[]>([]);
  let filter = $state('');
  
  // Expensive computation is cached
  let filteredItems = $derived.by(() => {
    console.log('Filtering...'); // Only runs when items or filter changes
    return items.filter(item => 
      item.name.toLowerCase().includes(filter.toLowerCase())
    );
  });
</script>
```

---

## ğŸ¯ ACCESSIBILITY (A11Y)

### Required Patterns

```svelte
<!-- Buttons -->
<button
  type="button"
  aria-label="Close dialog"
  aria-pressed={isPressed}
  disabled={isLoading}
>
  <span class="sr-only">Close</span>
  <XIcon aria-hidden="true" />
</button>

<!-- Forms -->
<label for="email">Email</label>
<input 
  id="email" 
  type="email"
  aria-describedby="email-error"
  aria-invalid={hasError}
/>
{#if hasError}
  <p id="email-error" role="alert">Please enter a valid email</p>
{/if}

<!-- Modals -->
<div
  role="dialog"
  aria-modal="true"
  aria-labelledby="modal-title"
>
  <h2 id="modal-title">Modal Title</h2>
</div>

<!-- Live Regions -->
<div aria-live="polite" aria-atomic="true">
  {statusMessage}
</div>
```

### Focus Management

```svelte
<script lang="ts">
  let dialogRef: HTMLElement;
  let triggerRef: HTMLElement;
  
  $effect(() => {
    if (isOpen) {
      // Focus first focusable element
      dialogRef?.querySelector<HTMLElement>('[autofocus]')?.focus();
    } else {
      // Return focus to trigger
      triggerRef?.focus();
    }
  });
</script>
```

---

## ğŸ“ DOCUMENTATION REQUIREMENTS

### JSDoc for All Exports

```typescript
/**
 * Formats a currency value with the specified locale and currency code.
 * 
 * @param value - The numeric value to format
 * @param currency - ISO 4217 currency code (default: 'USD')
 * @param locale - BCP 47 locale string (default: 'en-US')
 * @returns Formatted currency string
 * 
 * @example
 * ```ts
 * formatCurrency(1234.56) // '$1,234.56'
 * formatCurrency(1234.56, 'EUR', 'de-DE') // '1.234,56 â‚¬'
 * ```
 */
export function formatCurrency(
  value: number,
  currency: string = 'USD',
  locale: string = 'en-US'
): string {
  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency
  }).format(value);
}
```

---

## âš¡ REMEMBER

1. **Context First** - ALWAYS read and understand before changing
2. **Svelte 5 Only** - Runes, snippets, callback props, no legacy syntax
3. **Tailwind v4** - @theme, @utility, modern classes
4. **Type Safety** - No `any`, strict mode, Zod validation
5. **Test Everything** - Unit, E2E, edge cases
6. **Netflix Quality** - 60fps animations, skeleton states, polish
7. **Apply Everywhere** - Changes must propagate to all affected files
8. **End-to-End** - Verify the full user flow works

---

*Last Updated: January 2026*
*Stack: SvelteKit 2.50.1 | Svelte 5.48.2 | Tailwind v4.1.18 | Rust/Axum 0.7*

---

## ğŸš¨ FINAL CRITICAL REMINDERS

### The Golden Rules:

1. **ZERO ERRORS TOLERANCE** - Every change must result in 0 errors, 0 warnings
2. **EVIDENCE REQUIRED** - Show proof that verification commands passed
3. **TRACE EVERYTHING** - Know every file your change affects
4. **UPDATE EVERYTHING** - If you change A and B imports A, update B
5. **TEST EVERYTHING** - Run the full verification suite every time
6. **ONE THING AT A TIME** - Never batch unrelated changes
7. **ASK IF UNSURE** - Better to ask than to break something
8. **ROLLBACK READY** - Always know how to undo your changes

### Before You Start ANY Task:

```
1. Run `pnpm run check` - Does it pass? If NO, fix existing errors first
2. Run `pnpm run lint` - Any warnings? Fix them first
3. Run `pnpm run build` - Does it build? If NO, fix first
4. Run `pnpm run test` - All passing? If NO, fix first
```

### After EVERY Change:

```
1. Run `pnpm run check` - Still 0 errors?
2. Run `pnpm run lint` - Still 0 warnings?
3. Run `pnpm run build` - Still builds?
4. Run `pnpm run test` - All still passing?

If ANY of these fail, your change introduced a bug. FIX IT IMMEDIATELY.
Do not proceed to the next change until all checks pass.
```

### The Mantra:

**"I will not introduce errors. I will not introduce warnings. I will trace all dependencies. I will update all affected files. I will verify with evidence. I will maintain zero-error state at all times."**