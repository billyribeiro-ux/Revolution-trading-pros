<!doctype html>
<html>
	<head>
		<title>Console Capture</title>
		<style>
			body {
				margin: 0;
				padding: 0;
				font-family: monospace;
				background: #000;
				color: #0f0;
			}
			#console {
				position: fixed;
				top: 0;
				right: 0;
				width: 50%;
				height: 100%;
				overflow-y: auto;
				background: #000;
				border-left: 2px solid #0f0;
				padding: 10px;
				box-sizing: border-box;
			}
			#app {
				width: 50%;
				height: 100%;
			}
			.log {
				margin: 2px 0;
				padding: 2px;
				border-left: 2px solid #0f0;
				padding-left: 5px;
			}
			.error {
				border-left-color: #f00;
				color: #f00;
			}
			.warn {
				border-left-color: #ff0;
				color: #ff0;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<iframe src="http://localhost:5174" style="width: 100%; height: 100%; border: none"></iframe>
		</div>
		<div id="console"></div>

		<script>
			const consoleDiv = document.getElementById('console');
			const logs = [];

			const origLog = console.log;
			const origError = console.error;
			const origWarn = console.warn;

			function addLog(msg, type = 'log') {
				const el = document.createElement('div');
				el.className = `log ${type === 'error' ? 'error' : type === 'warn' ? 'warn' : ''}`;
				el.textContent = msg;
				consoleDiv.appendChild(el);
				consoleDiv.scrollTop = consoleDiv.scrollHeight;
				logs.push({ type, msg });
			}

			console.log = function (...args) {
				origLog.apply(console, args);
				addLog(args.join(' '), 'log');
			};

			console.error = function (...args) {
				origError.apply(console, args);
				addLog(args.join(' '), 'error');
			};

			console.warn = function (...args) {
				origWarn.apply(console, args);
				addLog(args.join(' '), 'warn');
			};

			// Try to access iframe console
			const iframe = document.querySelector('iframe');
			setTimeout(() => {
				try {
					const iframeWin = iframe.contentWindow;
					const iframeConsole = iframeWin.console;

					// Monkey-patch iframe console
					const iframeLog = iframeConsole.log;
					const iframeError = iframeConsole.error;
					const iframeWarn = iframeConsole.warn;

					iframeConsole.log = function (...args) {
						iframeLog.apply(iframeConsole, args);
						addLog('[IFRAME] ' + args.join(' '), 'log');
					};

					iframeConsole.error = function (...args) {
						iframeError.apply(iframeConsole, args);
						addLog('[IFRAME] ' + args.join(' '), 'error');
					};

					iframeConsole.warn = function (...args) {
						iframeWarn.apply(iframeConsole, args);
						addLog('[IFRAME] ' + args.join(' '), 'warn');
					};

					addLog('Iframe console patched', 'log');
				} catch (e) {
					addLog('Cannot access iframe: ' + e.message, 'error');
				}
			}, 1000);
		</script>
	</body>
</html>
