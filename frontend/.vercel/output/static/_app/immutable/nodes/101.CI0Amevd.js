import{z as $e,p as ze,o as Ce,f as _,a9 as De,F as y,e as r,Z as re,i as P,h as u,j as Se,E as Te,as as Ie,q as s,c as i,s as U,g as m,n as Le,at as Ne,H as A,r as t,B as qe,aa as Re,al as le,w as L,x as ie,bH as c,c2 as oe,b_ as ne,D as Be,bJ as k,v as He,d as Je}from"../chunks/C_QN0JMx.js";import{u as de,A as ve}from"../chunks/BIaWRQrO.js";var je=_('<div class="alert success svelte-axkm9u"><!> </div>'),Me=_('<div class="alert error svelte-axkm9u"><!> <span class="error-message svelte-axkm9u"> </span> <button class="btn-retry svelte-axkm9u">Retry</button></div>'),Qe=_('<div class="loading svelte-axkm9u"><div class="spinner svelte-axkm9u"></div> <p>Loading user...</p></div>'),Xe=_("<!> Update User",1),Ye=_('<form class="user-form svelte-axkm9u"><div class="form-section svelte-axkm9u"><h2 class="svelte-axkm9u">Basic Information</h2> <div class="form-row svelte-axkm9u"><div class="form-group svelte-axkm9u"><label for="first_name" class="svelte-axkm9u">First Name</label> <input type="text" id="first_name" class="input svelte-axkm9u" placeholder="John"/></div> <div class="form-group svelte-axkm9u"><label for="last_name" class="svelte-axkm9u">Last Name</label> <input type="text" id="last_name" class="input svelte-axkm9u" placeholder="Doe"/></div></div> <div class="form-group svelte-axkm9u"><label for="email" class="svelte-axkm9u">Email Address *</label> <input type="email" id="email" class="input svelte-axkm9u" required placeholder="user@example.com"/></div></div> <div class="form-section svelte-axkm9u"><h2 class="svelte-axkm9u">Change Password</h2> <p class="help-text svelte-axkm9u">Leave blank to keep current password</p> <div class="form-row svelte-axkm9u"><div class="form-group svelte-axkm9u"><label for="password" class="svelte-axkm9u">New Password</label> <input type="password" id="password" class="input svelte-axkm9u" placeholder="••••••••"/></div> <div class="form-group svelte-axkm9u"><label for="password_confirmation" class="svelte-axkm9u">Confirm Password</label> <input type="password" id="password_confirmation" class="input svelte-axkm9u" placeholder="••••••••"/></div></div></div> <div class="form-section svelte-axkm9u"><h2 class="svelte-axkm9u">Roles & Permissions</h2> <div class="roles-grid svelte-axkm9u"><label class="role-checkbox svelte-axkm9u"><input type="checkbox" class="svelte-axkm9u"/> <div class="role-card svelte-axkm9u"><div class="role-icon admin svelte-axkm9u"><!></div> <div class="role-info svelte-axkm9u"><div class="role-name svelte-axkm9u">Admin</div> <div class="role-description svelte-axkm9u">Full access to admin panel</div></div></div></label> <label class="role-checkbox svelte-axkm9u"><input type="checkbox" class="svelte-axkm9u"/> <div class="role-card svelte-axkm9u"><div class="role-icon super-admin svelte-axkm9u"><!></div> <div class="role-info svelte-axkm9u"><div class="role-name svelte-axkm9u">Super Admin</div> <div class="role-description svelte-axkm9u">Complete system control</div></div></div></label></div></div> <div class="form-actions svelte-axkm9u"><button type="button" class="btn-secondary svelte-axkm9u">Cancel</button> <button type="submit" class="btn-primary svelte-axkm9u"><!></button></div></form>'),Ze=_('<div class="admin-page svelte-axkm9u"><div class="page-header svelte-axkm9u"><div><h1 class="svelte-axkm9u">Edit User</h1> <p class="svelte-axkm9u">Update user information and roles</p></div> <button class="btn-secondary svelte-axkm9u"><!> Cancel</button></div> <!> <!> <!></div>');function Oe(me,ue){ze(ue,!0);const ce=()=>qe(Re,"$page",pe),[pe,_e]=Te();let F=U(!0),x=U(!1),n=U(""),b=U(""),a={name:"",first_name:"",last_name:"",email:"",password:"",password_confirmation:"",roles:[]},N=Le(()=>parseInt(ce().params.id));Ce(async()=>{await q()});async function q(){i(F,!0),i(n,"");try{const l=(await de.get(m(N))).data;if(!l){i(n,"User not found. Please check the user ID and try again.");return}a.name=l.name||"",a.first_name=l.first_name||"",a.last_name=l.last_name||"",a.email=l.email||"",a.roles=l.roles?.map(d=>d.name)||[]}catch(e){if(e instanceof ve){if(e.status===401){y("/login");return}e.status===404?i(n,"User not found. The user may have been deleted."):e.status===403?i(n,"Permission denied. You do not have access to edit this user."):e.message?.includes("SQLSTATE")||e.message?.includes("Column not found")?i(n,"Database configuration issue. Please contact support."):i(n,e.message||"Failed to load user data.",!0)}else e?.name==="TypeError"&&e?.message==="Failed to fetch"?i(n,"Network error. Please check your connection and try again."):i(n,"Failed to load user. Please try again.")}finally{i(F,!1)}}async function fe(){if(i(n,""),i(b,""),!a.email.trim()){i(n,"Email is required");return}if(a.password&&a.password!==a.password_confirmation){i(n,"Passwords do not match");return}i(x,!0);try{const e={name:a.name||`${a.first_name} ${a.last_name}`.trim(),first_name:a.first_name,last_name:a.last_name,email:a.email,roles:a.roles};a.password&&(e.password=a.password,e.password_confirmation=a.password_confirmation),await de.update(m(N),e),i(b,"User updated successfully!"),setTimeout(()=>{y("/admin/users")},1500)}catch(e){e instanceof ve?i(n,e.message,!0):i(n,"Failed to update user")}finally{i(x,!1)}}function R(e){a.roles.includes(e)?a.roles=a.roles.filter(l=>l!==e):a.roles=[...a.roles,e]}var E=Ze();De("axkm9u",e=>{Ie(()=>{Ne.title="Edit User | Admin"})});var $=s(E),z=r(s($),2);z.__click=()=>y("/admin/users");var ke=s(z);re(ke,{size:18}),A(),t(z),t($);var B=r($,2);{var xe=e=>{var l=je(),d=s(l);le(d,{size:20});var v=r(d);t(l),L(()=>ie(v,` ${m(b)??""}`)),u(e,l)};P(B,e=>{m(b)&&e(xe)})}var H=r(B,2);{var be=e=>{var l=Me(),d=s(l);re(d,{size:20});var v=r(d,2),f=s(v,!0);t(v);var h=r(v,2);h.__click=q,t(l),L(()=>ie(f,m(n))),u(e,l)};P(H,e=>{m(n)&&e(be)})}var he=r(H,2);{var ge=e=>{var l=Qe();u(e,l)},we=e=>{var l=Ye(),d=s(l),v=r(s(d),2),f=s(v),h=r(s(f),2);c(h),t(f);var J=r(f,2),j=r(s(J),2);c(j),t(J),t(v);var M=r(v,2),Q=r(s(M),2);c(Q),t(M),t(d);var C=r(d,2),X=r(s(C),4),D=s(X),Y=r(s(D),2);c(Y),t(D);var Z=r(D,2),G=r(s(Z),2);c(G),t(Z),t(X),t(C);var S=r(C,2),K=r(s(S),2),T=s(K),g=s(T);c(g),g.__change=()=>R("admin");var O=r(g,2),V=s(O),ye=s(V);oe(ye,{size:24}),t(V),A(2),t(O),t(T);var W=r(T,2),w=s(W);c(w),w.__change=()=>R("super-admin");var ee=r(w,2),ae=s(ee),Pe=s(ae);oe(Pe,{size:24}),t(ae),A(2),t(ee),t(W),t(K),t(S);var se=r(S,2),te=s(se);te.__click=()=>y("/admin/users");var I=r(te,2),Ue=s(I);{var Ae=o=>{var p=He("Saving...");u(o,p)},Fe=o=>{var p=Xe(),Ee=Je(p);le(Ee,{size:18}),A(),u(o,p)};P(Ue,o=>{m(x)?o(Ae):o(Fe,!1)})}t(I),t(se),t(l),L((o,p)=>{ne(g,o),ne(w,p),I.disabled=m(x)},[()=>a.roles.includes("admin"),()=>a.roles.includes("super-admin")]),Be("submit",l,fe),k(h,()=>a.first_name,o=>a.first_name=o),k(j,()=>a.last_name,o=>a.last_name=o),k(Q,()=>a.email,o=>a.email=o),k(Y,()=>a.password,o=>a.password=o),k(G,()=>a.password_confirmation,o=>a.password_confirmation=o),u(e,l)};P(he,e=>{m(F)?e(ge):e(we,!1)})}t(E),u(me,E),Se(),_e()}$e(["click","change"]);export{Oe as component};
