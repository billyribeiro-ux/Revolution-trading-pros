import{z as Ge,p as Ie,o as Xe,a3 as Be,f as n,a9 as We,d as Ce,c as x,e as r,i as C,w as y,h as d,j as Ye,as as Ze,q as a,aP as V,g as e,x as g,at as $e,r as t,H as se,k as et,bH as je,bI as tt,K as at,bK as z,bJ as ge,aX as I,bG as pe,N as xe,Q as _e}from"../chunks/C_QN0JMx.js";import{a as qe}from"../chunks/CCQSfPwG.js";import{S as rt}from"../chunks/CIQW19Ga.js";var st=n('<div class="flex items-center justify-center py-20"><div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>'),lt=n('<div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center"><p class="text-red-600"> </p> <button class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Retry</button></div>'),it=n('<p class="text-sm text-gray-500 mb-4"> </p>'),ot=n('<div><div class="text-xs font-medium text-gray-400 uppercase mb-2">Rules</div> <div class="bg-gray-50 rounded-lg p-3 text-xs font-mono text-gray-600"><pre> </pre></div></div>'),dt=n('<button class="px-3 py-2 text-sm border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">Edit</button>'),vt=n('<div class="bg-white rounded-xl border border-gray-200 p-6 sticky top-24"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-semibold text-gray-900"> </h3> <button class="text-gray-400 hover:text-gray-600">âœ•</button></div> <!> <div class="space-y-4"><div><div class="text-xs font-medium text-gray-400 uppercase mb-1">Type</div> <div class="text-sm text-gray-900 capitalize"> </div></div> <div><div class="text-xs font-medium text-gray-400 uppercase mb-1">Users</div> <div class="text-2xl font-bold text-gray-900"> </div> <div class="text-sm text-gray-500"> </div></div> <!> <div class="pt-4 border-t border-gray-100 flex gap-2"><button class="flex-1 px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700">View Users</button> <!></div></div></div>'),nt=n('<div class="bg-gray-50 rounded-xl border border-gray-200 p-6 text-center"><div class="text-4xl mb-4">ğŸ‘†</div> <p class="text-gray-500">Select a segment to view details</p></div>'),ut=n('<div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2"><!></div> <div><!></div></div>'),ct=n('<div class="bg-gray-50 rounded-lg p-6 text-center"><p class="text-gray-500 text-sm">No rules defined. Add rules to filter users.</p></div>'),bt=n("<option> </option>"),gt=n("<option> </option>"),pt=n('<div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg"><select class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"></select> <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm"></select> <input type="text" placeholder="Value" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"/> <button class="p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg">ğŸ—‘ï¸</button></div>'),xt=n('<div class="space-y-3"></div>'),_t=n('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"><div class="p-6 border-b border-gray-100"><div class="flex items-center justify-between"><h2 class="text-xl font-bold text-gray-900">Create Segment</h2> <button class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button></div></div> <div class="p-6 space-y-6"><div class="space-y-4"><div><label class="block text-sm font-medium text-gray-700 mb-1" for="segment-name">Name</label> <input type="text" placeholder="e.g., High Value Customers" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/></div> <div><label class="block text-sm font-medium text-gray-700 mb-1" for="segment-description">Description</label> <textarea placeholder="Describe this segment..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea></div> <div><label for="segment-type" class="block text-sm font-medium text-gray-700 mb-1">Type</label> <select id="segment-type" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"><option>Dynamic (auto-updates)</option><option>Static (manual)</option><option>Computed (SQL-based)</option></select></div></div> <div><div class="flex items-center justify-between mb-3"><span class="text-sm font-medium text-gray-700">Rules</span> <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">+ Add Rule</button></div> <!></div></div> <div class="p-6 border-t border-gray-100 flex justify-end gap-3"><button class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">Create Segment</button></div></div></div>'),mt=n('<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="flex items-center justify-between mb-8"><div><h1 class="text-2xl font-bold text-gray-900">User Segments</h1> <p class="text-sm text-gray-500 mt-1">Create and manage user segments for targeted analysis</p></div> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">Create Segment</button></div> <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8"><div class="bg-white rounded-xl border border-gray-200 p-4"><div class="text-2xl font-bold text-gray-900"> </div> <div class="text-sm text-gray-500">Total Segments</div></div> <div class="bg-white rounded-xl border border-gray-200 p-4"><div class="text-2xl font-bold text-blue-600"> </div> <div class="text-sm text-gray-500">Dynamic Segments</div></div> <div class="bg-white rounded-xl border border-gray-200 p-4"><div class="text-2xl font-bold text-purple-600"> </div> <div class="text-sm text-gray-500">System Segments</div></div> <div class="bg-white rounded-xl border border-gray-200 p-4"><div class="text-2xl font-bold text-green-600"> </div> <div class="text-sm text-gray-500">Total Users Segmented</div></div></div> <!></div> <!>',1);function wt(Re,Ae){Ie(Ae,!1);let L=V([]),le=V(!0),X=V(null),B=V(!1),c=V(null),l=V({name:"",description:"",type:"dynamic",rules:[]});const De=[{value:"total_revenue",label:"Total Revenue"},{value:"order_count",label:"Order Count"},{value:"last_active_at",label:"Last Active"},{value:"days_since_signup",label:"Days Since Signup"},{value:"page_views",label:"Page Views"},{value:"session_count",label:"Session Count"},{value:"country",label:"Country"},{value:"device_type",label:"Device Type"},{value:"channel",label:"Acquisition Channel"}],Te=[{value:"=",label:"equals"},{value:"!=",label:"not equals"},{value:">",label:"greater than"},{value:">=",label:"greater or equal"},{value:"<",label:"less than"},{value:"<=",label:"less or equal"},{value:"contains",label:"contains"},{value:"not_contains",label:"does not contain"},{value:"in",label:"is one of"},{value:"not_in",label:"is not one of"}];async function ie(){x(le,!0),x(X,null);try{const s=await qe.getSegments();x(L,s.segments)}catch(s){x(X,s instanceof Error?s.message:"Failed to load segments")}finally{x(le,!1)}}function Le(s){x(c,s)}function Ue(){I(l,e(l).rules=[...e(l).rules,{field:"total_revenue",operator:">",value:""}])}function Fe(s){I(l,e(l).rules=e(l).rules.filter((b,S)=>S!==s))}async function Ne(){try{await qe.createSegment({name:e(l).name,description:e(l).description,type:e(l).type,rules:{conditions:e(l).rules}}),x(B,!1),x(l,{name:"",description:"",type:"dynamic",rules:[]}),ie()}catch(s){alert(s instanceof Error?s.message:"Failed to create segment")}}function me(){x(B,!1),x(c,null)}Xe(()=>{ie()}),Be();var ye=mt();We("1qi16j0",s=>{Ze(()=>{$e.title="User Segments | Analytics"})});var oe=Ce(ye),de=a(oe),Ve=r(a(de),2);Ve.__click=()=>x(B,!0),t(de);var ve=r(de,2),ne=a(ve),fe=a(ne),ze=a(fe,!0);t(fe),se(2),t(ne);var ue=r(ne,2),he=a(ue),Ee=a(he,!0);t(he),se(2),t(ue);var ce=r(ue,2),we=a(ce),He=a(we,!0);t(we),se(2),t(ce);var Se=r(ce,2),ke=a(Se),Me=a(ke,!0);t(ke),se(2),t(Se),t(ve);var Je=r(ve,2);{var Ke=s=>{var b=st();d(s,b)},Oe=s=>{var b=et(),S=Ce(b);{var E=k=>{var _=lt(),m=a(_),j=a(m,!0);t(m);var q=r(m,2);q.__click=ie,t(_),y(()=>g(j,e(X))),d(k,_)},W=k=>{var _=ut(),m=a(_),j=a(m);rt(j,{get segments(){return e(L)},onSelect:Le}),t(m);var q=r(m,2),H=a(q);{var M=f=>{var w=vt(),R=a(w),U=a(R),Z=a(U,!0);t(U);var J=r(U,2);J.__click=()=>x(c,null),t(R);var $=r(R,2);{var be=v=>{var i=it(),p=a(i,!0);t(i),y(()=>g(p,e(c).description)),d(v,i)};C($,v=>{e(c).description&&v(be)})}var ee=r($,2),K=a(ee),O=r(a(K),2),te=a(O,!0);t(O),t(K);var F=r(K,2),o=r(a(F),2),A=a(o,!0);t(o);var ae=r(o,2),h=a(ae);t(ae),t(F);var re=r(F,2);{var P=v=>{var i=ot(),p=r(a(i),2),u=a(p),G=a(u,!0);t(u),t(p),t(i),y(T=>g(G,T),[()=>JSON.stringify(e(c).rules,null,2)]),d(v,i)};C(re,v=>{e(c).rules&&v(P)})}var D=r(re,2),N=r(a(D),2);{var Q=v=>{var i=dt();d(v,i)};C(N,v=>{e(c).is_system||v(Q)})}t(D),t(ee),t(w),y((v,i)=>{g(Z,e(c).name),g(te,e(c).type),g(A,v),g(h,`${i??""}% of total`)},[()=>e(c).user_count.toLocaleString(),()=>e(c).percentage.toFixed(1)]),d(f,w)},Y=f=>{var w=nt();d(f,w)};C(H,f=>{e(c)?f(M):f(Y,!1)})}t(q),t(_),d(k,_)};C(S,k=>{e(X)?k(E):k(W,!1)},!0)}d(s,b)};C(Je,s=>{e(le)?s(Ke):s(Oe,!1)})}t(oe);var Pe=r(oe,2);{var Qe=s=>{var b=_t(),S=a(b),E=a(S),W=a(E),k=r(a(W),2);k.__click=me,t(W),t(E);var _=r(E,2),m=a(_),j=a(m),q=r(a(j),2);je(q),t(j);var H=r(j,2),M=r(a(H),2);tt(M),at(M,"rows",2),t(H);var Y=r(H,2),f=r(a(Y),2);y(()=>{e(l),z(()=>{})});var w=a(f);w.value=w.__value="dynamic";var R=r(w);R.value=R.__value="static";var U=r(R);U.value=U.__value="computed",t(f),t(Y),t(m);var Z=r(m,2),J=a(Z),$=r(a(J),2);$.__click=Ue,t(J);var be=r(J,2);{var ee=o=>{var A=ct();d(o,A)},K=o=>{var A=xt();xe(A,5,()=>e(l).rules,_e,(ae,h,re)=>{var P=pt(),D=a(P);y(()=>{e(h),z(()=>{})}),xe(D,5,()=>De,_e,(i,p)=>{var u=bt(),G=a(u,!0);t(u);var T={};y(()=>{g(G,e(p).label),T!==(T=e(p).value)&&(u.value=(u.__value=e(p).value)??"")}),d(i,u)}),t(D);var N=r(D,2);y(()=>{e(h),z(()=>{})}),xe(N,5,()=>Te,_e,(i,p)=>{var u=gt(),G=a(u,!0);t(u);var T={};y(()=>{g(G,e(p).label),T!==(T=e(p).value)&&(u.value=(u.__value=e(p).value)??"")}),d(i,u)}),t(N);var Q=r(N,2);je(Q);var v=r(Q,2);v.__click=()=>Fe(re),t(P),pe(D,()=>e(h).field,i=>(e(h).field=i,z(()=>e(l)))),pe(N,()=>e(h).operator,i=>(e(h).operator=i,z(()=>e(l)))),ge(Q,()=>e(h).value,i=>(e(h).value=i,z(()=>e(l)))),d(ae,P)}),t(A),d(o,A)};C(be,o=>{e(l).rules.length===0?o(ee):o(K,!1)})}t(Z),t(_);var O=r(_,2),te=a(O);te.__click=me;var F=r(te,2);F.__click=Ne,t(O),t(S),t(b),y(()=>F.disabled=!e(l).name),ge(q,()=>e(l).name,o=>I(l,e(l).name=o)),ge(M,()=>e(l).description,o=>I(l,e(l).description=o)),pe(f,()=>e(l).type,o=>I(l,e(l).type=o)),d(s,b)};C(Pe,s=>{e(B)&&s(Qe)})}y((s,b,S)=>{g(ze,e(L).length),g(Ee,s),g(He,b),g(Me,S)},[()=>e(L).filter(s=>s.type==="dynamic").length,()=>e(L).filter(s=>s.is_system).length,()=>e(L).reduce((s,b)=>s+b.user_count,0).toLocaleString()]),d(Re,ye),Ye()}Ge(["click"]);export{wt as component};
