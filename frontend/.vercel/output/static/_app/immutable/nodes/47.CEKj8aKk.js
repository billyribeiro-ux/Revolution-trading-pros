import{z as ve,p as de,o as oe,a3 as ne,f as m,a9 as ce,F as b,e as l,i as C,h as d,j as ue,as as ge,q as a,at as he,r as t,g as s,aP as L,c as i,k as q,d as I,w as J,x as h,N as me,J as pe,bU as _e,bV as be,Q as fe}from"../chunks/C_QN0JMx.js";import{e as M,A as ye}from"../chunks/BIaWRQrO.js";var Te=m('<div class="loading-state svelte-dghsiv"><div class="loader svelte-dghsiv"></div> <p>Loading templates...</p></div>'),xe=m('<div class="alert alert-error svelte-dghsiv"><div class="error-content svelte-dghsiv"><span> </span> <button class="btn-retry svelte-dghsiv">Retry</button></div></div>'),Ee=m('<div class="empty-state svelte-dghsiv"><p class="svelte-dghsiv">No templates found. Create one to get started.</p> <button class="btn-primary svelte-dghsiv">Create Template</button></div>'),ke=m('<tr class="svelte-dghsiv"><td class="svelte-dghsiv"> </td><td class="svelte-dghsiv"> </td><td class="svelte-dghsiv"> </td><td class="svelte-dghsiv"> </td><td class="svelte-dghsiv"> </td><td class="actions svelte-dghsiv"><button class="btn-secondary svelte-dghsiv" title="Preview"><!></button> <button class="btn-secondary svelte-dghsiv" title="Edit"><!></button> <button class="btn-danger svelte-dghsiv" title="Delete"><!></button></td></tr>'),Ae=m('<table class="templates-table svelte-dghsiv"><thead><tr class="svelte-dghsiv"><th class="svelte-dghsiv">Name</th><th class="svelte-dghsiv">Slug</th><th class="svelte-dghsiv">Subject</th><th class="svelte-dghsiv">Type</th><th class="svelte-dghsiv">Status</th><th class="svelte-dghsiv">Actions</th></tr></thead><tbody></tbody></table>'),we=m('<div class="templates-page svelte-dghsiv"><div class="page-header svelte-dghsiv"><h1>Email Templates</h1> <button class="btn-primary svelte-dghsiv">New Template</button></div> <!></div>');function ze(U,V){de(V,!1);let p=L([]),E=L(!0),o=L("");async function Q(){i(E,!0),i(o,"");try{const e=await M.list();i(p,e.data||[])}catch(e){if(e instanceof ye){if(e.status===401){b("/login");return}e.message.includes("SQLSTATE")||e.message.includes("Column not found")||e.message.includes("deleted_at")?i(o,"Database configuration issue. Email templates feature is being set up. Please try again later or contact support."):i(o,e.message)}else e?.message?.includes("SQLSTATE")||e?.message?.includes("deleted_at")?i(o,"Database configuration issue. Email templates feature is being set up. Please try again later or contact support."):i(o,"Failed to load templates. Please refresh the page or contact support.")}finally{i(E,!1)}}async function B(e){if(confirm("Delete this template? This action cannot be undone."))try{await M.delete(e),i(p,s(p).filter(n=>n.id!==e))}catch{alert("Failed to delete template")}}oe(Q),ne();var k=we();ce("dghsiv",e=>{ge(()=>{he.title="Email Templates | Admin | Revolution Trading Pros"})});var A=a(k),G=l(a(A),2);G.__click=()=>b("/admin/email/templates/new"),t(A);var H=l(A,2);{var K=e=>{var n=Te();d(e,n)},O=e=>{var n=q(),W=I(n);{var X=u=>{var g=xe(),f=a(g),_=a(f),w=a(_,!0);t(_);var r=l(_,2);r.__click=Q,t(f),t(g),J(()=>h(w,s(o))),d(u,g)},Y=u=>{var g=q(),f=I(g);{var _=r=>{var c=Ee(),y=l(a(c),2);y.__click=()=>b("/admin/email/templates/new"),t(c),d(r,c)},w=r=>{var c=Ae(),y=l(a(c));me(y,5,()=>s(p),fe,(Z,v)=>{var S=ke(),P=a(S),$=a(P,!0);t(P);var z=l(P),ee=a(z,!0);t(z);var D=l(z),te=a(D,!0);t(D);var F=l(D),ae=a(F,!0);t(F);var N=l(F),se=a(N,!0);t(N);var R=l(N),T=a(R);T.__click=()=>b(`/admin/email/templates/preview/${s(v).id}`);var le=a(T);pe(le,{size:18}),t(T);var x=l(T,2);x.__click=()=>b(`/admin/email/templates/edit/${s(v).id}`);var ie=a(x);_e(ie,{size:18}),t(x);var j=l(x,2);j.__click=()=>B(s(v).id);var re=a(j);be(re,{size:18}),t(j),t(R),t(S),J(()=>{h($,s(v).name),h(ee,s(v).slug),h(te,s(v).subject),h(ae,s(v).email_type),h(se,s(v).is_active?"Active":"Inactive")}),d(Z,S)}),t(y),t(c),d(r,c)};C(f,r=>{s(p).length===0?r(_):r(w,!1)},!0)}d(u,g)};C(W,u=>{s(o)?u(X):u(Y,!1)},!0)}d(e,n)};C(H,e=>{s(E)?e(K):e(O,!1)})}t(k),d(U,k),ue()}ve(["click"]);export{ze as component};
