import{z as Os,p as Fs,s as I,A as he,B as Vs,dc as Gs,o as Us,b as Is,g as e,f as _,a9 as Ns,T as Ws,i as E,F as Dt,q as r,Z as $e,e as i,dd as Ls,c as y,aB as Hs,b6 as Zs,S as Qs,M as Tt,aH as js,w as ee,D as Ys,h as u,j as Js,E as Xs,aa as Ks,as as ea,at as ta,H as m,r as a,O as ye,x as re,n as sa,d as Me,R as aa,al as it,N as oe,bx as ia,Q as le,af as ke,bW as qt,b2 as ra,bZ as oa,bH as d,bI as rt,bJ as b,bG as ue,bO as xe,bq as Ee,bM as ot,de as la,c0 as na,k as pa,df as va,U as ca,aW as ua}from"../chunks/C_QN0JMx.js";import{a as Ce,A as da,p as _a,c as ma,s as ga}from"../chunks/BIaWRQrO.js";var fa=_('<div class="preview-badge svelte-gpmfsp"><span class="preview-value svelte-gpmfsp"> </span> <span class="preview-impact svelte-gpmfsp"> </span></div>'),ba=_("<!> Creating...",1),ha=_("<!> Create Coupon",1),ya=_("<div><!> <span> </span></div>"),xa=_('<div class="alerts svelte-gpmfsp"></div>'),wa=_('<span class="tab-badge svelte-gpmfsp">ON</span>'),ka=_('<div class="input-addon svelte-gpmfsp"><!></div>'),Ca=_('<div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="bogo-buy-quantity" class="svelte-gpmfsp">Buy Quantity</label> <input id="bogo-buy-quantity" type="number" min="1" class="input svelte-gpmfsp"/></div> <div class="form-group svelte-gpmfsp"><label for="bogo-get-quantity" class="svelte-gpmfsp">Get Quantity</label> <input id="bogo-get-quantity" type="number" min="1" class="input svelte-gpmfsp"/></div> <div class="form-group svelte-gpmfsp"><label for="bogo-discount" class="svelte-gpmfsp">Discount %</label> <input id="bogo-discount" type="number" min="0" max="100" class="input svelte-gpmfsp"/></div></div>'),Sa=_('<div class="tier-row svelte-gpmfsp"><span class="tier-label svelte-gpmfsp"></span> <input type="number" placeholder="Min $" class="input input-small svelte-gpmfsp"/> <span>to</span> <input type="number" placeholder="Max $" class="input input-small svelte-gpmfsp"/> <select class="input input-small svelte-gpmfsp"><option>%</option><option>$</option></select> <input type="number" placeholder="Value" class="input input-small svelte-gpmfsp"/> <button type="button" class="btn-icon svelte-gpmfsp"><!></button></div>'),$a=_('<div class="tiered-config svelte-gpmfsp"><div class="tier-header svelte-gpmfsp"><h3 class="svelte-gpmfsp">Discount Tiers</h3> <button type="button" class="btn-small svelte-gpmfsp"><!> Add Tier</button></div> <!></div>'),Aa=_('<div class="form-group svelte-gpmfsp"><label for="max_discount" class="svelte-gpmfsp">Maximum Discount Amount ($)</label> <input type="number" id="max_discount" min="0" step="0.01" class="input svelte-gpmfsp" placeholder="No maximum"/> <p class="help-text svelte-gpmfsp">Cap the discount at this amount</p></div>'),za=_('<div class="recurrence-config svelte-gpmfsp"></div>'),Da=_('<div class="tab-content svelte-gpmfsp"><div class="form-section svelte-gpmfsp"><div class="section-header svelte-gpmfsp"><h2 class="svelte-gpmfsp">Coupon Code</h2> <div class="section-actions svelte-gpmfsp"><button type="button" class="btn-small svelte-gpmfsp"><!> Generate</button> <button type="button" class="btn-small svelte-gpmfsp"><!> Bulk Generate</button></div></div> <div class="form-group svelte-gpmfsp" data-field="code"><label for="code" class="svelte-gpmfsp">Code * <span class="label-hint svelte-gpmfsp">Unique identifier for the coupon</span></label> <div class="input-group svelte-gpmfsp"><input type="text" id="code" placeholder="SUMMER2024" required/> <!></div></div></div> <div class="form-section svelte-gpmfsp"><div class="section-header svelte-gpmfsp"><h2 class="svelte-gpmfsp">Discount Configuration</h2></div> <div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="type" class="svelte-gpmfsp">Discount Type *</label> <select id="type" class="input svelte-gpmfsp"><option>Percentage Off</option><option>Fixed Amount Off</option><option>Buy One Get One (BOGO)</option><option>Free Shipping</option><option>Tiered Discount</option></select></div></div> <!> <!> <!></div> <div class="form-section svelte-gpmfsp"><h2>Description & Notes</h2> <div class="form-group svelte-gpmfsp"><label for="description" class="svelte-gpmfsp">Public Description</label> <textarea id="description" placeholder="Summer sale - Save on all products!" class="input textarea svelte-gpmfsp" rows="3"></textarea> <p class="help-text svelte-gpmfsp">Shown to customers</p></div> <div class="form-group svelte-gpmfsp"><label for="internal_notes" class="svelte-gpmfsp">Internal Notes</label> <textarea id="internal_notes" placeholder="Created for Q3 marketing campaign..." class="input textarea svelte-gpmfsp" rows="3"></textarea> <p class="help-text svelte-gpmfsp">Only visible to administrators</p></div></div> <div class="form-section svelte-gpmfsp"><h2>Schedule</h2> <div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="starts_at" class="svelte-gpmfsp">Start Date</label> <input type="datetime-local" id="starts_at" class="input svelte-gpmfsp"/></div> <div class="form-group svelte-gpmfsp"><label for="expires_at" class="svelte-gpmfsp">Expiration Date</label> <input type="datetime-local" id="expires_at" class="input svelte-gpmfsp"/></div></div> <div class="form-group svelte-gpmfsp"><label class="toggle-label svelte-gpmfsp"><input type="checkbox" class="toggle-checkbox svelte-gpmfsp"/> <span class="toggle-switch svelte-gpmfsp"></span> <span class="toggle-text svelte-gpmfsp">Recurring coupon</span></label></div> <!></div></div>'),Ta=_("<option> </option>"),qa=_('<div class="restriction-rule svelte-gpmfsp"><select class="input input-small svelte-gpmfsp"><option>Include</option><option>Exclude</option></select> <select multiple class="input input-multi svelte-gpmfsp"></select> <button type="button" class="btn-icon svelte-gpmfsp"><!></button></div>'),Ma=_("<option> </option>"),Ea=_("<option> </option>"),Pa=_('<div class="restriction-rule svelte-gpmfsp"><select class="input input-small svelte-gpmfsp"><option>Country</option><option>State</option><option>City</option><option>ZIP Code</option></select> <select class="input input-small svelte-gpmfsp"><option>Include</option><option>Exclude</option></select> <input type="text" placeholder="Enter values separated by commas" class="input svelte-gpmfsp"/> <button type="button" class="btn-icon svelte-gpmfsp"><!></button></div>'),Ba=_('<div class="tab-content svelte-gpmfsp"><div class="form-section svelte-gpmfsp"><h2>Usage Limits</h2> <div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="max_uses" class="svelte-gpmfsp">Total Uses</label> <input type="number" id="max_uses" min="1" class="input svelte-gpmfsp" placeholder="Unlimited"/></div> <div class="form-group svelte-gpmfsp"><label for="max_uses_per_user" class="svelte-gpmfsp">Uses Per Customer</label> <input type="number" id="max_uses_per_user" min="1" class="input svelte-gpmfsp" placeholder="Unlimited"/></div></div> <div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="min_purchase" class="svelte-gpmfsp">Minimum Purchase ($)</label> <input type="number" id="min_purchase" min="0" step="0.01" class="input svelte-gpmfsp" placeholder="No minimum"/></div> <div class="form-group svelte-gpmfsp"><label for="max_purchase" class="svelte-gpmfsp">Maximum Purchase ($)</label> <input type="number" id="max_purchase" min="0" step="0.01" class="input svelte-gpmfsp" placeholder="No maximum"/></div></div> <div class="form-checkboxes svelte-gpmfsp"><label class="checkbox-label svelte-gpmfsp"><input type="checkbox"/> <span>First-time customers only</span></label> <label class="checkbox-label svelte-gpmfsp"><input type="checkbox"/> <span>Single use per customer</span></label> <label class="checkbox-label svelte-gpmfsp"><input type="checkbox"/> <span>Requires customer account</span></label></div></div> <div class="form-section svelte-gpmfsp"><div class="section-header svelte-gpmfsp"><h2 class="svelte-gpmfsp">Product Restrictions</h2> <button type="button" class="btn-small svelte-gpmfsp"><!> Add Rule</button></div> <!></div> <div class="form-section svelte-gpmfsp"><h2>Category Restrictions</h2> <div class="form-group svelte-gpmfsp"><label for="category-restrictions" class="svelte-gpmfsp">Applicable Categories</label> <select id="category-restrictions" multiple class="input input-multi svelte-gpmfsp" size="5"></select> <p class="help-text svelte-gpmfsp">Leave empty for all categories</p></div></div> <div class="form-section svelte-gpmfsp"><h2>Customer Segments</h2> <div class="form-group svelte-gpmfsp"><label for="eligible-segments" class="svelte-gpmfsp">Eligible Segments</label> <select id="eligible-segments" multiple class="input input-multi svelte-gpmfsp" size="5"></select></div></div> <div class="form-section svelte-gpmfsp"><div class="section-header svelte-gpmfsp"><h2 class="svelte-gpmfsp">Geographic Restrictions</h2> <button type="button" class="btn-small svelte-gpmfsp"><!> Add Location</button></div> <!></div></div>'),Ra=_("<option> </option>"),Oa=_('<div class="form-group svelte-gpmfsp"><label for="stackable-with" class="svelte-gpmfsp">Stackable With</label> <select id="stackable-with" multiple class="input input-multi svelte-gpmfsp" size="5"></select></div>'),Fa=_('<div class="tab-content svelte-gpmfsp"><div class="form-section svelte-gpmfsp"><h2>Stacking Rules</h2> <div class="form-group svelte-gpmfsp"><label class="toggle-label svelte-gpmfsp"><input type="checkbox" class="toggle-checkbox svelte-gpmfsp"/> <span class="toggle-switch svelte-gpmfsp"></span> <span class="toggle-text svelte-gpmfsp">Can be combined with other coupons</span></label></div> <!> <div class="form-group svelte-gpmfsp"><label for="priority" class="svelte-gpmfsp">Priority</label> <input type="number" id="priority" min="0" max="100" class="input svelte-gpmfsp"/> <p class="help-text svelte-gpmfsp">Higher priority coupons are applied first</p></div></div> <div class="form-section svelte-gpmfsp"><h2>Auto-Apply Settings</h2> <div class="form-checkboxes svelte-gpmfsp"><label class="checkbox-label svelte-gpmfsp"><input type="checkbox"/> <span>Automatically apply when conditions are met</span></label> <label class="checkbox-label svelte-gpmfsp"><input type="checkbox"/> <span>Hidden coupon (not shown in lists)</span></label></div></div> <div class="form-section svelte-gpmfsp"><h2>Tags & Metadata</h2> <div class="form-group svelte-gpmfsp"><label for="tags" class="svelte-gpmfsp">Tags</label> <input type="text" id="tags" placeholder="summer, sale, vip (comma-separated)" class="input svelte-gpmfsp"/></div></div></div>'),Va=_('<label class="channel-option svelte-gpmfsp"><input type="checkbox" class="svelte-gpmfsp"/> <span class="channel-label svelte-gpmfsp"><!> </span></label>'),Ga=_('<div class="tab-content svelte-gpmfsp"><div class="form-section svelte-gpmfsp"><h2>Distribution Channels</h2> <div class="channels-grid svelte-gpmfsp"></div></div> <div class="form-section svelte-gpmfsp"><h2>Email Domain Restrictions</h2> <div class="form-group svelte-gpmfsp"><label for="email-domains" class="svelte-gpmfsp">Allowed Email Domains</label> <textarea id="email-domains" placeholder="gmail.com company.com university.edu" class="input textarea svelte-gpmfsp" rows="4"></textarea> <p class="help-text svelte-gpmfsp">One domain per line. Leave empty to allow all.</p></div></div> <div class="form-section svelte-gpmfsp"><h2>UTM Tracking</h2> <div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="utm-source" class="svelte-gpmfsp">Source</label> <input id="utm-source" type="text" placeholder="newsletter" class="input svelte-gpmfsp"/></div> <div class="form-group svelte-gpmfsp"><label for="utm-medium" class="svelte-gpmfsp">Medium</label> <input id="utm-medium" type="text" placeholder="email" class="input svelte-gpmfsp"/></div></div> <div class="form-row svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="utm-campaign" class="svelte-gpmfsp">Campaign</label> <input id="utm-campaign" type="text" placeholder="summer_sale" class="input svelte-gpmfsp"/></div> <div class="form-group svelte-gpmfsp"><label for="utm-content" class="svelte-gpmfsp">Content</label> <input id="utm-content" type="text" placeholder="header_banner" class="input svelte-gpmfsp"/></div></div></div></div>'),Ua=_('<button type="button" class="btn-icon svelte-gpmfsp"><!></button>'),Ia=_('<div class="variant-row svelte-gpmfsp"><input type="text" placeholder="Variant name" class="input input-small svelte-gpmfsp"/> <select class="input input-small svelte-gpmfsp"><option>%</option><option>$</option></select> <input type="number" placeholder="Value" class="input input-small svelte-gpmfsp"/> <input type="number" placeholder="Weight %" min="0" max="100" class="input input-small svelte-gpmfsp"/> <!></div>'),Na=_(`<div class="ab-test-config svelte-gpmfsp"><div class="form-group svelte-gpmfsp"><label for="control-group-size" class="svelte-gpmfsp">Control Group Size (%)</label> <input id="control-group-size" type="number" min="0" max="50" class="input svelte-gpmfsp"/> <p class="help-text svelte-gpmfsp">Percentage of users who won't see the coupon</p></div> <div class="variants-section svelte-gpmfsp"><div class="section-header svelte-gpmfsp"><h3>Variants</h3> <button type="button" class="btn-small svelte-gpmfsp"><!> Add Variant</button></div> <!> <button type="button" class="btn-small svelte-gpmfsp"><!> Auto-Balance Weights</button></div></div>`),Wa=_("<!> <span> </span>",1),La=_("<!> <span> </span>",1),Ha=_('<div class="test-scenario svelte-gpmfsp"><h4 class="svelte-gpmfsp"> </h4> <div><!></div></div>'),Za=_('<div class="form-section svelte-gpmfsp"><h2>Test Results</h2> <div class="test-results svelte-gpmfsp"></div></div>'),Qa=_('<div class="tab-content svelte-gpmfsp"><div class="form-section svelte-gpmfsp"><h2>A/B Test Configuration</h2> <div class="form-group svelte-gpmfsp"><label class="toggle-label svelte-gpmfsp"><input type="checkbox" class="toggle-checkbox svelte-gpmfsp"/> <span class="toggle-switch svelte-gpmfsp"></span> <span class="toggle-text svelte-gpmfsp">Enable A/B testing for this coupon</span></label></div> <!></div> <!></div>'),ja=_('<div class="admin-page svelte-gpmfsp"><div class="page-header svelte-gpmfsp"><div class="header-content svelte-gpmfsp"><div class="header-main svelte-gpmfsp"><h1 class="svelte-gpmfsp"><!> Create Coupon</h1> <p class="svelte-gpmfsp">Configure advanced discount rules and distribution</p></div> <!></div> <div class="header-actions svelte-gpmfsp"><button class="btn-ghost svelte-gpmfsp"><!> Cancel</button> <button class="btn-secondary svelte-gpmfsp"><!> Test</button> <button class="btn-primary svelte-gpmfsp"><!></button></div></div> <!> <div class="tabs svelte-gpmfsp"><button><!> Basic</button> <button><!> Restrictions</button> <button><!> Advanced</button> <button><!> Distribution</button> <button><!> A/B Testing <!></button></div> <form class="coupon-form svelte-gpmfsp"><!> <!> <!> <!> <!></form></div>');function ei(Mt,Et){Fs(Et,!0);const Pt=()=>Vs(Ks,"$page",Bt),[Bt,Rt]=Xs(),Ot=[];let Pe=I(!1),Ue=I(!1),Ie=I(!1),me=I(he([])),N=I("basic"),Ft=I(!1),Vt=I(!1),Ne=Pt().url.searchParams.get("duplicate"),t=I(he({code:"",type:"percentage",value:0,description:"",internal_notes:"",tiers:[],bogo_config:{buy_quantity:1,get_quantity:1,get_discount:100,apply_to:"cheapest",same_product_only:!1},max_discount_amount:null,max_uses:null,max_uses_per_user:null,min_purchase_amount:null,max_purchase_amount:null,first_time_only:!1,single_use:!1,starts_at:"",expires_at:"",timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,recurring:!1,recurrence_pattern:void 0,product_restrictions:[],category_restrictions:[],user_segments:[],geographic_restrictions:[],device_restrictions:[],payment_method_restrictions:[],stackable:!1,stackable_with:[],priority:0,requires_account:!1,auto_apply:!1,hidden:!1,ab_test_enabled:!1,ab_variants:[],control_group_percentage:10,distribution_channels:[],email_domains:[],referral_sources:[],utm_parameters:{},is_active:!0,approval_required:!1,approved_by:null,approved_at:null,tags:[],meta:{}})),lt=I(he([])),nt=I(he([])),pt=I(he([])),vt=I(he([])),We=I(null);I(he([])),I(he([]));let Be=I(null);const Gt=Gs();Us(async()=>{await Ut(),Ne&&await It();const s=new Date;e(t).starts_at=dt(s);const o=new Date;o.setMonth(o.getMonth()+1),e(t).expires_at=dt(o),Kt()});async function Ut(){try{const[s,o,l,p]=await Promise.all([_a.list({limit:1e3}),ma.list({limit:100}),ga.list({limit:100}),Ce.list({limit:1e3,active:!0})]);y(lt,s.data,!0),y(nt,o.data,!0),y(pt,l.data,!0),y(vt,p.data.filter(v=>v.stackable),!0)}catch{}}async function It(){try{const o=(await Ce.get(parseInt(Ne))).data;y(t,{...e(t),...o,code:`${o.code}_COPY`,is_active:!1,max_uses:null,approved_by:null,approved_at:null},!0)}catch{}}async function ct(){y(me,[],!0);const s=await Nt();if(s.length>0){y(me,s,!0);const o=s.find(l=>l.severity==="error");if(o){us(o.field);return}}y(Pe,!0);try{const o=ns(),l=await Ce.create(o);e(t).type,e(t).value,ps(),e(t).ab_test_enabled,Gt("created",l),vs()?(cs(),void 0):Dt("/admin/coupons")}catch(o){o instanceof da?ds(o):y(me,[{field:"general",message:"Failed to create coupon",severity:"error"}],!0)}finally{y(Pe,!1)}}async function Nt(){const s=[];if(e(t).code.trim()?/^[A-Z0-9_-]+$/i.test(e(t).code)||s.push({field:"code",message:"Code can only contain letters, numbers, dashes and underscores",severity:"error"}):s.push({field:"code",message:"Coupon code is required",severity:"error"}),e(t).code&&!Ne&&await Wt(e(t).code)&&s.push({field:"code",message:"This code already exists",severity:"error"}),e(t).value<=0&&e(t).type!=="free_shipping"&&s.push({field:"value",message:"Value must be greater than 0",severity:"error"}),e(t).type==="percentage"&&e(t).value>100&&s.push({field:"value",message:"Percentage cannot exceed 100%",severity:"error"}),e(t).starts_at&&e(t).expires_at){const o=new Date(e(t).starts_at),l=new Date(e(t).expires_at);l<=o&&s.push({field:"expires_at",message:"Expiration must be after start date",severity:"error"}),l<new Date&&s.push({field:"expires_at",message:"Expiration date is in the past",severity:"warning"})}return e(t).max_uses_per_user&&e(t).max_uses&&e(t).max_uses_per_user>e(t).max_uses&&s.push({field:"max_uses_per_user",message:"Per-user limit cannot exceed total limit",severity:"error"}),e(t).min_purchase_amount&&e(t).max_purchase_amount&&e(t).min_purchase_amount>=e(t).max_purchase_amount&&s.push({field:"max_purchase_amount",message:"Maximum must be greater than minimum",severity:"error"}),e(t).type==="tiered"&&e(t).tiers&&s.push(...Lt(e(t).tiers)),e(t).type==="bogo"&&e(t).bogo_config&&s.push(...Ht(e(t).bogo_config)),e(t).ab_test_enabled&&s.push(...Zt(e(t).ab_variants)),e(t).product_restrictions.length>0&&s.push(...Qt(e(t).product_restrictions)),e(t).stackable&&e(t).stackable_with.length===0&&s.push({field:"stackable_with",message:"Select coupons that can stack with this one",severity:"warning"}),s}async function Wt(s){try{return(await Ce.checkCode(s)).data.exists}catch{return!1}}function Lt(s){const o=[];s.length===0&&o.push({field:"tiers",message:"At least one tier is required",severity:"error"});const l=[...s].sort((p,v)=>p.min_amount-v.min_amount);for(let p=0;p<l.length;p++){const v=l[p];if(v.min_amount>=v.max_amount&&o.push({field:`tier_${p}`,message:`Tier ${p+1}: Max must be greater than min`,severity:"error"}),p>0){const x=l[p-1];v.min_amount<x.max_amount&&o.push({field:`tier_${p}`,message:`Tier ${p+1} overlaps with previous tier`,severity:"error"})}}return o}function Ht(s){const o=[];return s.buy_quantity<=0&&o.push({field:"bogo_buy",message:"Buy quantity must be positive",severity:"error"}),s.get_quantity<=0&&o.push({field:"bogo_get",message:"Get quantity must be positive",severity:"error"}),(s.get_discount<0||s.get_discount>100)&&o.push({field:"bogo_discount",message:"Discount must be between 0-100%",severity:"error"}),o}function Zt(s){const o=[];s.length<2&&o.push({field:"ab_variants",message:"At least 2 variants required for A/B testing",severity:"error"});const l=s.reduce((p,v)=>p+v.weight,0);return Math.abs(l-100)>.01&&o.push({field:"ab_variants",message:"Variant weights must sum to 100%",severity:"error"}),o}function Qt(s){const o=[],l=s.some(v=>v.type==="include"),p=s.some(v=>v.type==="exclude");return l&&p&&o.push({field:"product_restrictions",message:"Cannot mix include and exclude rules",severity:"error"}),o}async function jt(){y(Ue,!0);try{const s=await Ce.generateCode({prefix:e(t).code||"PROMO",length:8,count:1});e(t).code=s.data.codes[0]}catch{}finally{y(Ue,!1)}}async function Yt(){y(Vt,!0)}async function Jt(){y(Ie,!0),y(Be,null);try{const s=await Ce.test({...e(t),test_scenarios:[{cart_total:50,user_type:"new",products:[]},{cart_total:100,user_type:"existing",products:[]},{cart_total:200,user_type:"vip",products:[]}]});y(Be,s.data,!0),y(Ft,!0)}catch{}finally{y(Ie,!1)}}async function Xt(){if(e(t).code)try{const s=await Ce.preview(e(t));y(We,s.data,!0)}catch{}}function Kt(){e(t).ab_variants.length===0&&(e(t).ab_variants=[{id:Le(),name:"Control",type:e(t).type,value:e(t).value,weight:50,is_control:!0},{id:Le(),name:"Variant A",type:e(t).type,value:e(t).value*1.2,weight:50,is_control:!1}])}function es(){const s=e(t).ab_variants.reduce((o,l)=>o+l.weight,0);e(t).ab_variants=[...e(t).ab_variants,{id:Le(),name:`Variant ${String.fromCharCode(65+e(t).ab_variants.length-1)}`,type:e(t).type,value:e(t).value,weight:Math.max(0,100-s),is_control:!1}]}function ts(s){e(t).ab_variants=e(t).ab_variants.filter(o=>o.id!==s),ut()}function ut(){if(e(t).ab_variants.length===0)return;const s=100/e(t).ab_variants.length;e(t).ab_variants=e(t).ab_variants.map(o=>({...o,weight:s}))}function ss(s){e(t).product_restrictions=[...e(t).product_restrictions,{type:s,product_ids:[],variant_ids:[]}]}function as(s){e(t).product_restrictions=e(t).product_restrictions.filter((o,l)=>l!==s)}function is(){e(t).geographic_restrictions=[...e(t).geographic_restrictions,{type:"country",values:[],include:!0}]}function rs(s){e(t).geographic_restrictions=e(t).geographic_restrictions.filter((o,l)=>l!==s)}function os(){e(t).tiers||(e(t).tiers=[]);const s=e(t).tiers[e(t).tiers.length-1],o=s?s.max_amount:0;e(t).tiers=[...e(t).tiers,{min_amount:o,max_amount:o+50,discount_value:10,discount_type:"percentage"}]}function ls(s){e(t).tiers&&(e(t).tiers=e(t).tiers.filter((o,l)=>l!==s))}function ns(){const s={...e(t)};return Object.keys(s).forEach(o=>{(s[o]===null||s[o]===void 0||s[o]==="")&&delete s[o]}),s.product_restrictions?.length===0&&delete s.product_restrictions,s.category_restrictions?.length===0&&delete s.category_restrictions,s.user_segments?.length===0&&delete s.user_segments,s.starts_at&&(s.starts_at=new Date(s.starts_at).toISOString()),s.expires_at&&(s.expires_at=new Date(s.expires_at).toISOString()),s}function dt(s){const o=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),p=String(s.getDate()).padStart(2,"0"),v=String(s.getHours()).padStart(2,"0"),x=String(s.getMinutes()).padStart(2,"0");return`${o}-${l}-${p}T${v}:${x}`}function Le(){return Math.random().toString(36).substr(2,9)}function ps(){return e(t).product_restrictions.length>0||e(t).category_restrictions.length>0||e(t).user_segments.length>0||e(t).geographic_restrictions.length>0}function vs(){return new URLSearchParams(window.location.search).get("create_another")==="true"}function cs(){y(t,{...e(t),code:"",description:"",internal_notes:"",max_uses:null,tags:[]},!0)}function us(s){document.querySelector(`[data-field="${s}"]`)?.scrollIntoView({behavior:"smooth",block:"center"})}function ds(s){s.isValidationError&&s.validationErrors?y(me,Object.entries(s.validationErrors).flatMap(([o,l])=>l.map(p=>({field:o,message:p,severity:"error"}))),!0):y(me,[{field:"general",message:s.message,severity:"error"}],!0)}function Ya(s,o){}function Ja(s,o){}Is(()=>{e(t).code&&Xt()});let _s=sa(()=>e(t).type==="percentage"?`${e(t).value}% off`:e(t).type==="fixed"?`$${e(t).value} off`:e(t).type==="bogo"?`Buy ${e(t).bogo_config?.buy_quantity||1} Get ${e(t).bogo_config?.get_quantity||1}`:e(t).type==="free_shipping"?"Free Shipping":"Tiered Discount");var He=ja();Ns("gpmfsp",s=>{ea(()=>{ta.title="Create Coupon | Enterprise Admin"})});var Ze=r(He),Qe=r(Ze),je=r(Qe),_t=r(je),ms=r(_t);Ws(ms,{size:32}),m(),a(_t),m(2),a(je);var gs=i(je,2);{var fs=s=>{var o=fa(),l=r(o),p=r(l,!0);a(l);var v=i(l,2),x=r(v);a(v),a(o),ee(()=>{re(p,e(_s)),re(x,`~$${e(We).revenue_impact??""} impact`)}),u(s,o)};E(gs,s=>{e(We)&&s(fs)})}a(Qe);var mt=i(Qe,2),Re=r(mt);Re.__click=()=>Dt("/admin/coupons");var bs=r(Re);$e(bs,{size:18}),m(),a(Re);var Ae=i(Re,2);Ae.__click=Jt;var hs=r(Ae);Ls(hs,{size:18}),m(),a(Ae);var Oe=i(Ae,2);Oe.__click=ct;var ys=r(Oe);{var xs=s=>{var o=ba(),l=Me(o);aa(l,{size:18,class:"spinning"}),m(),u(s,o)},ws=s=>{var o=ha(),l=Me(o);it(l,{size:18}),m(),u(s,o)};E(ys,s=>{e(Pe)?s(xs):s(ws,!1)})}a(Oe),a(mt),a(Ze);var gt=i(Ze,2);{var ks=s=>{var o=xa();oe(o,21,()=>e(me),le,(l,p)=>{var v=ya(),x=r(v);ia(x,{size:20});var W=i(x,2),L=r(W,!0);a(W),a(v),ee(()=>{ye(v,1,`alert alert-${e(p).severity??""}`,"svelte-gpmfsp"),re(L,e(p).message)}),u(l,v)}),a(o),ke(3,o,()=>qt,()=>({duration:300})),u(s,o)};E(gt,s=>{e(me).length>0&&s(ks)})}var Ye=i(gt,2),ze=r(Ye);let ft;ze.__click=()=>y(N,"basic");var Cs=r(ze);Hs(Cs,{size:18}),m(),a(ze);var De=i(ze,2);let bt;De.__click=()=>y(N,"restrictions");var Ss=r(De);Zs(Ss,{size:18}),m(),a(De);var Te=i(De,2);let ht;Te.__click=()=>y(N,"advanced");var $s=r(Te);Qs($s,{size:18}),m(),a(Te);var qe=i(Te,2);let yt;qe.__click=()=>y(N,"distribution");var As=r(qe);Tt(As,{size:18}),m(),a(qe);var Fe=i(qe,2);let xt;Fe.__click=()=>y(N,"testing");var wt=r(Fe);js(wt,{size:18});var zs=i(wt,2);{var Ds=s=>{var o=wa();u(s,o)};E(zs,s=>{e(t).ab_test_enabled&&s(Ds)})}a(Fe),a(Ye);var Je=i(Ye,2),kt=r(Je);{var Ts=s=>{var o=Da(),l=r(o),p=r(l),v=i(r(p),2),x=r(v);x.__click=jt;var W=r(x);ra(W,{size:16}),m(),a(x);var L=i(x,2);L.__click=Yt;var Y=r(L);oa(Y,{size:16}),m(),a(L),a(v),a(p);var H=i(p,2),A=i(r(H),2),z=r(A);d(z);let R;z.__input=()=>e(t).code=e(t).code.toUpperCase();var Z=i(z,2);{var D=n=>{var k=ka(),T=r(k);it(T,{size:16,class:"text-green"}),a(k),u(n,k)};E(Z,n=>{e(t).code&&n(D)})}a(A),a(H),a(l);var P=i(l,2),q=i(r(P),2),Q=r(q),f=i(r(Q),2),c=r(f);c.value=c.__value="percentage";var O=i(c);O.value=O.__value="fixed";var C=i(O);C.value=C.__value="bogo";var h=i(C);h.value=h.__value="free_shipping";var B=i(h);B.value=B.__value="tiered",a(f),a(Q),a(q);var S=i(q,2);{var F=n=>{var k=Ca(),T=r(k),X=i(r(T),2);d(X),a(T);var ve=i(T,2),ce=i(r(ve),2);d(ce),a(ve);var Ve=i(ve,2),ie=i(r(Ve),2);d(ie),a(Ve),a(k),b(X,()=>e(t).bogo_config.buy_quantity,be=>e(t).bogo_config.buy_quantity=be),b(ce,()=>e(t).bogo_config.get_quantity,be=>e(t).bogo_config.get_quantity=be),b(ie,()=>e(t).bogo_config.get_discount,be=>e(t).bogo_config.get_discount=be),ke(3,k,()=>qt),u(n,k)};E(S,n=>{e(t).type==="bogo"&&n(F)})}var M=i(S,2);{var j=n=>{var k=$a(),T=r(k),X=i(r(T),2);X.__click=os;var ve=r(X);ot(ve,{size:16}),m(),a(X),a(T);var ce=i(T,2);oe(ce,17,()=>e(t).tiers||[],le,(Ve,ie,be)=>{var Xe=Sa(),At=r(Xe);At.textContent=`Tier ${be+1}`;var Ke=i(At,2);d(Ke);var et=i(Ke,4);d(et);var Ge=i(et,2),tt=r(Ge);tt.value=tt.__value="percentage";var zt=i(tt);zt.value=zt.__value="fixed",a(Ge);var st=i(Ge,2);d(st);var at=i(st,2);at.__click=()=>ls(be);var Rs=r(at);$e(Rs,{size:16}),a(at),a(Xe),b(Ke,()=>e(ie).min_amount,we=>e(ie).min_amount=we),b(et,()=>e(ie).max_amount,we=>e(ie).max_amount=we),ue(Ge,()=>e(ie).discount_type,we=>e(ie).discount_type=we),b(st,()=>e(ie).discount_value,we=>e(ie).discount_value=we),u(Ve,Xe)}),a(k),u(n,k)};E(M,n=>{e(t).type==="tiered"&&n(j)})}var V=i(M,2);{var te=n=>{var k=Aa(),T=i(r(k),2);d(T),m(2),a(k),b(T,()=>e(t).max_discount_amount,X=>e(t).max_discount_amount=X),u(n,k)};E(V,n=>{(e(t).type==="percentage"||e(t).type==="fixed")&&n(te)})}a(P);var K=i(P,2),ne=i(r(K),2),pe=i(r(ne),2);rt(pe),m(2),a(ne);var w=i(ne,2),de=i(r(w),2);rt(de),m(2),a(w),a(K);var Se=i(K,2),g=i(r(Se),2),$=r(g),G=i(r($),2);d(G),a($);var J=i($,2),U=i(r(J),2);d(U),a(J),a(g);var se=i(g,2),_e=r(se),ae=r(_e);d(ae),m(4),a(_e),a(se);var ge=i(se,2);{var fe=n=>{var k=za();u(n,k)};E(ge,n=>{e(t).recurring&&n(fe)})}a(Se),a(o),ee(n=>{x.disabled=e(Ue),R=ye(z,1,"input input-large svelte-gpmfsp",null,R,n)},[()=>({error:e(me).some(n=>n.field==="code")})]),b(z,()=>e(t).code,n=>e(t).code=n),ue(f,()=>e(t).type,n=>e(t).type=n),b(pe,()=>e(t).description,n=>e(t).description=n),b(de,()=>e(t).internal_notes,n=>e(t).internal_notes=n),b(G,()=>e(t).starts_at,n=>e(t).starts_at=n),b(U,()=>e(t).expires_at,n=>e(t).expires_at=n),xe(ae,()=>e(t).recurring,n=>e(t).recurring=n),ke(3,o,()=>Ee,()=>({duration:200})),u(s,o)};E(kt,s=>{e(N)==="basic"&&s(Ts)})}var Ct=i(kt,2);{var qs=s=>{var o=Ba(),l=r(o),p=i(r(l),2),v=r(p),x=i(r(v),2);d(x),a(v);var W=i(v,2),L=i(r(W),2);d(L),a(W),a(p);var Y=i(p,2),H=r(Y),A=i(r(H),2);d(A),a(H);var z=i(H,2),R=i(r(z),2);d(R),a(z),a(Y);var Z=i(Y,2),D=r(Z),P=r(D);d(P),m(2),a(D);var q=i(D,2),Q=r(q);d(Q),m(2),a(q);var f=i(q,2),c=r(f);d(c),m(2),a(f),a(Z),a(l);var O=i(l,2),C=r(O),h=i(r(C),2);h.__click=()=>ss("include");var B=r(h);ot(B,{size:16}),m(),a(h),a(C);var S=i(C,2);oe(S,17,()=>e(t).product_restrictions,le,(g,$,G)=>{var J=qa(),U=r(J),se=r(U);se.value=se.__value="include";var _e=i(se);_e.value=_e.__value="exclude",a(U);var ae=i(U,2);oe(ae,21,()=>e(lt),le,(n,k)=>{var T=Ta(),X=r(T,!0);a(T);var ve={};ee(()=>{re(X,e(k).name),ve!==(ve=e(k).id)&&(T.value=(T.__value=e(k).id)??"")}),u(n,T)}),a(ae);var ge=i(ae,2);ge.__click=()=>as(G);var fe=r(ge);$e(fe,{size:16}),a(ge),a(J),ue(U,()=>e($).type,n=>e($).type=n),ue(ae,()=>e($).product_ids,n=>e($).product_ids=n),u(g,J)}),a(O);var F=i(O,2),M=i(r(F),2),j=i(r(M),2);oe(j,21,()=>e(nt),le,(g,$)=>{var G=Ma(),J=r(G,!0);a(G);var U={};ee(()=>{re(J,e($).name),U!==(U=e($).id)&&(G.value=(G.__value=e($).id)??"")}),u(g,G)}),a(j),m(2),a(M),a(F);var V=i(F,2),te=i(r(V),2),K=i(r(te),2);oe(K,21,()=>e(pt),le,(g,$)=>{var G=Ea(),J=r(G,!0);a(G);var U={};ee(()=>{re(J,e($).name),U!==(U=e($).id)&&(G.value=(G.__value=e($).id)??"")}),u(g,G)}),a(K),a(te),a(V);var ne=i(V,2),pe=r(ne),w=i(r(pe),2);w.__click=is;var de=r(w);la(de,{size:16}),m(),a(w),a(pe);var Se=i(pe,2);oe(Se,17,()=>e(t).geographic_restrictions,le,(g,$,G)=>{var J=Pa(),U=r(J),se=r(U);se.value=se.__value="country";var _e=i(se);_e.value=_e.__value="state";var ae=i(_e);ae.value=ae.__value="city";var ge=i(ae);ge.value=ge.__value="zip",a(U);var fe=i(U,2),n=r(fe);n.value=n.__value=!0;var k=i(n);k.value=k.__value=!1,a(fe);var T=i(fe,2);d(T);var X=i(T,2);X.__click=()=>rs(G);var ve=r(X);$e(ve,{size:16}),a(X),a(J),ue(U,()=>e($).type,ce=>e($).type=ce),ue(fe,()=>e($).include,ce=>e($).include=ce),b(T,()=>e($).values,ce=>e($).values=ce),u(g,J)}),a(ne),a(o),b(x,()=>e(t).max_uses,g=>e(t).max_uses=g),b(L,()=>e(t).max_uses_per_user,g=>e(t).max_uses_per_user=g),b(A,()=>e(t).min_purchase_amount,g=>e(t).min_purchase_amount=g),b(R,()=>e(t).max_purchase_amount,g=>e(t).max_purchase_amount=g),xe(P,()=>e(t).first_time_only,g=>e(t).first_time_only=g),xe(Q,()=>e(t).single_use,g=>e(t).single_use=g),xe(c,()=>e(t).requires_account,g=>e(t).requires_account=g),ue(j,()=>e(t).category_restrictions,g=>e(t).category_restrictions=g),ue(K,()=>e(t).user_segments,g=>e(t).user_segments=g),ke(3,o,()=>Ee,()=>({duration:200})),u(s,o)};E(Ct,s=>{e(N)==="restrictions"&&s(qs)})}var St=i(Ct,2);{var Ms=s=>{var o=Fa(),l=r(o),p=i(r(l),2),v=r(p),x=r(v);d(x),m(4),a(v),a(p);var W=i(p,2);{var L=c=>{var O=Oa(),C=i(r(O),2);oe(C,21,()=>e(vt),le,(h,B)=>{var S=Ra(),F=r(S);a(S);var M={};ee(()=>{re(F,`${e(B).code??""} - ${e(B).description??""}`),M!==(M=e(B).code)&&(S.value=(S.__value=e(B).code)??"")}),u(h,S)}),a(C),a(O),ue(C,()=>e(t).stackable_with,h=>e(t).stackable_with=h),u(c,O)};E(W,c=>{e(t).stackable&&c(L)})}var Y=i(W,2),H=i(r(Y),2);d(H),m(2),a(Y),a(l);var A=i(l,2),z=i(r(A),2),R=r(z),Z=r(R);d(Z),m(2),a(R);var D=i(R,2),P=r(D);d(P),m(2),a(D),a(z),a(A);var q=i(A,2),Q=i(r(q),2),f=i(r(Q),2);d(f),a(Q),a(q),a(o),xe(x,()=>e(t).stackable,c=>e(t).stackable=c),b(H,()=>e(t).priority,c=>e(t).priority=c),xe(Z,()=>e(t).auto_apply,c=>e(t).auto_apply=c),xe(P,()=>e(t).hidden,c=>e(t).hidden=c),b(f,()=>e(t).tags,c=>e(t).tags=c),ke(3,o,()=>Ee,()=>({duration:200})),u(s,o)};E(St,s=>{e(N)==="advanced"&&s(Ms)})}var $t=i(St,2);{var Es=s=>{var o=Ga(),l=r(o),p=i(r(l),2);oe(p,20,()=>["email","sms","social","affiliate","influencer","partner"],le,(f,c)=>{var O=Va(),C=r(O);d(C);var h,B=i(C,2),S=r(B);{var F=V=>{Tt(V,{size:20})},M=V=>{var te=pa(),K=Me(te);{var ne=w=>{va(w,{size:20})},pe=w=>{ca(w,{size:20})};E(K,w=>{c==="social"?w(ne):w(pe,!1)},!0)}u(V,te)};E(S,V=>{c==="email"?V(F):V(M,!1)})}var j=i(S);a(B),a(O),ee(V=>{h!==(h=c)&&(C.value=(C.__value=c)??""),re(j,` ${V??""}`)},[()=>c.charAt(0).toUpperCase()+c.slice(1)]),na(Ot,[],C,()=>e(t).distribution_channels,V=>e(t).distribution_channels=V),u(f,O)}),a(p),a(l);var v=i(l,2),x=i(r(v),2),W=i(r(x),2);rt(W),m(2),a(x),a(v);var L=i(v,2),Y=i(r(L),2),H=r(Y),A=i(r(H),2);d(A),a(H);var z=i(H,2),R=i(r(z),2);d(R),a(z),a(Y);var Z=i(Y,2),D=r(Z),P=i(r(D),2);d(P),a(D);var q=i(D,2),Q=i(r(q),2);d(Q),a(q),a(Z),a(L),a(o),b(W,()=>e(t).email_domains,f=>e(t).email_domains=f),b(A,()=>e(t).utm_parameters.source,f=>e(t).utm_parameters.source=f),b(R,()=>e(t).utm_parameters.medium,f=>e(t).utm_parameters.medium=f),b(P,()=>e(t).utm_parameters.campaign,f=>e(t).utm_parameters.campaign=f),b(Q,()=>e(t).utm_parameters.content,f=>e(t).utm_parameters.content=f),ke(3,o,()=>Ee,()=>({duration:200})),u(s,o)};E($t,s=>{e(N)==="distribution"&&s(Es)})}var Ps=i($t,2);{var Bs=s=>{var o=Qa(),l=r(o),p=i(r(l),2),v=r(p),x=r(v);d(x),m(4),a(v),a(p);var W=i(p,2);{var L=A=>{var z=Na(),R=r(z),Z=i(r(R),2);d(Z),m(2),a(R);var D=i(R,2),P=r(D),q=i(r(P),2);q.__click=es;var Q=r(q);ot(Q,{size:16}),m(),a(q),a(P);var f=i(P,2);oe(f,17,()=>e(t).ab_variants,le,(C,h,B)=>{var S=Ia(),F=r(S);d(F);var M=i(F,2),j=r(M);j.value=j.__value="percentage";var V=i(j);V.value=V.__value="fixed",a(M);var te=i(M,2);d(te);var K=i(te,2);d(K);var ne=i(K,2);{var pe=w=>{var de=Ua();de.__click=()=>ts(e(h).id);var Se=r(de);$e(Se,{size:16}),a(de),u(w,de)};E(ne,w=>{e(h).is_control||w(pe)})}a(S),b(F,()=>e(h).name,w=>e(h).name=w),ue(M,()=>e(h).type,w=>e(h).type=w),b(te,()=>e(h).value,w=>e(h).value=w),b(K,()=>e(h).weight,w=>e(h).weight=w),u(C,S)});var c=i(f,2);c.__click=ut;var O=r(c);ua(O,{size:16}),m(),a(c),a(D),a(z),b(Z,()=>e(t).control_group_percentage,C=>e(t).control_group_percentage=C),u(A,z)};E(W,A=>{e(t).ab_test_enabled&&A(L)})}a(l);var Y=i(l,2);{var H=A=>{var z=Za(),R=i(r(z),2);oe(R,21,()=>e(Be).scenarios,le,(Z,D)=>{var P=Ha(),q=r(P),Q=r(q);a(q);var f=i(q,2);let c;var O=r(f);{var C=B=>{var S=Wa(),F=Me(S);it(F,{size:16});var M=i(F,2),j=r(M);a(M),ee(()=>re(j,`Discount: $${e(D).discount_amount??""}`)),u(B,S)},h=B=>{var S=La(),F=Me(S);$e(F,{size:16});var M=i(F,2),j=r(M);a(M),ee(()=>re(j,`Not applicable: ${e(D).reason??""}`)),u(B,S)};E(O,B=>{e(D).applicable?B(C):B(h,!1)})}a(f),a(P),ee(()=>{re(Q,`Cart: $${e(D).cart_total??""} | User: ${e(D).user_type??""}`),c=ye(f,1,"scenario-result svelte-gpmfsp",null,c,{success:e(D).applicable})}),u(Z,P)}),a(R),a(z),u(A,z)};E(Y,A=>{e(Be)&&A(H)})}a(o),xe(x,()=>e(t).ab_test_enabled,A=>e(t).ab_test_enabled=A),ke(3,o,()=>Ee,()=>({duration:200})),u(s,o)};E(Ps,s=>{e(N)==="testing"&&s(Bs)})}a(Je),a(He),ee(()=>{Ae.disabled=e(Ie)||!e(t).code,Oe.disabled=e(Pe),ft=ye(ze,1,"tab svelte-gpmfsp",null,ft,{active:e(N)==="basic"}),bt=ye(De,1,"tab svelte-gpmfsp",null,bt,{active:e(N)==="restrictions"}),ht=ye(Te,1,"tab svelte-gpmfsp",null,ht,{active:e(N)==="advanced"}),yt=ye(qe,1,"tab svelte-gpmfsp",null,yt,{active:e(N)==="distribution"}),xt=ye(Fe,1,"tab svelte-gpmfsp",null,xt,{active:e(N)==="testing","tab-highlight":e(t).ab_test_enabled})}),Ys("submit",Je,ct),u(Mt,He),Js(),Rt()}Os(["click","input"]);export{ei as component};
