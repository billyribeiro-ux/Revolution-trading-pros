import{z as He,p as Ie,o as Je,a3 as Qe,f as d,a9 as Ue,d as X,c as v,e as r,i as C,h as l,j as Xe,as as Be,q as a,g as e,aP as R,at as Ge,r as t,k as ye,bH as ve,bI as Ve,K as We,N as ce,bJ as W,bK as he,Q as ue,w as T,aX as Z,x as m,O as Ze,bL as et,_ as tt}from"../chunks/C_QN0JMx.js";import{a as we}from"../chunks/CCQSfPwG.js";import{F as at}from"../chunks/CPL0Sydb.js";import{P as rt}from"../chunks/gQRjaVS-.js";var st=d('<div class="flex items-center justify-center py-20"><div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>'),nt=d('<div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center"><p class="text-red-600"> </p> <button class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Retry</button></div>'),it=d('<div class="bg-white rounded-xl border border-gray-200 p-12 text-center"><div class="text-4xl mb-4">ğŸ”»</div> <h3 class="text-lg font-medium text-gray-900 mb-2">No Funnels Yet</h3> <p class="text-gray-500 mb-6">Create your first funnel to track user conversion journeys</p> <button class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 inline-block">Create Your First Funnel</button></div>'),lt=d('<p class="text-sm text-gray-500 mb-4"> </p>'),ot=d("<span>Â·</span> <span> </span>",1),dt=d('<button><div class="flex items-center justify-between mb-4"><h3 class="font-semibold text-gray-900"> </h3> <span class="text-2xl font-bold text-blue-600"> </span></div> <!> <div class="flex items-center gap-2 text-sm text-gray-500"><span> </span> <!></div></button>'),vt=d('<span class="text-red-500"> </span>'),ct=d('<span class="text-gray-400">-</span>'),ut=d('<tr class="hover:bg-gray-50"><td class="py-3 px-4"><div class="flex items-center gap-3"><span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium"></span> <span class="font-medium text-gray-900"> </span></div></td><td class="py-3 px-4 text-right text-gray-900 font-medium"> </td><td class="py-3 px-4 text-right"><span class="text-green-600 font-medium"> </span></td><td class="py-3 px-4 text-right"><!></td><td class="py-3 px-4 text-right"><div class="flex items-center justify-end gap-2"><div class="w-20 h-2 bg-gray-100 rounded-full overflow-hidden"><div class="h-full bg-blue-500 rounded-full"></div></div> <span class="text-gray-600 w-12 text-right"> </span></div></td></tr>'),pt=d('<div class="space-y-6"><!> <div class="bg-white rounded-xl border border-gray-200 overflow-hidden"><div class="p-4 border-b border-gray-100"><h3 class="font-semibold text-gray-900">Step Analysis</h3></div> <div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-gray-50"><tr><th class="text-left py-3 px-4 font-medium text-gray-600">Step</th><th class="text-right py-3 px-4 font-medium text-gray-600">Users</th><th class="text-right py-3 px-4 font-medium text-gray-600">Conversion Rate</th><th class="text-right py-3 px-4 font-medium text-gray-600">Drop-off</th><th class="text-right py-3 px-4 font-medium text-gray-600">From Start</th></tr></thead><tbody class="divide-y divide-gray-100"></tbody></table></div></div></div>'),xt=d('<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"></div> <!>',1),bt=d('<button class="p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg">ğŸ—‘ï¸</button>'),mt=d('<div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg"><span class="w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium flex-shrink-0"></span> <input type="text" placeholder="Step name" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"/> <input type="text" placeholder="Event name" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"/> <!></div>'),_t=d('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"><div class="p-6 border-b border-gray-100"><div class="flex items-center justify-between"><h2 class="text-xl font-bold text-gray-900">Create Funnel</h2> <button class="text-gray-400 hover:text-gray-600 text-2xl">âœ•</button></div></div> <div class="p-6 space-y-6"><div class="space-y-4"><div><label for="funnel-name" class="block text-sm font-medium text-gray-700 mb-1">Name</label> <input id="funnel-name" type="text" placeholder="e.g., Purchase Funnel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"/></div> <div><label for="funnel-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label> <textarea id="funnel-description" placeholder="Describe this funnel..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea></div></div> <div><div class="flex items-center justify-between mb-3"><span class="text-sm font-medium text-gray-700">Funnel Steps</span> <button class="text-sm text-blue-600 hover:text-blue-700 font-medium">+ Add Step</button></div> <div class="space-y-3"></div></div></div> <div class="p-6 border-t border-gray-100 flex justify-end gap-3"><button class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">Create Funnel</button></div></div></div>'),ft=d('<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="flex items-center justify-between mb-8"><div><h1 class="text-2xl font-bold text-gray-900">Conversion Funnels</h1> <p class="text-sm text-gray-500 mt-1">Track and optimize user conversion journeys</p></div> <div class="flex items-center gap-4"><!> <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">Create Funnel</button></div></div> <!></div> <!>',1);function Ft(Fe,ke){Ie(ke,!1);let ee=R([]),te=R(!0),B=R(null),ae=R("30d"),j=R(null),Y=R(!1),n=R({name:"",description:"",steps:[{name:"",event_name:""}]});async function G(){v(te,!0),v(B,null);try{const s=await we.getFunnels(e(ae));v(ee,s.funnels||[])}catch(s){v(B,s instanceof Error?s.message:"Failed to load funnels")}finally{v(te,!1)}}function Ce(s){v(ae,s),G()}function je(){Z(n,e(n).steps=[...e(n).steps,{name:"",event_name:""}])}function Se(s){e(n).steps.length>1&&Z(n,e(n).steps=e(n).steps.filter((p,H)=>H!==s))}async function Pe(){try{await we.createFunnel({name:e(n).name,description:e(n).description,steps:e(n).steps.map((s,p)=>({step_number:p+1,name:s.name,event_name:s.event_name}))}),v(Y,!1),v(n,{name:"",description:"",steps:[{name:"",event_name:""}]}),G()}catch(s){alert(s instanceof Error?s.message:"Failed to create funnel")}}function $e(s){return s?s<60?`${s.toFixed(0)}s`:s<3600?`${(s/60).toFixed(0)}m`:`${(s/3600).toFixed(1)}h`:"-"}Je(()=>{G()}),Qe();var pe=ft();Ue("12higth",s=>{Be(()=>{Ge.title="Conversion Funnels | Analytics"})});var re=X(pe),se=a(re),xe=r(a(se),2),be=a(xe);rt(be,{get value(){return e(ae)},onchange:Ce});var Ae=r(be,2);Ae.__click=()=>v(Y,!0),t(xe),t(se);var De=r(se,2);{var ze=s=>{var p=st();l(s,p)},Ee=s=>{var p=ye(),H=X(p);{var J=S=>{var _=nt(),g=a(_),q=a(g,!0);t(g);var I=r(g,2);I.__click=G,t(_),T(()=>m(q,e(B))),l(S,_)},V=S=>{var _=ye(),g=X(_);{var q=y=>{var f=it(),P=r(a(f),6);P.__click=()=>v(Y,!0),t(f),l(y,f)},I=y=>{var f=xt(),P=X(f);ce(P,5,()=>e(ee),ue,($,o)=>{var x=dt();x.__click=()=>v(j,e(o));var h=a(x),i=a(h),w=a(i,!0);t(i);var A=r(i,2),K=a(A);t(A),t(h);var b=r(h,2);{var D=u=>{var z=lt(),E=a(z,!0);t(z),T(()=>m(E,e(o).description)),l(u,z)};C(b,u=>{e(o).description&&u(D)})}var F=r(b,2),k=a(F),L=a(k);t(k);var c=r(k,2);{var M=u=>{var z=ot(),E=r(X(z),2),ie=a(E);t(E),T(U=>m(ie,`Avg time: ${U??""}`),[()=>$e(e(o).avg_completion_time)]),l(u,z)};C(c,u=>{e(o).avg_completion_time&&u(M)})}t(F),t(x),T(u=>{Ze(x,1,`text-left bg-white rounded-xl border border-gray-200 p-6 hover:shadow-lg transition-shadow
						${e(j)?.key===e(o).key?"ring-2 ring-blue-500":""}`),m(w,e(o).name),m(K,`${u??""}%`),m(L,`${e(o).steps.length??""} steps`)},[()=>e(o).overall_conversion.toFixed(1)]),l($,x)}),t(P);var Q=r(P,2);{var ne=$=>{var o=pt(),x=a(o);at(x,{get steps(){return e(j).steps},get title(){return e(j).name},showDropOff:!0});var h=r(x,2),i=r(a(h),2),w=a(i),A=r(a(w));ce(A,5,()=>e(j).steps,ue,(K,b,D)=>{const F=et(()=>e(j).steps[0].count>0?e(b).count/e(j).steps[0].count*100:0);var k=ut(),L=a(k),c=a(L),M=a(c);M.textContent=D+1;var u=r(M,2),z=a(u,!0);t(u),t(c),t(L);var E=r(L),ie=a(E,!0);t(E);var U=r(E),me=a(U),Ke=a(me);t(me),t(U);var le=r(U),Le=a(le);{var Me=N=>{var O=vt(),de=a(O);t(O),T(Ye=>m(de,`-${Ye??""}%`),[()=>e(b).drop_off_rate.toFixed(1)]),l(N,O)},Oe=N=>{var O=ct();l(N,O)};C(Le,N=>{D>0?N(Me):N(Oe,!1)})}t(le);var _e=r(le),fe=a(_e),oe=a(fe),Re=a(oe);t(oe);var ge=r(oe,2),Te=a(ge);t(ge),t(fe),t(_e),t(k),T((N,O,de)=>{m(z,e(b).name),m(ie,N),m(Ke,`${O??""}%`),tt(Re,`width: ${e(F)??""}%`),m(Te,`${de??""}%`)},[()=>e(b).count.toLocaleString(),()=>e(b).conversion_rate.toFixed(1),()=>e(F).toFixed(1)]),l(K,k)}),t(A),t(w),t(i),t(h),t(o),l($,o)};C(Q,$=>{e(j)&&$(ne)})}l(y,f)};C(g,y=>{e(ee).length===0?y(q):y(I,!1)},!0)}l(S,_)};C(H,S=>{e(B)?S(J):S(V,!1)},!0)}l(s,p)};C(De,s=>{e(te)?s(ze):s(Ee,!1)})}t(re);var Ne=r(re,2);{var qe=s=>{var p=_t(),H=a(p),J=a(H),V=a(J),S=r(a(V),2);S.__click=()=>v(Y,!1),t(V),t(J);var _=r(J,2),g=a(_),q=a(g),I=r(a(q),2);ve(I),t(q);var y=r(q,2),f=r(a(y),2);Ve(f),We(f,"rows",2),t(y),t(g);var P=r(g,2),Q=a(P),ne=r(a(Q),2);ne.__click=je,t(Q);var $=r(Q,2);ce($,5,()=>e(n).steps,ue,(i,w,A)=>{var K=mt(),b=a(K);b.textContent=A+1;var D=r(b,2);ve(D);var F=r(D,2);ve(F);var k=r(F,2);{var L=c=>{var M=bt();M.__click=()=>Se(A),l(c,M)};C(k,c=>{e(n).steps.length>1&&c(L)})}t(K),W(D,()=>e(w).name,c=>(e(w).name=c,he(()=>e(n)))),W(F,()=>e(w).event_name,c=>(e(w).event_name=c,he(()=>e(n)))),l(i,K)}),t($),t(P),t(_);var o=r(_,2),x=a(o);x.__click=()=>v(Y,!1);var h=r(x,2);h.__click=Pe,t(o),t(H),t(p),T(i=>h.disabled=i,[()=>!e(n).name||e(n).steps.some(i=>!i.name||!i.event_name)]),W(I,()=>e(n).name,i=>Z(n,e(n).name=i)),W(f,()=>e(n).description,i=>Z(n,e(n).description=i)),l(s,p)};C(Ne,s=>{e(Y)&&s(qe)})}l(Fe,pe),Xe()}He(["click"]);export{Ft as component};
