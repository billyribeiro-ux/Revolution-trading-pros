import{dD as qt,z as Jt,p as Zt,s as h,A as oa,b as Qt,g as e,c as l,f,a9 as Xt,D as Vt,d as Oe,F as es,q as t,aM as as,aZ as ts,dE as Xa,e as s,R as ss,i as I,w as N,h as b,j as rs,E as ls,n as oe,as as is,$ as ns,B as os,at as vs,H as A,r as a,x as n,aa as cs,k as Va,Z as et,cX as at,cY as Ca,M as Da,b2 as tt,bH as ke,aF as st,O as Be,bJ as je,P as ds,N as Ma,al as us,Q as _s,ao as gs,bI as ps,K as rt,d0 as ms,U as lt,by as bs,aR as hs,dF as fs,_ as ys,b_ as it,c$ as ws,cZ as ks}from"../chunks/C_QN0JMx.js";import{authStore as nt}from"../chunks/D3S43Cfl.js";import{a as Se,b as qe,i as Ra}from"../chunks/CevrrlX8.js";import{a as xe}from"../chunks/ByEkyPua.js";const G="/api/admin/past-members-dashboard",Je={overview:300*1e3,period:180*1e3,services:600*1e3,churnReasons:300*1e3,campaigns:120*1e3},za={"30d":"Last 30 Days","60d":"Last 60 Days","90d":"Last 90 Days","6mo":"Last 6 Months","1yr":"Last Year",all:"All Time"};async function ve(o){const u=nt.getToken(),c={"Content-Type":"application/json",Accept:"application/json"};return u&&(c.Authorization=`Bearer ${u}`),c}async function be(o){if(o.status===304)throw new Ss;if(!o.ok){const c=await o.json().catch(()=>({message:"Request failed"}));throw new xs(c.message||"Request failed",o.status)}const u=await o.json();return u.data??u}class xs extends Error{constructor(u,c){super(u),this.status=c,this.name="ApiError"}}class Ss extends Error{constructor(){super("Not Modified"),this.name="NotModifiedError"}}async function ot(o){const u=qe(`${G}/overview`);return o?.skipCache&&Se.delete(u),Se.getOrFetch(u,async()=>{const c=await fetch(`${G}/overview`,{method:"GET",headers:await ve(),credentials:"include"});return be(c)},{ttl:Je.overview,persist:!0})}async function $s(o,u=1,c=25,T,y){const S=new URLSearchParams({page:u.toString(),per_page:c.toString()});T&&S.append("search",T),y?.serviceId&&S.append("service_id",y.serviceId.toString()),y?.minSpent&&S.append("min_spent",y.minSpent.toString()),y?.sortBy&&S.append("sort_by",y.sortBy),y?.sortDir&&S.append("sort_dir",y.sortDir);const X=`${G}/period/${o}?${S}`,ce=qe(X);return y?.skipCache&&Se.delete(ce),Se.getOrFetch(ce,async()=>{const K=await fetch(X,{method:"GET",headers:await ve(),credentials:"include"});return be(K)},{ttl:Je.period})}async function vt(){const o=qe(`${G}/services`);return Se.getOrFetch(o,async()=>{const u=await fetch(`${G}/services`,{method:"GET",headers:await ve(),credentials:"include"}),c=await be(u);return Array.isArray(c)?c:c.services},{ttl:Je.services,persist:!0})}async function ct(o){const u=o?`?period=${o}`:"",c=`${G}/churn-reasons${u}`,T=qe(c);return Se.getOrFetch(T,async()=>{const y=await fetch(c,{method:"GET",headers:await ve(),credentials:"include"}),S=await be(y);return Array.isArray(S)?S:S.reasons},{ttl:Je.churnReasons})}async function dt(){const o=qe(`${G}/campaigns`);return Se.getOrFetch(o,async()=>{const u=await fetch(`${G}/campaigns`,{method:"GET",headers:await ve(),credentials:"include"}),c=await be(u);return Array.isArray(c)?c:c.campaigns},{ttl:Je.campaigns})}async function Ps(){const o=await fetch(`${G}/realtime`,{method:"GET",headers:await ve(),credentials:"include"});return be(o)}async function Es(o){const u=await fetch(`${G}/bulk-winback`,{method:"POST",headers:await ve(),credentials:"include",body:JSON.stringify(o)}),c=await be(u);return c.success&&!o.dry_run&&Ra(/past-members-dashboard/),c}async function Cs(o,u,c){const T=await fetch(`${G}/bulk-survey`,{method:"POST",headers:await ve(),credentials:"include",body:JSON.stringify({period:o,incentive:u,service_id:c?.serviceId,limit:c?.limit})}),y=await be(T);return y.success&&Ra(/past-members-dashboard/),y}async function ut(){await fetch(`${G}/invalidate-cache`,{method:"POST",headers:await ve(),credentials:"include"}),Ra(/past-members-dashboard/)}async function _t(){await Promise.allSettled([ot(),vt(),ct(),dt()])}const Q={getDashboardOverview:ot,getPastMembersByPeriod:$s,getServiceStats:vt,getChurnReasons:ct,getCampaignHistory:dt,getRealtimeStats:Ps,sendBulkWinBack:Es,sendBulkSurvey:Cs,invalidateDashboardCache:ut,preloadDashboardData:_t,TIME_PERIOD_LABELS:za},Ds=async({url:o})=>{const u={title:"Past Members Dashboard",requiresAuth:!0,requiresAdmin:!0};if(!nt.getToken()){const T=encodeURIComponent(o.pathname+o.search);qt(302,`/login?redirect=${T}`)}try{const[T,y,S,X]=await Promise.all([Q.getDashboardOverview(),Q.getChurnReasons(),Q.getServiceStats(),Q.getCampaignHistory()]);return _t().catch(()=>{}),{...u,overview:T,churnReasons:y,services:S,campaigns:X}}catch{return{...u,authError:!0}}},Vs=Object.freeze(Object.defineProperty({__proto__:null,load:Ds},Symbol.toStringTag,{value:"Module"}));var Ms=f('<meta name="robots" content="noindex, nofollow"/>'),zs=f('<div class="loading-state svelte-1r85lg5"><div class="loader svelte-1r85lg5"></div> <p>Loading dashboard...</p></div>'),Rs=f('<div class="error-state svelte-1r85lg5"><div class="error-icon svelte-1r85lg5"><!></div> <h3 class="svelte-1r85lg5">Failed to load dashboard</h3> <p class="svelte-1r85lg5"> </p> <button class="btn-primary svelte-1r85lg5">Try Again</button></div>'),As=f('<div class="period-indicator svelte-1r85lg5"><!></div>'),Ts=f('<button><div class="period-label svelte-1r85lg5"> </div> <div class="period-count svelte-1r85lg5"> </div> <div class="period-revenue svelte-1r85lg5"> </div> <!></button>'),Fs=f('<div class="stats-row svelte-1r85lg5"><div class="stat-card primary svelte-1r85lg5"><div class="stat-icon svelte-1r85lg5"><!></div> <div class="stat-content"><div class="stat-label svelte-1r85lg5">Past Members</div> <div class="stat-value svelte-1r85lg5"> </div></div></div> <div class="stat-card success svelte-1r85lg5"><div class="stat-icon svelte-1r85lg5"><!></div> <div class="stat-content"><div class="stat-label svelte-1r85lg5">Potential Revenue</div> <div class="stat-value svelte-1r85lg5"> </div></div></div> <div class="stat-card warning svelte-1r85lg5"><div class="stat-icon svelte-1r85lg5"><!></div> <div class="stat-content"><div class="stat-label svelte-1r85lg5">Avg Days Since Expired</div> <div class="stat-value svelte-1r85lg5"> </div></div></div> <div class="stat-card info svelte-1r85lg5"><div class="stat-icon svelte-1r85lg5"><!></div> <div class="stat-content"><div class="stat-label svelte-1r85lg5">Top Plan</div> <div class="stat-value plan-name svelte-1r85lg5"> </div></div></div></div>'),Os=f('<div class="reason-card svelte-1r85lg5"><div class="reason-bar svelte-1r85lg5"></div> <div class="reason-content svelte-1r85lg5"><span class="reason-rank svelte-1r85lg5"> </span> <span class="reason-text svelte-1r85lg5"> </span> <span class="reason-count svelte-1r85lg5"> </span></div></div>'),Bs=f('<div class="churn-reasons-section svelte-1r85lg5"><div class="section-header svelte-1r85lg5"><!> <h3 class="svelte-1r85lg5">Top Cancellation Reasons</h3></div> <div class="reasons-grid svelte-1r85lg5"></div></div>'),js=f('<button class="btn-selected svelte-1r85lg5"><!> </button>'),Ls=f('<div class="table-loading svelte-1r85lg5"><div class="loader small svelte-1r85lg5"></div> <p>Loading members...</p></div>'),Us=f('<div class="empty-state svelte-1r85lg5"><!> <h3 class="svelte-1r85lg5">No past members found</h3> <p>No members have expired in this time period</p></div>'),Is=f('<tr><td class="checkbox-col svelte-1r85lg5"><input type="checkbox" class="svelte-1r85lg5"/></td><td class="svelte-1r85lg5"><div class="member-info svelte-1r85lg5"><div class="member-avatar svelte-1r85lg5"> </div> <div class="member-details"><div class="member-name svelte-1r85lg5"> </div> <div class="member-email svelte-1r85lg5"> </div></div></div></td><td class="svelte-1r85lg5"><span class="plan-badge svelte-1r85lg5"> </span></td><td class="svelte-1r85lg5"><span class="spending svelte-1r85lg5"> </span></td><td class="svelte-1r85lg5"><span class="date svelte-1r85lg5"> </span></td><td class="svelte-1r85lg5"><span class="days-badge svelte-1r85lg5"> </span></td><td class="svelte-1r85lg5"><span class="reason-text-cell svelte-1r85lg5"> </span></td></tr>'),Ns=f('<table class="members-table svelte-1r85lg5"><thead class="svelte-1r85lg5"><tr><th class="checkbox-col svelte-1r85lg5"><input type="checkbox" aria-label="Select all members" class="svelte-1r85lg5"/></th><th class="svelte-1r85lg5">Member</th><th class="svelte-1r85lg5">Last Plan</th><th class="svelte-1r85lg5">Total Spent</th><th class="svelte-1r85lg5">Expired</th><th class="svelte-1r85lg5">Days Ago</th><th class="svelte-1r85lg5">Reason</th></tr></thead><tbody class="svelte-1r85lg5"></tbody></table> <div class="pagination svelte-1r85lg5"><div class="pagination-info svelte-1r85lg5"> </div> <div class="pagination-controls svelte-1r85lg5"><button class="page-btn svelte-1r85lg5" aria-label="Previous page"><!></button> <span class="page-indicator svelte-1r85lg5"> </span> <button class="page-btn svelte-1r85lg5" aria-label="Next page"><!></button></div></div>',1),Gs=f('<div class="period-selector svelte-1r85lg5"></div> <!> <!> <div class="campaign-bar svelte-1r85lg5"><div class="campaign-info svelte-1r85lg5"><!> <span>Ready to win back <strong class="svelte-1r85lg5"> </strong> </span></div> <div class="campaign-actions svelte-1r85lg5"><button class="campaign-btn free svelte-1r85lg5"><!> 30 Days Free</button> <button class="campaign-btn discount svelte-1r85lg5"><!> Discount Offer</button> <button class="campaign-btn personal svelte-1r85lg5"><!> Personal Email</button></div></div> <div class="toolbar svelte-1r85lg5"><div class="search-box svelte-1r85lg5"><!> <input type="text" placeholder="Search by name or email..." class="svelte-1r85lg5"/></div> <div class="toolbar-actions svelte-1r85lg5"><!></div></div> <div class="members-table-container svelte-1r85lg5"><!></div>',1),Ks=f('<div class="form-group svelte-1r85lg5"><label for="discount-percent" class="svelte-1r85lg5">Discount Percentage</label> <div class="discount-slider svelte-1r85lg5"><input id="discount-percent" type="range" min="10" max="50" step="5" class="svelte-1r85lg5"/> <span class="discount-value svelte-1r85lg5"> </span></div></div>'),Ws=f('<div class="form-group svelte-1r85lg5"><label for="custom-subject" class="svelte-1r85lg5">Subject Line</label> <input id="custom-subject" type="text" placeholder="Enter email subject..." class="svelte-1r85lg5"/></div> <div class="form-group svelte-1r85lg5"><label for="custom-body" class="svelte-1r85lg5">Email Body</label> <textarea id="custom-body" rows="8" class="svelte-1r85lg5"></textarea></div>',1),Ys=f('<div class="modal-overlay svelte-1r85lg5" role="button" tabindex="0" aria-label="Close modal"><div class="modal-content svelte-1r85lg5" role="dialog" aria-modal="true" aria-labelledby="email-modal-title" tabindex="-1"><div class="modal-header svelte-1r85lg5"><div><h2 id="email-modal-title" class="svelte-1r85lg5">Win-Back Campaign</h2> <p class="svelte-1r85lg5"> </p></div> <button class="close-btn svelte-1r85lg5" aria-label="Close modal"><!></button></div> <div class="modal-body svelte-1r85lg5"><div class="template-selector svelte-1r85lg5"><span class="selector-label svelte-1r85lg5">Choose Template</span> <div class="template-grid svelte-1r85lg5"><button><!> <span class="template-name svelte-1r85lg5">30 Days Free</span> <span class="template-desc svelte-1r85lg5">Free trial offer</span></button> <button><!> <span class="template-name svelte-1r85lg5">Discount</span> <span class="template-desc svelte-1r85lg5">Percentage off</span></button> <button><!> <span class="template-name svelte-1r85lg5">We Miss You</span> <span class="template-desc svelte-1r85lg5">Personal touch</span></button> <button><!> <span class="template-name svelte-1r85lg5">Custom</span> <span class="template-desc svelte-1r85lg5">Your message</span></button></div></div> <div class="template-preview svelte-1r85lg5"><div class="preview-header svelte-1r85lg5">Preview</div> <div class="preview-subject svelte-1r85lg5"> </div> <div class="preview-desc svelte-1r85lg5"> </div></div> <!> <div class="form-group svelte-1r85lg5"><label for="offer-code" class="svelte-1r85lg5">Offer Code (Optional)</label> <input id="offer-code" type="text" placeholder="e.g., COMEBACK20" class="svelte-1r85lg5"/></div> <!></div> <div class="modal-footer svelte-1r85lg5"><button class="btn-secondary svelte-1r85lg5">Cancel</button> <button class="btn-primary svelte-1r85lg5"><!> </button></div></div></div>'),Hs=f('<div class="modal-overlay svelte-1r85lg5" role="button" tabindex="0" aria-label="Close modal"><div class="modal-content survey-modal svelte-1r85lg5" role="dialog" aria-modal="true" aria-labelledby="survey-modal-title" tabindex="-1"><div class="modal-header svelte-1r85lg5"><div><h2 id="survey-modal-title" class="svelte-1r85lg5">Send Feedback Survey</h2> <p class="svelte-1r85lg5"> </p></div> <button class="close-btn svelte-1r85lg5" aria-label="Close modal"><!></button></div> <div class="modal-body svelte-1r85lg5"><div class="survey-info svelte-1r85lg5"><!> <p class="svelte-1r85lg5">Send a feedback survey to understand why members canceled and what would bring them back.</p></div> <div class="form-group svelte-1r85lg5"><label for="survey-incentive" class="svelte-1r85lg5">Incentive (Optional)</label> <input id="survey-incentive" type="text" placeholder="e.g., Complete the survey for 10% off your next month" class="svelte-1r85lg5"/> <span class="form-hint svelte-1r85lg5">Offering an incentive can increase response rates by up to 30%</span></div></div> <div class="modal-footer svelte-1r85lg5"><button class="btn-secondary svelte-1r85lg5">Cancel</button> <button class="btn-primary svelte-1r85lg5"><!> </button></div></div></div>'),qs=f('<div class="past-members-page svelte-1r85lg5"><div class="page-header"><button class="back-btn svelte-1r85lg5"><!> Back to Members</button> <div class="header-content svelte-1r85lg5"><div class="header-title svelte-1r85lg5"><div class="title-icon svelte-1r85lg5"><!></div> <div><h1 class="svelte-1r85lg5">Past Members Dashboard</h1> <p class="svelte-1r85lg5">Time-based win-back campaigns at your fingertips</p></div></div> <div class="header-actions svelte-1r85lg5"><button class="btn-secondary svelte-1r85lg5"><!> Send Survey</button> <button class="btn-refresh svelte-1r85lg5"><!> </button></div></div></div> <!></div> <!> <!>',1);function er(o,u){Zt(u,!0);const c=()=>os(cs,"$page",T),[T,y]=ls(),S=oe(()=>c().data);let X=h(null),ce=h(oa([])),K=h("30d"),$e=h(oa([])),va=h(""),W=h(oa(new Set)),Le=h(!0),Ue=h(!1),ca=h(!1),Pe=h(null),D=h(oa({current_page:1,last_page:1,per_page:20,total:0})),te=h(!1),w=h("30_free"),Ee=h(""),Ie=h(""),Ze=h(""),Ne=h(20),de=h(!1),ue=h(!1),da=h("");const se=oe(()=>e(X)?.periods[e(K)]),gt=oe(()=>e($e).length>0),pt=oe(()=>e(W).size>0),Aa=oe(()=>e(W).size===e($e).length&&e($e).length>0),Ta=oe(()=>za[e(K)]);Qt(()=>{if(e(S)?.authError){l(Pe,"Session expired or access denied."),l(Le,!1);return}e(S)?.overview?(l(X,e(S).overview,!0),l(ce,e(S).churnReasons??[],!0),l(Le,!1),he()):Fa()});async function Fa(){l(Le,!0),l(Pe,null);try{const[r,v]=await Promise.all([Q.getDashboardOverview(),Q.getChurnReasons()]);l(X,r,!0),l(ce,v,!0),await he()}catch(r){l(Pe,r instanceof Error?r.message:"Failed to load dashboard",!0),xe.error("Failed to load dashboard data")}finally{l(Le,!1)}}async function ua(){l(Ue,!0),l(Pe,null);try{await ut();const[r,v]=await Promise.all([Q.getDashboardOverview({skipCache:!0}),Q.getChurnReasons(e(K))]);l(X,r,!0),l(ce,v,!0),await he(1,!0),xe.success("Dashboard refreshed")}catch{xe.error("Failed to refresh dashboard")}finally{l(Ue,!1)}}async function he(r=1,v=!1){l(ca,!0);try{const k=await Q.getPastMembersByPeriod(e(K),r,e(D).per_page,e(va)||void 0,{skipCache:v});l($e,k.members,!0),l(D,{current_page:k.pagination.current_page,last_page:k.pagination.last_page,per_page:k.pagination.per_page,total:k.pagination.total},!0)}catch{}finally{l(ca,!1)}}async function mt(r){l(K,r,!0),l(W,new Set,!0),await he()}async function bt(){await he()}function ht(r){const v=new Set(e(W));v.has(r)?v.delete(r):v.add(r),l(W,v,!0)}function ft(){e(Aa)?l(W,new Set,!0):l(W,new Set(e($e).map(r=>r.id)),!0)}async function yt(){l(de,!0);try{const r={period:e(K),template:e(w)};e(w)==="custom"&&e(Ee)&&(r.custom_subject=e(Ee)),e(w)==="custom"&&e(Ie)&&(r.custom_body=e(Ie)),e(Ze)&&(r.offer_code=e(Ze)),e(w)==="discount"&&(r.discount_percent=e(Ne));const v=await Q.sendBulkWinBack(r);xe.success(v.message),l(te,!1),l(W,new Set,!0),await ua()}catch(r){xe.error(r instanceof Error?r.message:"Failed to send emails")}finally{l(de,!1)}}async function wt(){l(de,!0);try{const r=await Q.sendBulkSurvey(e(K),e(da)||void 0);xe.success(r.message),l(ue,!1),await ua()}catch(r){xe.error(r instanceof Error?r.message:"Failed to send surveys")}finally{l(de,!1)}}function _a(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function kt(r){return r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-"}function xt(r){return r.name?.slice(0,2).toUpperCase()||"U"}function Oa(r){switch(r){case"30_free":return{subject:"Get 30 Days FREE - We Want You Back!",description:"Offer a free month to entice members back"};case"discount":return{subject:`Exclusive ${e(Ne)}% Off - Just for You!`,description:"Provide a percentage discount on their next subscription"};case"missed":return{subject:"We've Missed You at Revolution Trading Pros",description:"Personal reconnection email highlighting new features"};default:return{subject:e(Ee)||"Custom Email",description:"Your custom win-back message"}}}function ga(r){l(w,r,!0),l(te,!0)}function St(r){r.key==="Escape"&&(l(te,!1),l(ue,!1))}var Ba=qs();Xt("1r85lg5",r=>{var v=Ms();is(()=>{vs.title="Past Members Dashboard | Revolution Trading Pros"}),b(r,v)}),Vt("keydown",ns,St);var pa=Oe(Ba),ma=t(pa),Qe=t(ma);Qe.__click=()=>es("/admin/members");var $t=t(Qe);as($t,{size:20}),A(),a(Qe);var ja=s(Qe,2),ba=t(ja),La=t(ba),Pt=t(La);ts(Pt,{size:32}),a(La),A(2),a(ba);var Ua=s(ba,2),Xe=t(Ua);Xe.__click=()=>l(ue,!0);var Et=t(Xe);Xa(Et,{size:18}),A(),a(Xe);var Ve=s(Xe,2);Ve.__click=ua;var Ia=t(Ve);{let r=oe(()=>e(Ue)?"spin":"");ss(Ia,{size:18,get class(){return e(r)}})}var Ct=s(Ia);a(Ve),a(Ua),a(ja),a(ma);var Dt=s(ma,2);{var Mt=r=>{var v=zs();b(r,v)},zt=r=>{var v=Va(),k=Oe(v);{var re=O=>{var V=Rs(),M=t(V),_e=t(M);ds(_e,{size:48}),a(M);var F=s(M,4),B=t(F,!0);a(F);var ge=s(F,2);ge.__click=Fa,a(V),N(()=>n(B,e(Pe))),b(O,V)},le=O=>{var V=Gs(),M=Oe(V);Ma(M,21,()=>Object.entries(za),_s,(d,p)=>{var $=oe(()=>ms(e(p),2));let i=()=>e($)[0],P=()=>e($)[1];const g=oe(()=>e(X)?.periods[i()]);var _=Ts();let x;_.__click=()=>mt(i());var m=t(_),E=t(m,!0);a(m);var q=s(m,2),L=t(q,!0);a(q);var J=s(q,2),ee=t(J,!0);a(J);var Z=s(J,2);{var ae=U=>{var C=As(),Ae=t(C);us(Ae,{size:16}),a(C),b(U,C)};I(Z,U=>{e(K)===i()&&U(ae)})}a(_),N((U,C)=>{x=Be(_,1,"period-card svelte-1r85lg5",null,x,{active:e(K)===i()}),n(E,P()),n(L,U),n(ee,C)},[()=>e(g)?.total_count?.toLocaleString()||0,()=>_a(e(g)?.potential_revenue||0)]),b(d,_)}),a(M);var _e=s(M,2);{var F=d=>{var p=Fs(),$=t(p),i=t($),P=t(i);lt(P,{size:24}),a(i);var g=s(i,2),_=s(t(g),2),x=t(_,!0);a(_),a(g),a($);var m=s($,2),E=t(m),q=t(E);Ca(q,{size:24}),a(E);var L=s(E,2),J=s(t(L),2),ee=t(J,!0);a(J),a(L),a(m);var Z=s(m,2),ae=t(Z),U=t(ae);bs(U,{size:24}),a(ae);var C=s(ae,2),Ae=s(t(C),2),Ye=t(Ae,!0);a(Ae),a(C),a(Z);var ia=s(Z,2),pe=t(ia),ya=t(pe);hs(ya,{size:24}),a(pe);var me=s(pe,2),R=s(t(me),2),Te=t(R,!0);a(R),a(me),a(ia),a(p),N((na,He,Fe)=>{n(x,na),n(ee,He),n(Ye,Fe),n(Te,e(se).top_plans?.[0]?.name||"N/A")},[()=>e(se).total_count.toLocaleString(),()=>_a(e(se).potential_revenue),()=>Math.round(e(se).avg_days_since_expired)]),b(d,p)};I(_e,d=>{e(se)&&d(F)})}var B=s(_e,2);{var ge=d=>{var p=Bs(),$=t(p),i=t($);fs(i,{size:20}),A(2),a($);var P=s($,2);Ma(P,23,()=>e(ce).slice(0,5),g=>g.reason,(g,_,x)=>{var m=Os(),E=t(m),q=s(E,2),L=t(q),J=t(L);a(L);var ee=s(L,2),Z=t(ee,!0);a(ee);var ae=s(ee,2),U=t(ae);a(ae),a(q),a(m),N(C=>{ys(E,`--width: ${e(_).percentage??""}%`),n(J,`#${e(x)+1}`),n(Z,e(_).reason||"Unknown"),n(U,`${e(_).count??""} (${C??""}%)`)},[()=>e(_).percentage.toFixed(1)]),b(g,m)}),a(P),a(p),b(d,p)};I(B,d=>{e(ce).length>0&&d(ge)})}var j=s(B,2),ie=t(j),fe=t(ie);tt(fe,{size:20});var Y=s(fe,2),H=s(t(Y)),Ce=t(H,!0);a(H);var ne=s(H);a(Y),a(ie);var z=s(ie,2),De=t(z);De.__click=()=>ga("30_free");var Me=t(De);at(Me,{size:18}),A(),a(De);var ye=s(De,2);ye.__click=()=>ga("discount");var ha=t(ye);Ca(ha,{size:18}),A(),a(ye);var we=s(ye,2);we.__click=()=>ga("missed");var Ge=t(we);Da(Ge,{size:18}),A(),a(we),a(z),a(j);var Ke=s(j,2),ze=t(Ke),ea=t(ze);gs(ea,{size:18});var Re=s(ea,2);ke(Re),Re.__keydown=d=>d.key==="Enter"&&bt(),a(ze);var aa=s(ze,2),We=t(aa);{var ta=d=>{var p=js();p.__click=()=>l(te,!0);var $=t(p);Da($,{size:18});var i=s($);a(p),N(()=>n(i,` Email ${e(W).size??""} Selected`)),b(d,p)};I(We,d=>{e(pt)&&d(ta)})}a(aa),a(Ke);var sa=s(Ke,2),fa=t(sa);{var ra=d=>{var p=Ls();b(d,p)},la=d=>{var p=Va(),$=Oe(p);{var i=g=>{var _=Us(),x=t(_);lt(x,{size:64,stroke:1}),A(4),a(_),b(g,_)},P=g=>{var _=Ns(),x=Oe(_),m=t(x),E=t(m),q=t(E),L=t(q);ke(L),L.__change=ft,a(q),A(6),a(E),a(m);var J=s(m);Ma(J,21,()=>e($e),me=>me.id,(me,R)=>{var Te=Is();let na;var He=t(Te),Fe=t(He);ke(Fe),Fe.__change=()=>ht(e(R).id),a(He);var wa=s(He),Ga=t(wa),ka=t(Ga),Ft=t(ka,!0);a(ka);var Ka=s(ka,2),xa=t(Ka),Ot=t(xa,!0);a(xa);var Wa=s(xa,2),Bt=t(Wa,!0);a(Wa),a(Ka),a(Ga),a(wa);var Sa=s(wa),Ya=t(Sa),jt=t(Ya,!0);a(Ya),a(Sa);var $a=s(Sa),Ha=t($a),Lt=t(Ha,!0);a(Ha),a($a);var Pa=s($a),qa=t(Pa),Ut=t(qa,!0);a(qa),a(Pa);var Ea=s(Pa),Ja=t(Ea),It=t(Ja);a(Ja),a(Ea);var Za=s(Ea),Qa=t(Za),Nt=t(Qa,!0);a(Qa),a(Za),a(Te),N((Gt,Kt,Wt,Yt,Ht)=>{na=Be(Te,1,"svelte-1r85lg5",null,na,Gt),it(Fe,Kt),rt(Fe,"aria-label",`Select ${e(R).name??""}`),n(Ft,Wt),n(Ot,e(R).name),n(Bt,e(R).email),n(jt,e(R).last_membership?.plan_name||"-"),n(Lt,Yt),n(Ut,Ht),n(It,`${(e(R).last_membership?.days_since_expired||0)??""}d`),n(Nt,e(R).last_membership?.cancellation_reason||"Unknown")},[()=>({selected:e(W).has(e(R).id)}),()=>e(W).has(e(R).id),()=>xt(e(R)),()=>_a(e(R).total_spent||0),()=>kt(e(R).last_membership?.expired_at)]),b(me,Te)}),a(J),a(x);var ee=s(x,2),Z=t(ee),ae=t(Z);a(Z);var U=s(Z,2),C=t(U);C.__click=()=>he(e(D).current_page-1);var Ae=t(C);ws(Ae,{size:18}),a(C);var Ye=s(C,2),ia=t(Ye);a(Ye);var pe=s(Ye,2);pe.__click=()=>he(e(D).current_page+1);var ya=t(pe);ks(ya,{size:18}),a(pe),a(U),a(ee),N(me=>{it(L,e(Aa)),n(ae,`Showing ${(e(D).current_page-1)*e(D).per_page+1} to ${me??""} of ${e(D).total??""}`),C.disabled=e(D).current_page===1,n(ia,`Page ${e(D).current_page??""} of ${e(D).last_page??""}`),pe.disabled=e(D).current_page===e(D).last_page},[()=>Math.min(e(D).current_page*e(D).per_page,e(D).total)]),b(g,_)};I($,g=>{e(gt)?g(P,!1):g(i)},!0)}b(d,p)};I(fa,d=>{e(ca)?d(ra):d(la,!1)})}a(sa),N(()=>{n(Ce,e(se)?.total_count||0),n(ne,` members from ${e(Ta)??""}?`)}),je(Re,()=>e(va),d=>l(va,d)),b(O,V)};I(k,O=>{e(Pe)?O(re):O(le,!1)},!0)}b(r,v)};I(Dt,r=>{e(Le)?r(Mt):r(zt,!1)})}a(pa);var Na=s(pa,2);{var Rt=r=>{var v=Ys();v.__click=()=>l(te,!1),v.__keydown=i=>{(i.key==="Escape"||i.key==="Enter"||i.key===" ")&&l(te,!1)};var k=t(v);k.__click=i=>i.stopPropagation(),k.__keydown=i=>i.stopPropagation();var re=t(k),le=t(re),O=s(t(le),2),V=t(O);a(O),a(le);var M=s(le,2);M.__click=()=>l(te,!1);var _e=t(M);et(_e,{size:20}),a(M),a(re);var F=s(re,2),B=t(F),ge=s(t(B),2),j=t(ge);let ie;j.__click=()=>l(w,"30_free");var fe=t(j);at(fe,{size:24}),A(4),a(j);var Y=s(j,2);let H;Y.__click=()=>l(w,"discount");var Ce=t(Y);Ca(Ce,{size:24}),A(4),a(Y);var ne=s(Y,2);let z;ne.__click=()=>l(w,"missed");var De=t(ne);Da(De,{size:24}),A(4),a(ne);var Me=s(ne,2);let ye;Me.__click=()=>l(w,"custom");var ha=t(Me);tt(ha,{size:24}),A(4),a(Me),a(ge),a(B);var we=s(B,2),Ge=s(t(we),2),Ke=t(Ge,!0);a(Ge);var ze=s(Ge,2),ea=t(ze,!0);a(ze),a(we);var Re=s(we,2);{var aa=i=>{var P=Ks(),g=s(t(P),2),_=t(g);ke(_);var x=s(_,2),m=t(x);a(x),a(g),a(P),N(()=>n(m,`${e(Ne)??""}%`)),je(_,()=>e(Ne),E=>l(Ne,E)),b(i,P)};I(Re,i=>{e(w)==="discount"&&i(aa)})}var We=s(Re,2),ta=s(t(We),2);ke(ta),a(We);var sa=s(We,2);{var fa=i=>{var P=Ws(),g=Oe(P),_=s(t(g),2);ke(_),a(g);var x=s(g,2),m=s(t(x),2);ps(m),rt(m,"placeholder",`Enter email body... Use ${{name}} for personalization`),a(x),je(_,()=>e(Ee),E=>l(Ee,E)),je(m,()=>e(Ie),E=>l(Ie,E)),b(i,P)};I(sa,i=>{e(w)==="custom"&&i(fa)})}a(F);var ra=s(F,2),la=t(ra);la.__click=()=>l(te,!1);var d=s(la,2);d.__click=yt;var p=t(d);st(p,{size:18});var $=s(p);a(d),a(ra),a(k),a(v),N((i,P)=>{n(V,`Sending to all ${(e(se)?.total_count||0)??""} members from ${e(Ta)??""}`),ie=Be(j,1,"template-option svelte-1r85lg5",null,ie,{active:e(w)==="30_free"}),H=Be(Y,1,"template-option svelte-1r85lg5",null,H,{active:e(w)==="discount"}),z=Be(ne,1,"template-option svelte-1r85lg5",null,z,{active:e(w)==="missed"}),ye=Be(Me,1,"template-option svelte-1r85lg5",null,ye,{active:e(w)==="custom"}),n(Ke,i),n(ea,P),d.disabled=e(de)||e(w)==="custom"&&(!e(Ee)||!e(Ie)),n($,` ${e(de)?"Sending...":`Send to ${e(se)?.total_count||0} Members`}`)},[()=>Oa(e(w)).subject,()=>Oa(e(w)).description]),je(ta,()=>e(Ze),i=>l(Ze,i)),b(r,v)};I(Na,r=>{e(te)&&r(Rt)})}var At=s(Na,2);{var Tt=r=>{var v=Hs();v.__click=()=>l(ue,!1),v.__keydown=z=>{(z.key==="Escape"||z.key==="Enter"||z.key===" ")&&l(ue,!1)};var k=t(v);k.__click=z=>z.stopPropagation(),k.__keydown=z=>z.stopPropagation();var re=t(k),le=t(re),O=s(t(le),2),V=t(O);a(O),a(le);var M=s(le,2);M.__click=()=>l(ue,!1);var _e=t(M);et(_e,{size:20}),a(M),a(re);var F=s(re,2),B=t(F),ge=t(B);Xa(ge,{size:48}),A(2),a(B);var j=s(B,2),ie=s(t(j),2);ke(ie),A(2),a(j),a(F);var fe=s(F,2),Y=t(fe);Y.__click=()=>l(ue,!1);var H=s(Y,2);H.__click=wt;var Ce=t(H);st(Ce,{size:18});var ne=s(Ce);a(H),a(fe),a(k),a(v),N(()=>{n(V,`Gather insights from ${(e(se)?.total_count||0)??""} past members`),H.disabled=e(de),n(ne,` ${e(de)?"Sending...":"Send Survey"}`)}),je(ie,()=>e(da),z=>l(da,z)),b(r,v)};I(At,r=>{e(ue)&&r(Tt)})}N(()=>{Ve.disabled=e(Ue),n(Ct,` ${e(Ue)?"Refreshing...":"Refresh"}`)}),b(o,Ba),rs(),y()}Jt(["click","keydown","change"]);export{er as component,Vs as universal};
