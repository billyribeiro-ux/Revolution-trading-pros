import{z as ba,p as ua,s as V,A as pa,o as ha,f as T,a9 as ma,d as Ge,F as gt,q as a,aM as fa,dC as Ie,e as l,R as ga,c as r,g as e,cX as Ye,cY as Oe,M as Qe,i as I,ao as ka,ay as ya,by as wa,bJ as Xe,bG as kt,h as S,j as xa,E as za,B as yt,as as Sa,n as be,at as $a,H as u,r as t,bH as ue,P as wt,dB as Ca,b2 as Ma,w as Y,x as d,k as Ea,Z as Pa,bI as Ta,K as xt,aF as Fa,O as Z,N as Ba,bA as Da,b_ as zt,Q as La,c$ as Aa,cZ as Wa}from"../chunks/C_QN0JMx.js";import{c as H,e as Ze}from"../chunks/CZr5Exml.js";var ja=T('<div class="stats-grid svelte-1340tb4"><div class="stat-card svelte-1340tb4"><div class="stat-header svelte-1340tb4"><!> <span class="stat-label svelte-1340tb4">Total Churned</span></div> <div class="stat-value svelte-1340tb4"> </div> <div class="stat-sublabel svelte-1340tb4"><!> </div></div> <div class="stat-card recovery svelte-1340tb4"><div class="stat-header svelte-1340tb4"><!> <span class="stat-label svelte-1340tb4">Recovery Potential</span></div> <div class="stat-value svelte-1340tb4"> </div> <div class="stat-sublabel svelte-1340tb4"><!> Estimated monthly recovery</div></div> <div class="stat-card svelte-1340tb4"><div class="stat-header svelte-1340tb4"><!> <span class="stat-label svelte-1340tb4">Top Churn Reason</span></div> <div class="stat-value churn-reason svelte-1340tb4"> </div> <div class="stat-sublabel svelte-1340tb4"> </div></div></div>'),Ua=T('<button class="btn-email svelte-1340tb4"><!> </button>'),Ra=T('<div class="loading-state svelte-1340tb4"><div class="loader svelte-1340tb4"></div> <p>Loading churned members...</p></div>'),Va=T('<div class="empty-state svelte-1340tb4"><!> <h3 class="svelte-1340tb4">No churned members</h3> <p>Great news! No members have churned matching your filters.</p></div>'),Ha=T('<span class="days-ago svelte-1340tb4"> </span>'),Na=T('<tr><td class="checkbox-col svelte-1340tb4"><input type="checkbox" class="svelte-1340tb4"/></td><td class="svelte-1340tb4"><div class="member-info svelte-1340tb4"><div class="member-avatar churned svelte-1340tb4"> </div> <div class="member-details"><div class="member-name svelte-1340tb4"> </div> <div class="member-email svelte-1340tb4"> </div></div></div></td><td class="svelte-1340tb4"><span> </span></td><td class="svelte-1340tb4"><span class="product-name svelte-1340tb4"> </span></td><td class="svelte-1340tb4"><span> </span></td><td class="svelte-1340tb4"><div class="churn-date svelte-1340tb4"><span class="date svelte-1340tb4"> </span> <!></div></td><td class="svelte-1340tb4"><span class="churn-reason-text svelte-1340tb4"> </span></td><td class="svelte-1340tb4"><div class="actions svelte-1340tb4"><button class="action-btn winback svelte-1340tb4" title="Start Win-Back"><!></button> <button class="action-btn svelte-1340tb4" title="Send Email"><!></button> <button class="action-btn svelte-1340tb4" title="View Details"><!></button></div></td></tr>'),Ga=T('<div class="pagination svelte-1340tb4"><div class="pagination-info svelte-1340tb4"> </div> <div class="pagination-controls svelte-1340tb4"><button class="page-btn svelte-1340tb4"><!></button> <span class="page-indicator svelte-1340tb4"> </span> <button class="page-btn svelte-1340tb4"><!></button></div></div>'),Ia=T('<table class="members-table svelte-1340tb4"><thead class="svelte-1340tb4"><tr><th class="checkbox-col svelte-1340tb4"><input type="checkbox" aria-label="Select all churned members" class="svelte-1340tb4"/></th><th class="svelte-1340tb4">Member</th><th class="svelte-1340tb4">Win-Back Potential</th><th class="svelte-1340tb4">Last Product</th><th class="svelte-1340tb4">Total Spent</th><th class="svelte-1340tb4">Churned</th><th class="svelte-1340tb4">Reason</th><th class="svelte-1340tb4">Actions</th></tr></thead><tbody class="svelte-1340tb4"></tbody></table> <!>',1),Ya=T('<div class="modal-overlay svelte-1340tb4" role="dialog" tabindex="-1" aria-modal="true"><div class="modal-content svelte-1340tb4" role="document"><div class="modal-header svelte-1340tb4"><div><h2 class="svelte-1340tb4">Win-Back Campaign</h2> <p class="svelte-1340tb4"> </p></div> <button class="close-btn svelte-1340tb4"><!></button></div> <div class="modal-body svelte-1340tb4"><div class="campaign-type-selector svelte-1340tb4"><span class="selector-label svelte-1340tb4">Campaign Type</span> <div class="campaign-type-buttons svelte-1340tb4"><button><!> 30 Days Free</button> <button><!> 50% Off</button> <button><!> We Miss You</button></div></div> <div class="form-group svelte-1340tb4"><label for="email-subject" class="svelte-1340tb4">Subject Line</label> <input id="email-subject" type="text" placeholder="Email subject..." class="svelte-1340tb4"/></div> <div class="form-group svelte-1340tb4"><label for="email-body" class="svelte-1340tb4">Email Body</label> <textarea id="email-body" rows="12" class="svelte-1340tb4"></textarea> <p class="form-hint svelte-1340tb4"></p></div></div> <div class="modal-footer svelte-1340tb4"><button class="btn-secondary svelte-1340tb4">Cancel</button> <button class="btn-primary svelte-1340tb4"><!> Send Win-Back Email</button></div></div></div>'),Oa=T('<div class="churned-page svelte-1340tb4"><div class="page-header"><button class="back-btn svelte-1340tb4"><!> Back to Members</button> <div class="header-content svelte-1340tb4"><div class="header-title svelte-1340tb4"><div class="title-icon svelte-1340tb4"><!></div> <div><h1 class="svelte-1340tb4">Win-Back Center</h1> <p class="svelte-1340tb4">Re-engage past members with targeted campaigns</p></div></div> <button class="btn-refresh svelte-1340tb4"><!> Refresh</button></div></div> <div class="campaign-actions svelte-1340tb4"><button class="campaign-card free-trial svelte-1340tb4"><div class="campaign-icon svelte-1340tb4"><!></div> <div class="campaign-content svelte-1340tb4"><h3 class="svelte-1340tb4">30 Days Free</h3> <p class="svelte-1340tb4">Win back with a free trial offer</p></div> <span class="campaign-tag svelte-1340tb4">Popular</span></button> <button class="campaign-card promo svelte-1340tb4"><div class="campaign-icon svelte-1340tb4"><!></div> <div class="campaign-content svelte-1340tb4"><h3 class="svelte-1340tb4">50% Discount</h3> <p class="svelte-1340tb4">Exclusive comeback offer</p></div></button> <button class="campaign-card winback svelte-1340tb4"><div class="campaign-icon svelte-1340tb4"><!></div> <div class="campaign-content svelte-1340tb4"><h3 class="svelte-1340tb4">We Miss You</h3> <p class="svelte-1340tb4">Personal reconnection email</p></div></button></div> <!> <div class="toolbar svelte-1340tb4"><div class="search-box svelte-1340tb4"><!> <input id="search-churned-members" type="text" placeholder="Search churned members..." class="svelte-1340tb4"/></div> <div class="filters svelte-1340tb4"><div class="filter-group svelte-1340tb4"><!> <select class="svelte-1340tb4"><option>All Value</option><option>High Value ($500+)</option><option>Medium ($100-$500)</option><option>Low (&lt;$100)</option></select></div> <div class="filter-group svelte-1340tb4"><!> <select class="svelte-1340tb4"><option>Any Time</option><option>Last 7 days</option><option>Last 30 days</option><option>Last 90 days</option><option>Last 6 months</option></select></div></div> <!></div> <div class="members-table-container svelte-1340tb4"><!></div></div> <!>',1);function Za(St,$t){ua($t,!0);const ee=()=>yt(H,"$churnedStore",qe),te=()=>yt(Ze,"$emailStore",qe),[qe,Ct]=za();let F=be(()=>ee().members),O=be(()=>ee().stats),p=be(()=>ee().pagination),Mt=be(()=>ee().loading),pe=V(""),ae=V(""),se=V(""),i=V(pa(new Set)),B=V(!1),Q=V(""),X=V(""),L=V("winback");ha(async()=>{await H.loadChurnedMembers(),await Ze.loadTemplates()});async function Et(){await H.setFilters({search:e(pe)})}async function Pt(s){r(ae,s,!0),await H.setFilters({winback_potential:s})}async function Tt(s){r(se,s,!0),await H.setFilters({churned_within_days:s?Number(s):void 0})}function Ft(s){e(i).has(s)?e(i).delete(s):e(i).add(s),r(i,e(i),!0)}function Bt(){e(i).size===e(F).length?e(i).clear():e(F).forEach(s=>e(i).add(s.id)),r(i,e(i),!0)}async function Dt(){if(e(i).size!==0)try{const s=await Ze.sendBulkEmail({member_ids:Array.from(e(i)),subject:e(Q),body:e(X),campaign_type:e(L),personalize:!0});alert(s.message),r(B,!1),e(i).clear(),r(i,e(i),!0)}catch{alert("Failed to send emails")}}function he(s){r(Q,s.subject,!0),r(X,s.body||"",!0)}function le(s){r(L,s,!0);const n=te().presetTemplates;let c;switch(s){case"free_trial":c=n.find(_=>_.id==="winback_30_free");break;case"promo":c=n.find(_=>_.id==="winback_discount");break;default:c=n.find(_=>_.id==="winback_missed")}c&&(r(Q,c.subject,!0),r(X,c.body||"",!0)),r(B,!0)}function Je(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function Lt(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-"}function At(s){return s.first_name&&s.last_name?`${s.first_name[0]}${s.last_name[0]}`.toUpperCase():s.name?.slice(0,2).toUpperCase()||"U"}function Ke(s){return s>=500?"high":s>=100?"medium":"low"}function Wt(s){return s>=500?"High Value":s>=100?"Medium Value":"Low Value"}var et=Oa();ma("1340tb4",s=>{Sa(()=>{$a.title="Win-Back Center | Revolution Trading Pros"})});var me=Ge(et),fe=a(me),ie=a(fe);ie.__click=()=>gt("/admin/members");var jt=a(ie);fa(jt,{size:20}),u(),t(ie);var tt=l(ie,2),ge=a(tt),at=a(ge),Ut=a(at);Ie(Ut,{size:32}),t(at),u(2),t(ge);var ke=l(ge,2);ke.__click=()=>H.loadChurnedMembers();var Rt=a(ke);ga(Rt,{size:18}),u(),t(ke),t(tt),t(fe);var ye=l(fe,2),re=a(ye);re.__click=()=>{r(i,new Set(e(F).map(s=>s.id)),!0),le("free_trial")};var st=a(re),Vt=a(st);Ye(Vt,{size:28}),t(st),u(4),t(re);var ve=l(re,2);ve.__click=()=>{r(i,new Set(e(F).map(s=>s.id)),!0),le("promo")};var lt=a(ve),Ht=a(lt);Oe(Ht,{size:28}),t(lt),u(2),t(ve);var we=l(ve,2);we.__click=()=>{r(i,new Set(e(F).map(s=>s.id)),!0),le("winback")};var it=a(we),Nt=a(it);Qe(Nt,{size:28}),t(it),u(2),t(we),t(ye);var rt=l(ye,2);{var Gt=s=>{var n=ja(),c=a(n),_=a(c),N=a(_);wt(N,{size:24}),u(2),t(_);var m=l(_,2),$=a(m,!0);t(m);var y=l(m,2),A=a(y);Ca(A,{size:14});var W=l(A);t(y),t(c);var C=l(c,2),M=a(C),E=a(M);Oe(E,{size:24}),u(2),t(M);var j=l(M,2),q=a(j,!0);t(j);var h=l(j,2),v=a(h);Ma(v,{size:14}),u(),t(h),t(C);var f=l(C,2),g=a(f),x=a(g);wt(x,{size:24}),u(2),t(g);var b=l(g,2),z=a(b,!0);t(b);var w=l(b,2),P=a(w);t(w),t(f),t(n),Y((k,U)=>{d($,e(O).total_churned),d(W,` ${e(O).churned_this_month??""} this month`),d(q,k),d(z,U),d(P,`${(e(O).top_churn_reasons?.[0]?.count||0)??""} occurrences`)},[()=>Je(e(O).potential_recovery_revenue),()=>e(O).top_churn_reasons?.[0]?.reason?.replace(/"/g,"")||"Unknown"]),S(s,n)};I(rt,s=>{e(O)&&s(Gt)})}var xe=l(rt,2),ze=a(xe),vt=a(ze);ka(vt,{size:18});var Se=l(vt,2);ue(Se),Se.__keydown=s=>s.key==="Enter"&&Et(),t(ze);var $e=l(ze,2),Ce=a($e),nt=a(Ce);ya(nt,{size:16});var ne=l(nt,2);ne.__change=()=>Pt(e(ae));var Me=a(ne);Me.value=Me.__value="";var Ee=l(Me);Ee.value=Ee.__value="high";var Pe=l(Ee);Pe.value=Pe.__value="medium";var ot=l(Pe);ot.value=ot.__value="low",t(ne),t(Ce);var ct=l(Ce,2),dt=a(ct);wa(dt,{size:16});var oe=l(dt,2);oe.__change=()=>Tt(e(se));var Te=a(oe);Te.value=Te.__value="";var Fe=l(Te);Fe.value=Fe.__value="7";var Be=l(Fe);Be.value=Be.__value="30";var De=l(Be);De.value=De.__value="90";var _t=l(De);_t.value=_t.__value="180",t(oe),t(ct),t($e);var It=l($e,2);{var Yt=s=>{var n=Ua();n.__click=()=>r(B,!0);var c=a(n);Qe(c,{size:18});var _=l(c);t(n),Y(()=>d(_,` Email Selected (${e(i).size??""})`)),S(s,n)};I(It,s=>{e(i).size>0&&s(Yt)})}t(xe);var bt=l(xe,2),Ot=a(bt);{var Qt=s=>{var n=Ra();S(s,n)},Xt=s=>{var n=Ea(),c=Ge(n);{var _=m=>{var $=Va(),y=a($);Ie(y,{size:64,stroke:1}),u(4),t($),S(m,$)},N=m=>{var $=Ia(),y=Ge($),A=a(y),W=a(A),C=a(W),M=a(C);ue(M),M.__change=Bt,t(C),u(7),t(W),t(A);var E=l(A);Ba(E,21,()=>e(F),La,(h,v)=>{var f=Na();let g;var x=a(f),b=a(x);ue(b),b.__change=()=>Ft(e(v).id),t(x);var z=l(x),w=a(z),P=a(w),k=a(P,!0);t(P);var U=l(P,2),R=a(U),ce=a(R,!0);t(R);var G=l(R,2),Le=a(G,!0);t(G),t(U),t(w),t(z);var o=l(z),D=a(o),Jt=a(D,!0);t(D),t(o);var Ae=l(o),ut=a(Ae),Kt=a(ut,!0);t(ut),t(Ae);var We=l(Ae),je=a(We),ea=a(je,!0);t(je),t(We);var Ue=l(We),pt=a(Ue),Re=a(pt),ta=a(Re,!0);t(Re);var aa=l(Re,2);{var sa=J=>{var K=Ha(),Ne=a(K);t(K),Y(()=>d(Ne,`${e(v).days_since_churn??""}d ago`)),S(J,K)};I(aa,J=>{e(v).days_since_churn&&J(sa)})}t(pt),t(Ue);var Ve=l(Ue),ht=a(Ve),la=a(ht,!0);t(ht),t(Ve);var mt=l(Ve),ft=a(mt),de=a(ft);de.__click=()=>{e(i).clear(),e(i).add(e(v).id),r(i,e(i),!0),le("free_trial")};var ia=a(de);Ye(ia,{size:16}),t(de);var _e=l(de,2);_e.__click=()=>{e(i).clear(),e(i).add(e(v).id),r(i,e(i),!0),r(B,!0)};var ra=a(_e);Qe(ra,{size:16}),t(_e);var He=l(_e,2);He.__click=()=>gt(`/admin/members/${e(v).id}`);var va=a(He);Da(va,{size:16}),t(He),t(ft),t(mt),t(f),Y((J,K,Ne,na,oa,ca,da,_a)=>{g=Z(f,1,"svelte-1340tb4",null,g,J),zt(b,K),xt(b,"aria-label",`Select ${e(v).name??""}`),d(k,Ne),d(ce,e(v).name),d(Le,e(v).email),Z(D,1,`potential-badge ${na??""}`,"svelte-1340tb4"),d(Jt,oa),d(Kt,e(v).last_product||"-"),Z(je,1,`spending ${ca??""}`,"svelte-1340tb4"),d(ea,da),d(ta,_a),d(la,e(v).churn_reason||"Unknown")},[()=>({selected:e(i).has(e(v).id)}),()=>e(i).has(e(v).id),()=>At(e(v)),()=>Ke(e(v).total_spent),()=>Wt(e(v).total_spent),()=>Ke(e(v).total_spent),()=>Je(e(v).total_spent),()=>Lt(e(v).churned_at)]),S(h,f)}),t(E),t(y);var j=l(y,2);{var q=h=>{var v=Ga(),f=a(v),g=a(f);t(f);var x=l(f,2),b=a(x);b.__click=()=>H.goToPage(e(p).current_page-1);var z=a(b);Aa(z,{size:18}),t(b);var w=l(b,2),P=a(w);t(w);var k=l(w,2);k.__click=()=>H.goToPage(e(p).current_page+1);var U=a(k);Wa(U,{size:18}),t(k),t(x),t(v),Y(R=>{d(g,`Showing ${(e(p).current_page-1)*e(p).per_page+1} to ${R??""} of ${e(p).total??""}`),b.disabled=e(p).current_page===1,d(P,`Page ${e(p).current_page??""} of ${e(p).last_page??""}`),k.disabled=e(p).current_page===e(p).last_page},[()=>Math.min(e(p).current_page*e(p).per_page,e(p).total)]),S(h,v)};I(j,h=>{e(p)&&h(q)})}Y(()=>zt(M,e(i).size===e(F).length&&e(F).length>0)),S(m,$)};I(c,m=>{e(F).length===0?m(_):m(N,!1)},!0)}S(s,n)};I(Ot,s=>{e(Mt)?s(Qt):s(Xt,!1)})}t(bt),t(me);var Zt=l(me,2);{var qt=s=>{var n=Ya();n.__click=()=>r(B,!1),n.__keydown=o=>o.key==="Escape"&&r(B,!1);var c=a(n);c.__click=o=>o.stopPropagation(),c.__keydown=o=>o.stopPropagation();var _=a(c),N=a(_),m=l(a(N),2),$=a(m);t(m),t(N);var y=l(N,2);y.__click=()=>r(B,!1);var A=a(y);Pa(A,{size:20}),t(y),t(_);var W=l(_,2),C=a(W),M=l(a(C),2),E=a(M);E.__click=()=>{r(L,"free_trial");const o=te().presetTemplates.find(D=>D.id==="winback_30_free");o&&he(o)};let j;var q=a(E);Ye(q,{size:18}),u(),t(E);var h=l(E,2);h.__click=()=>{r(L,"promo");const o=te().presetTemplates.find(D=>D.id==="winback_discount");o&&he(o)};let v;var f=a(h);Oe(f,{size:18}),u(),t(h);var g=l(h,2);g.__click=()=>{r(L,"winback");const o=te().presetTemplates.find(D=>D.id==="winback_missed");o&&he(o)};let x;var b=a(g);Ie(b,{size:18}),u(),t(g),t(M),t(C);var z=l(C,2),w=l(a(z),2);ue(w),t(z);var P=l(z,2),k=l(a(P),2);Ta(k),xt(k,"placeholder",`Email body... Use ${{name}} for personalization`);var U=l(k,2);U.textContent="Available variables: {{name}}, {{first_name}}, {{email}}",t(P),t(W);var R=l(W,2),ce=a(R);ce.__click=()=>r(B,!1);var G=l(ce,2);G.__click=Dt;var Le=a(G);Fa(Le,{size:18}),u(),t(G),t(R),t(c),t(n),Y(()=>{d($,`Sending to ${e(i).size??""} member${e(i).size>1?"s":""}`),j=Z(E,1,"svelte-1340tb4",null,j,{active:e(L)==="free_trial"}),v=Z(h,1,"svelte-1340tb4",null,v,{active:e(L)==="promo"}),x=Z(g,1,"svelte-1340tb4",null,x,{active:e(L)==="winback"}),G.disabled=!e(Q)||!e(X)}),Xe(w,()=>e(Q),o=>r(Q,o)),Xe(k,()=>e(X),o=>r(X,o)),S(s,n)};I(Zt,s=>{e(B)&&s(qt)})}Xe(Se,()=>e(pe),s=>r(pe,s)),kt(ne,()=>e(ae),s=>r(ae,s)),kt(oe,()=>e(se),s=>r(se,s)),S(St,et),xa(),Ct()}ba(["click","keydown","change"]);export{Za as component};
