var ns=Object.defineProperty;var os=(p,t,e)=>t in p?ns(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var A=(p,t,e)=>os(p,typeof t!="symbol"?t+"":t,e);import{ab as it,ac as z,d1 as mt,z as ls,p as cs,s as F,A as Jt,o as us,C as ds,f as E,a9 as ps,d as G,i as O,e as u,q as d,bJ as Bt,g as a,bG as Ht,h as C,j as hs,c as m,as as vs,at as ms,bH as ye,r as l,w as V,x as k,H as ht,N as Gt,Q as Yt,k as vt,n as bs,bI as xe,bO as fs,O as gs}from"../chunks/C_QN0JMx.js";import{_ as $}from"../chunks/PPVm8Dsz.js";import{getAuthToken as ys}from"../chunks/D3S43Cfl.js";const _e={subscriptions:[],filters:{},loading:!1,error:null};function xs(){const{subscribe:p,set:t,update:e}=z(_e);return{subscribe:p,loadSubscriptions:async s=>{e(n=>({...n,loading:!0,error:null}));try{const{getSubscriptions:n}=await $(async()=>{const{getSubscriptions:r}=await Promise.resolve().then(()=>D);return{getSubscriptions:r}},void 0,import.meta.url),c=await n(s);e(r=>({...r,subscriptions:c,filters:s||{},loading:!1}))}catch{e(c=>({...c,error:"Failed to load subscriptions",loading:!1}))}},updateStatus:async(s,n,c)=>{e(r=>({...r,loading:!0}));try{const{updateSubscription:r}=await $(async()=>{const{updateSubscription:v}=await Promise.resolve().then(()=>D);return{updateSubscription:v}},void 0,import.meta.url),o=await r(s,{status:n,...c&&{cancellationReason:c,pauseReason:c}});e(v=>({...v,subscriptions:v.subscriptions.map(g=>g.id===s?{...g,...o}:g),loading:!1}))}catch{e(o=>({...o,error:"Failed to update subscription",loading:!1}))}},pauseSubscription:async(s,n)=>{e(c=>({...c,loading:!0}));try{const{pauseSubscription:c}=await $(async()=>{const{pauseSubscription:o}=await Promise.resolve().then(()=>D);return{pauseSubscription:o}},void 0,import.meta.url),r=await c(s,n);e(o=>({...o,subscriptions:o.subscriptions.map(v=>v.id===s?{...v,...r}:v),loading:!1}))}catch{e(r=>({...r,error:"Failed to pause subscription",loading:!1}))}},resumeSubscription:async s=>{e(n=>({...n,loading:!0}));try{const{resumeSubscription:n}=await $(async()=>{const{resumeSubscription:r}=await Promise.resolve().then(()=>D);return{resumeSubscription:r}},void 0,import.meta.url),c=await n(s);e(r=>({...r,subscriptions:r.subscriptions.map(o=>o.id===s?{...o,...c}:o),loading:!1}))}catch{e(c=>({...c,error:"Failed to resume subscription",loading:!1}))}},cancelSubscription:async(s,n,c=!1)=>{e(r=>({...r,loading:!0}));try{const{cancelSubscription:r}=await $(async()=>{const{cancelSubscription:v}=await Promise.resolve().then(()=>D);return{cancelSubscription:v}},void 0,import.meta.url),o=await r(s,n,c);e(v=>({...v,subscriptions:v.subscriptions.map(g=>g.id===s?{...g,...o}:g),loading:!1}))}catch{e(o=>({...o,error:"Failed to cancel subscription",loading:!1}))}},reactivateSubscription:async s=>{e(n=>({...n,loading:!0}));try{const{reactivateSubscription:n}=await $(async()=>{const{reactivateSubscription:r}=await Promise.resolve().then(()=>D);return{reactivateSubscription:r}},void 0,import.meta.url),c=await n(s);e(r=>({...r,subscriptions:r.subscriptions.map(o=>o.id===s?{...o,...c}:o),loading:!1}))}catch{e(c=>({...c,error:"Failed to reactivate subscription",loading:!1}))}},retryPayment:async(s,n)=>{e(c=>({...c,loading:!0}));try{const{retryPayment:c}=await $(async()=>{const{retryPayment:v}=await Promise.resolve().then(()=>D);return{retryPayment:v}},void 0,import.meta.url);await c(s,n);const{getSubscriptions:r}=await $(async()=>{const{getSubscriptions:v}=await Promise.resolve().then(()=>D);return{getSubscriptions:v}},void 0,import.meta.url),o=await r();e(v=>({...v,subscriptions:o,loading:!1}))}catch{e(r=>({...r,error:"Failed to retry payment",loading:!1}))}},updatePaymentMethod:async(s,n)=>{e(c=>({...c,loading:!0}));try{const{updatePaymentMethod:c}=await $(async()=>{const{updatePaymentMethod:o}=await Promise.resolve().then(()=>D);return{updatePaymentMethod:o}},void 0,import.meta.url),r=await c(s,n);e(o=>({...o,subscriptions:o.subscriptions.map(v=>v.id===s?{...v,...r}:v),loading:!1}))}catch{e(r=>({...r,error:"Failed to update payment method",loading:!1}))}},processRenewal:async s=>{e(n=>({...n,loading:!0}));try{const{processPayment:n}=await $(async()=>{const{processPayment:o}=await Promise.resolve().then(()=>D);return{processPayment:o}},void 0,import.meta.url);await n(s);const{getSubscriptions:c}=await $(async()=>{const{getSubscriptions:o}=await Promise.resolve().then(()=>D);return{getSubscriptions:o}},void 0,import.meta.url),r=await c();e(o=>({...o,subscriptions:r,loading:!1}))}catch{e(c=>({...c,error:"Failed to process renewal",loading:!1}))}},recordPaymentFailure:async(s,n)=>{e(c=>({...c,loading:!0}));try{const{getSubscriptions:c}=await $(async()=>{const{getSubscriptions:o}=await Promise.resolve().then(()=>D);return{getSubscriptions:o}},void 0,import.meta.url),r=await c();e(o=>({...o,subscriptions:r,loading:!1}))}catch{e(r=>({...r,error:"Failed to record payment failure",loading:!1}))}},setFilters:s=>{e(n=>({...n,filters:s}))},clearFilters:()=>{e(s=>({...s,filters:{}}))},reset:()=>{t(_e)}}}const ke=xs();it(ke,p=>{let t=p.subscriptions;if(p.filters.status&&p.filters.status.length>0&&(t=t.filter(e=>p.filters.status.includes(e.status))),p.filters.interval&&p.filters.interval.length>0&&(t=t.filter(e=>p.filters.interval.includes(e.interval))),p.filters.searchQuery){const e=p.filters.searchQuery.toLowerCase();t=t.filter(s=>s.productName.toLowerCase().includes(e)||s.userId.toLowerCase().includes(e)||s.id.toLowerCase().includes(e))}return p.filters.dateFrom&&(t=t.filter(e=>e.createdAt>=p.filters.dateFrom)),p.filters.dateTo&&(t=t.filter(e=>e.createdAt<=p.filters.dateTo)),t});it(ke,p=>{const t=p.subscriptions,e=t.filter(r=>r.status==="active").length,s=new Date;s.setDate(1),s.setHours(0,0,0,0);const n=t.filter(r=>new Date(r.createdAt)>=s&&r.status==="active").length;return{total:t.length,active:e,totalActive:e,newThisMonth:n,onHold:t.filter(r=>r.status==="on-hold").length,cancelled:t.filter(r=>r.status==="cancelled").length,expired:t.filter(r=>r.status==="expired").length,pendingCancel:t.filter(r=>r.status==="pending-cancel").length,monthlyRecurringRevenue:_s(t),churnRate:ws(t),averageLifetimeValue:Ss(t)}});function _s(p){return p.filter(t=>t.status==="active"||t.status==="pending-cancel").reduce((t,e)=>{let s=e.price;return e.interval==="quarterly"?s=e.price/3:e.interval==="yearly"&&(s=e.price/12),t+s},0)}function ws(p){const t=p.filter(s=>s.status==="active").length,e=p.filter(s=>s.status==="cancelled").length;return t===0?0:e/(t+e)*100}function Ss(p){return p.length===0?0:p.reduce((e,s)=>e+s.totalPaid,0)/p.length}const w="http://localhost:8000/api",X="http://localhost:8002/api",ks=3e5,we=3,Se=1e3,Ps=3e4,Rs=6e4,Y=class Y{constructor(){A(this,"cache",new Map);A(this,"wsConnection");A(this,"metricsInterval");A(this,"pendingRequests",new Map);A(this,"retryQueue",[]);A(this,"subscriptions",z([]));A(this,"currentSubscription",z(null));A(this,"stats",z(null));A(this,"revenueMetrics",z(null));A(this,"churnMetrics",z(null));A(this,"isLoading",z(!1));A(this,"error",z(null));A(this,"activeSubscriptions",it(this.subscriptions,t=>t.filter(e=>e.status==="active")));A(this,"atRiskSubscriptions",it(this.subscriptions,t=>t.filter(e=>e.health?.status==="at-risk")));A(this,"upcomingRenewals",it(this.subscriptions,t=>t.filter(e=>{if(!e.billingCycle?.currentPeriodEnd)return!1;const s=(new Date(e.billingCycle.currentPeriodEnd).getTime()-Date.now())/864e5;return s<=7&&s>=0})));this.initialize()}static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}initialize(){this.setupWebSocket(),this.startMetricsCollection(),this.processRetryQueue()}getAuthToken(){return ys()||""}async authFetch(t,e={}){const{skipCache:s=!1,cacheTTL:n=ks,retryable:c=!0,...r}=e,o=`${r.method||"GET"}:${t}`;if(!s&&(!r.method||r.method==="GET")){const g=this.getFromCache(o);if(g)return g}if(this.pendingRequests.has(o)&&!r.method)return this.pendingRequests.get(o);const v=this.executeRequest(t,r,c);(!r.method||r.method==="GET")&&this.pendingRequests.set(o,v);try{const g=await v;return(!r.method||r.method==="GET")&&this.setCache(o,g,n),g}finally{this.pendingRequests.delete(o)}}async executeRequest(t,e,s,n=1){const c=new AbortController,r=setTimeout(()=>c.abort(),Ps);try{const o=await fetch(t,{...e,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.getAuthToken()}`,"X-Request-ID":this.generateRequestId(),"X-Idempotency-Key":this.generateIdempotencyKey(t,e),...e.headers},credentials:"include",signal:c.signal});if(clearTimeout(r),!o.ok){const v=await o.json().catch(()=>({message:"Request failed"}));if(o.status===402)throw new Cs(v.message);if(o.status===429){const g=parseInt(o.headers.get("Retry-After")||"60",10);throw new Ts(v.message,g)}throw new Error(v.message||`HTTP ${o.status}`)}return o.json()}catch(o){if(clearTimeout(r),s&&n<we&&this.shouldRetry(o)){const v=Se*Math.pow(2,n-1);return await new Promise(g=>setTimeout(g,v)),this.executeRequest(t,e,s,n+1)}throw this.isCriticalOperation(t,e)&&this.addToRetryQueue({url:t,options:e,error:o,timestamp:Date.now(),attempts:0}),o}}setupWebSocket(){this.getAuthToken()}authenticate(){this.wsConnection?.send(JSON.stringify({type:"auth",token:this.getAuthToken()}))}subscribeToUpdates(){this.wsConnection?.send(JSON.stringify({type:"subscribe",channels:["subscriptions","payments","metrics"]}))}handleWebSocketMessage(t){try{const e=JSON.parse(t.data);switch(e.type){case"subscription_updated":this.handleSubscriptionUpdate(e.data);break;case"payment_processed":this.handlePaymentUpdate(e.data);break;case"metrics_update":this.handleMetricsUpdate(e.data);break;case"alert":this.handleAlert(e.data);break}}catch{}}handleSubscriptionUpdate(t){this.subscriptions.update(s=>{const n=s.findIndex(c=>c.id===t.id);return n>=0?s[n]=t:s.push(t),s}),mt(this.currentSubscription)?.id===t.id&&this.currentSubscription.set(t),this.showNotification(`Subscription ${t.id} updated`)}handlePaymentUpdate(t){this.subscriptions.update(e=>{const s=e.find(n=>n.id===t.metadata?.subscriptionId);if(s){const n={id:t.id,amount:t.amount,status:t.status==="succeeded"?"paid":t.status==="failed"?"failed":"pending",paymentDate:t.createdAt,dueDate:t.createdAt,paymentMethod:typeof t.method=="string"?t.method:t.method.type,failureReason:t.attempts.find(c=>c.error)?.error,retryCount:t.attempts.length-1};s.paymentHistory=[...s.paymentHistory||[],n]}return e}),t.status==="failed"&&this.showNotification(`Payment failed for subscription ${t.metadata?.subscriptionId}`,"error")}handleMetricsUpdate(t){this.revenueMetrics.update(e=>({...e,...t}))}handleAlert(t){this.showNotification(t.message,t.severity)}startMetricsCollection(){this.loadMetrics(),this.metricsInterval=window.setInterval(()=>{this.loadMetrics()},Rs)}async loadMetrics(){try{const[t,e,s]=await Promise.all([this.getRevenueMetrics().catch(()=>null),this.getChurnMetrics().catch(()=>null),this.getStats().catch(()=>null)]);t&&this.revenueMetrics.set(t),e&&this.churnMetrics.set(e),s&&this.stats.set(s)}catch{}}addToRetryQueue(t){this.retryQueue.push({...t,timestamp:Date.now(),attempts:0})}async processRetryQueue(){setInterval(async()=>{const t=Date.now(),e=this.retryQueue.filter(s=>t-s.timestamp>Se*Math.pow(2,s.attempts));for(const s of e)try{await this.executeRequest(s.url,s.options,!1),this.retryQueue=this.retryQueue.filter(n=>n!==s)}catch{s.attempts++,s.attempts>=we&&(this.retryQueue=this.retryQueue.filter(c=>c!==s))}},1e4)}getFromCache(t){const e=this.cache.get(t);return e&&Date.now()<e.expiry?e.data:null}setCache(t,e,s){this.cache.set(t,{data:e,expiry:Date.now()+s})}clearCache(t){if(t)for(const e of this.cache.keys())e.includes(t)&&this.cache.delete(e);else this.cache.clear()}generateRequestId(){return`req_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}generateIdempotencyKey(t,e){const s=`${t}${JSON.stringify(e.body||{})}`;return btoa(s).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}shouldRetry(t){return!(t.status>=400&&t.status<500)}isCriticalOperation(t,e){return!!(t.includes("/payment")||t.includes("/charge")||e.method==="POST"&&t.includes("/subscriptions"))}showNotification(t,e="info"){}async getSubscriptions(t,e=!1){this.isLoading.set(!0),this.error.set(null);try{const s=this.buildFilterParams(t),n=e?`${w}/admin/subscriptions`:`${w}/my/subscriptions`,c=await this.authFetch(`${n}?${s}`),r=c.subscriptions||c.data||[];return this.subscriptions.set(r),r}catch(s){throw this.error.set(s.message),s}finally{this.isLoading.set(!1)}}async getSubscription(t){this.isLoading.set(!0),this.error.set(null);try{const e=await this.authFetch(`${w}/my/subscriptions/${t}`);return this.currentSubscription.set(e),e}catch(e){throw this.error.set(e.message),e}finally{this.isLoading.set(!1)}}async createSubscription(t){this.isLoading.set(!0),this.error.set(null);try{const e=await this.authFetch(`${w}/my/subscriptions`,{method:"POST",body:JSON.stringify(t),skipCache:!0});return this.subscriptions.update(s=>[...s,e]),this.clearCache("/subscriptions"),this.trackEvent("subscription_created",{subscription_id:e.id,plan:e.planId,mrr:e.mrr}),e}catch(e){throw this.error.set(e.message),e}finally{this.isLoading.set(!1)}}async updateSubscription(t,e){this.isLoading.set(!0),this.error.set(null);try{const s=await this.authFetch(`${w}/my/subscriptions/${t}`,{method:"PATCH",body:JSON.stringify(e),skipCache:!0});return this.handleSubscriptionUpdate(s),this.clearCache(`/subscriptions/${t}`),s}catch(s){throw this.error.set(s.message),s}finally{this.isLoading.set(!1)}}async pauseSubscription(t,e){return this.updateSubscriptionStatus(t,"on-hold",{reason:e})}async resumeSubscription(t){return this.updateSubscriptionStatus(t,"active")}async cancelSubscription(t,e,s=!1){return this.updateSubscriptionStatus(t,s?"cancelled":"pending-cancel",{reason:e,immediate:s})}async reactivateSubscription(t){return this.updateSubscriptionStatus(t,"active",{reactivated:!0})}async updateSubscriptionStatus(t,e,s){this.isLoading.set(!0),this.error.set(null);try{const n=await this.authFetch(`${w}/my/subscriptions/${t}/cancel`,{method:"PUT",body:JSON.stringify({status:e,...s}),skipCache:!0});return this.handleSubscriptionUpdate(n),this.trackEvent("subscription_status_changed",{subscription_id:t,old_status:mt(this.currentSubscription)?.status,new_status:e,...s}),n}catch(n){throw this.error.set(n.message),n}finally{this.isLoading.set(!1)}}async processPayment(t,e){this.isLoading.set(!0),this.error.set(null);try{const s=await this.authFetch(`${w}/my/subscriptions/${t}/charge`,{method:"POST",body:JSON.stringify({amount:e}),skipCache:!0,retryable:!0});return this.handlePaymentUpdate(s),s}catch(s){throw this.error.set(s.message),this.trackEvent("payment_failed",{subscription_id:t,amount:e,error:s.message}),s}finally{this.isLoading.set(!1)}}async retryPayment(t,e){return this.authFetch(`${w}/my/subscriptions/${t}/retry-payment`,{method:"POST",skipCache:!0})}async updatePaymentMethod(t,e){return this.authFetch(`${w}/my/subscriptions/${t}/payment-method`,{method:"PUT",body:JSON.stringify({paymentMethod:e}),skipCache:!0})}async getPaymentHistory(t){return(await this.authFetch(`${w}/my/subscriptions/${t}/payments`)).payments}async getStats(){return this.authFetch(`${w}/my/subscriptions/metrics`)}async getRevenueMetrics(){return this.authFetch(`${X}/revenue/metrics`)}async getChurnMetrics(){return this.authFetch(`${X}/churn/metrics`)}async getCohortAnalysis(t){return this.authFetch(`${X}/cohorts/${t}`)}async getChurnPredictions(){return(await this.authFetch(`${X}/churn/predictions`)).predictions}async getUpsellRecommendations(t){return(await this.authFetch(`${X}/upsell/recommendations/${t}`)).recommendations}async configureDunning(t){await this.authFetch(`${w}/dunning/configure`,{method:"POST",body:JSON.stringify(t),skipCache:!0})}async getDunningCampaigns(){return(await this.authFetch(`${w}/dunning/campaigns`)).campaigns}async pauseDunning(t){await this.authFetch(`${w}/my/subscriptions/${t}/dunning/pause`,{method:"POST",skipCache:!0})}async generateInvoice(t){return this.authFetch(`${w}/my/subscriptions/${t}/invoices/generate`,{method:"POST",skipCache:!0})}async getInvoices(t){return(await this.authFetch(`${w}/my/subscriptions/${t}/invoices`)).invoices}async downloadInvoice(t){const e=await fetch(`${w}/invoices/${t}/download`,{headers:{Authorization:`Bearer ${this.getAuthToken()}`}});if(!e.ok)throw new Error("Failed to download invoice");return e.blob()}async exportSubscriptions(t="csv"){const e=await fetch(`${w}/subscriptions/export?format=${t}`,{headers:{Authorization:`Bearer ${this.getAuthToken()}`}});if(!e.ok)throw new Error("Export failed");return e.blob()}async generateReport(t,e){return this.authFetch(`${w}/reports/generate`,{method:"POST",body:JSON.stringify({type:t,params:e}),skipCache:!0})}async configureWebhook(t){await this.authFetch(`${w}/webhooks/configure`,{method:"POST",body:JSON.stringify(t),skipCache:!0})}async testWebhook(t,e){return(await this.authFetch(`${w}/webhooks/test`,{method:"POST",body:JSON.stringify({url:t,event:e}),skipCache:!0})).success}buildFilterParams(t){const e=new URLSearchParams;return t&&(t.status&&t.status.forEach(s=>e.append("status[]",s)),t.interval&&t.interval.forEach(s=>e.append("interval[]",s)),t.searchQuery&&e.append("search",t.searchQuery),t.dateFrom&&e.append("date_from",t.dateFrom),t.dateTo&&e.append("date_to",t.dateTo)),e.toString()}trackEvent(t,e){"gtag"in window&&window.gtag("event",t,e),this.authFetch(`${X}/events/track`,{method:"POST",body:JSON.stringify({event:t,data:e,timestamp:Date.now()}),skipCache:!0}).catch(s=>{})}};A(Y,"instance");let Wt=Y;class Cs extends Error{constructor(t){super(t),this.name="PaymentRequiredError"}}class Ts extends Error{constructor(t,e){super(t),this.retryAfter=e,this.name="RateLimitError"}}const x=Wt.getInstance();x.subscriptions;x.currentSubscription;x.activeSubscriptions;x.atRiskSubscriptions;x.upcomingRenewals;x.stats;x.revenueMetrics;x.churnMetrics;x.isLoading;x.error;const Pe=(p,t=!1)=>x.getSubscriptions(p,t),As=(p,t)=>x.updateSubscription(p,t),Re=(p,t)=>x.pauseSubscription(p,t),Ce=p=>x.resumeSubscription(p),Te=(p,t,e)=>x.cancelSubscription(p,t,e),Ae=p=>x.reactivateSubscription(p),Ms=(p,t)=>x.processPayment(p,t),Me=(p,t)=>x.retryPayment(p,t),Fs=(p,t)=>x.updatePaymentMethod(p,t),Fe=()=>x.getStats(),Ee=()=>mt(x.upcomingRenewals),Le=()=>mt(x.subscriptions).filter(t=>t.failedAttempts>0||t.dunningStatus?.stage==="cancelled"||t.status==="on-hold"),D=Object.freeze(Object.defineProperty({__proto__:null,cancelSubscription:Te,getFailedPayments:Le,getSubscriptionStats:Fe,getSubscriptions:Pe,getUpcomingRenewals:Ee,pauseSubscription:Re,processPayment:Ms,reactivateSubscription:Ae,resumeSubscription:Ce,retryPayment:Me,updatePaymentMethod:Fs,updateSubscription:As},Symbol.toStringTag,{value:"Module"}));var Es=E('<div class="bg-red-500/10 border border-red-500/20 rounded-xl p-4 mb-6"><p class="text-red-400"> </p></div>'),Ls=E('<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Active Subscriptions</h3> <div class="w-10 h-10 bg-emerald-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div> <p class="text-3xl font-bold text-white"> </p> <p class="text-sm text-emerald-400 mt-2"> </p></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Monthly Revenue</h3> <div class="w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div> <p class="text-3xl font-bold text-white"> </p> <p class="text-sm text-slate-400 mt-2">MRR</p></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Churn Rate</h3> <div class="w-10 h-10 bg-orange-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg></div></div> <p class="text-3xl font-bold text-white"> </p> <p class="text-sm text-slate-400 mt-2">Last 30 days</p></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Avg Lifetime Value</h3> <div class="w-10 h-10 bg-purple-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg></div></div> <p class="text-3xl font-bold text-white"> </p> <p class="text-sm text-slate-400 mt-2">Per customer</p></div></div>'),$s=E('<div class="flex items-center justify-between text-sm"><span class="text-slate-300"> </span> <button class="text-emerald-400 hover:text-emerald-300 font-medium">Retry Payment</button></div>'),Ds=E('<div class="bg-red-500/10 border border-red-500/20 rounded-xl p-6 mb-6"><h3 class="text-red-400 font-semibold mb-3 flex items-center gap-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> </h3> <div class="space-y-2"></div></div>'),Is=E('<div class="flex items-center justify-between text-sm"><span class="text-slate-300"> </span> <span class="text-blue-400"> </span></div>'),Os=E('<div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-6 mb-6"><h3 class="text-blue-400 font-semibold mb-3 flex items-center gap-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg> </h3> <div class="space-y-2"></div></div>'),Ns=E('<tr><td colspan="7" class="px-6 py-12 text-center text-slate-400"><div class="flex items-center justify-center gap-3"><div class="w-5 h-5 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"></div> Loading subscriptions...</div></td></tr>'),js=E('<tr><td colspan="7" class="px-6 py-12 text-center text-slate-400">No subscriptions found</td></tr>'),qs=E('<button class="text-orange-400 hover:text-orange-300 text-sm font-medium" title="Pause">Pause</button> <button class="text-red-400 hover:text-red-300 text-sm font-medium" title="Cancel">Cancel</button>',1),Vs=E('<button class="text-emerald-400 hover:text-emerald-300 text-sm font-medium" title="Resume">Resume</button> <button class="text-red-400 hover:text-red-300 text-sm font-medium" title="Cancel">Cancel</button>',1),Us=E('<button class="text-emerald-400 hover:text-emerald-300 text-sm font-medium" title="Reactivate">Reactivate</button>'),Qs=E('<tr class="hover:bg-slate-700/30 transition-colors"><td class="px-6 py-4"><div class="text-white font-medium"> </div> <div class="text-sm text-slate-400"> </div></td><td class="px-6 py-4"><div class="text-slate-300"> </div></td><td class="px-6 py-4"><span> </span></td><td class="px-6 py-4 text-slate-300"> </td><td class="px-6 py-4 text-white font-medium"> </td><td class="px-6 py-4 text-slate-300"> </td><td class="px-6 py-4"><div class="flex items-center gap-2"><!></div></td></tr>'),zs=E('<div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"><div class="bg-slate-800 border border-slate-700 rounded-2xl p-8 max-w-md w-full"><h3 class="text-2xl font-bold text-white mb-4">Pause Subscription</h3> <p class="text-slate-400 mb-6"> </p> <div class="mb-6"><label for="pauseReason" class="block text-sm font-medium text-slate-400 mb-2">Reason for pausing <span class="text-red-400">*</span></label> <textarea id="pauseReason" rows="3" placeholder="Enter reason..." class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:border-orange-500"></textarea></div> <div class="flex gap-3"><button class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-xl transition-colors">Cancel</button> <button class="flex-1 px-6 py-3 bg-orange-500 hover:bg-orange-600 text-white font-semibold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Pause Subscription</button></div></div></div>'),Js=E(`<div class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"><div class="bg-slate-800 border border-slate-700 rounded-2xl p-8 max-w-md w-full"><h3 class="text-2xl font-bold text-white mb-4">Cancel Subscription</h3> <p class="text-slate-400 mb-6"> </p> <div class="mb-6"><label for="cancelReason" class="block text-sm font-medium text-slate-400 mb-2">Cancellation reason <span class="text-red-400">*</span></label> <textarea id="cancelReason" rows="3" placeholder="Enter reason..." class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:border-red-500"></textarea></div> <div class="mb-6"><label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="w-4 h-4 bg-slate-900 border-slate-600 rounded text-red-500 focus:ring-red-500"/> <span class="text-slate-300 text-sm">Cancel immediately (don't wait until period end)</span></label></div> <div class="flex gap-3"><button class="flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white font-semibold rounded-xl transition-colors">Go Back</button> <button class="flex-1 px-6 py-3 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed">Cancel Subscription</button></div></div></div>`),Bs=E('<div class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 py-12 px-4"><div class="max-w-7xl mx-auto"><div class="mb-8"><h1 class="text-4xl font-bold text-white mb-2">Subscription Management</h1> <p class="text-slate-400">Monitor and manage all customer subscriptions</p></div> <!> <!> <!> <!> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div><label for="search" class="block text-sm font-medium text-slate-400 mb-2">Search</label> <input type="text" id="search" placeholder="Search subscriptions..." class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500"/></div> <div><label for="status" class="block text-sm font-medium text-slate-400 mb-2">Status</label> <select id="status" class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"><option>All Statuses</option><option>Active</option><option>Pending</option><option>On Hold</option><option>Cancelled</option><option>Expired</option><option>Pending Cancel</option></select></div> <div><label for="interval" class="block text-sm font-medium text-slate-400 mb-2">Interval</label> <select id="interval" class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"><option>All Intervals</option><option>Monthly</option><option>Quarterly</option><option>Yearly</option></select></div> <div><label for="sort" class="block text-sm font-medium text-slate-400 mb-2">Sort By</label> <select id="sort" class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"><option>Date</option><option>Price</option><option>Status</option></select></div></div></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl overflow-hidden"><div class="overflow-x-auto svelte-1v4qcr5"><table class="w-full"><thead class="bg-slate-900/50"><tr><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Product</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Customer</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Status</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Interval</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Price</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Next Payment</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Actions</th></tr></thead><tbody class="divide-y divide-slate-700"><!></tbody></table></div></div></div></div> <!> <!>',1);function Ks(p,t){cs(t,!0);let e=F(Jt([])),s=F(null),n=F(Jt([])),c=F(Jt([])),r=F(!0),o=F(""),v=F("all"),g=F(""),W=F("all"),nt=F("date"),L=F(null),ot=F(!1),lt=F(!1),J=F(""),B=F(""),Z=F(!1),tt=null;us(async()=>{await q()}),ds(()=>{tt&&clearTimeout(tt)});function $e(){tt&&clearTimeout(tt),tt=setTimeout(()=>{q()},300)}async function q(){m(r,!0),m(o,"");try{const i=await Promise.allSettled([Pe({status:a(v)==="all"?void 0:[a(v)],interval:a(W)==="all"?void 0:[a(W)],searchQuery:a(g)||void 0},!0),Fe(),Ee(),Le()]),[h,f,y,M]=i;m(e,h.status==="fulfilled"?h.value:[],!0),m(s,f.status==="fulfilled"?f.value:{total:0,active:0,totalActive:0,newThisMonth:0,onHold:0,cancelled:0,expired:0,pendingCancel:0,monthlyRecurringRevenue:0,churnRate:0,averageLifetimeValue:0},!0),m(n,y.status==="fulfilled"?y.value:[],!0),m(c,M.status==="fulfilled"?M.value:[],!0),h.status==="rejected"&&m(o,"Failed to load subscriptions. Some data may be unavailable.")}catch{m(o,"Failed to load subscription data")}finally{m(r,!1)}}let Kt=bs(()=>a(e).filter(i=>{if(a(v)!=="all"&&i.status!==a(v)||a(W)!=="all"&&i.interval!==a(W))return!1;if(a(g)){const h=a(g).toLowerCase();return i.productName.toLowerCase().includes(h)||i.userId.toLowerCase().includes(h)||i.id.toLowerCase().includes(h)}return!0}).sort((i,h)=>a(nt)==="date"?new Date(h.startDate).getTime()-new Date(i.startDate).getTime():a(nt)==="price"?h.price-i.price:i.status.localeCompare(h.status)));async function De(i){m(L,i,!0),m(lt,!0)}async function Ie(){if(!(!a(L)||!a(B).trim()))try{await Re(a(L).id,a(B)),m(lt,!1),m(B,""),m(L,null),await q()}catch{}}async function Oe(i){try{await Ce(i.id),await q()}catch{}}async function Xt(i){m(L,i,!0),m(ot,!0)}async function Ne(){if(!(!a(L)||!a(J).trim()))try{await Te(a(L).id,a(J),a(Z)),m(ot,!1),m(J,""),m(Z,!1),m(L,null),await q()}catch{}}async function je(i){try{await Ae(i.id),await q()}catch{}}async function qe(i,h){try{await Me(i,h),await q()}catch{}}function Ve(i){switch(i){case"active":return"bg-emerald-500/10 text-emerald-400 border-emerald-500/20";case"pending":return"bg-yellow-500/10 text-yellow-400 border-yellow-500/20";case"on-hold":return"bg-orange-500/10 text-orange-400 border-orange-500/20";case"cancelled":return"bg-red-500/10 text-red-400 border-red-500/20";case"expired":return"bg-slate-500/10 text-slate-400 border-slate-500/20";case"pending-cancel":return"bg-pink-500/10 text-pink-400 border-pink-500/20";default:return"bg-slate-500/10 text-slate-400 border-slate-500/20"}}function bt(i){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i)}function Zt(i){return new Date(i).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function Ue(i){return i.charAt(0).toUpperCase()+i.slice(1)}var te=Bs();ps("1v4qcr5",i=>{vs(()=>{ms.title="Subscription Management - Admin"})});var ft=G(te),ee=d(ft),se=u(d(ee),2);{var Qe=i=>{var h=Es(),f=d(h),y=d(f,!0);l(f),l(h),V(()=>k(y,a(o))),C(i,h)};O(se,i=>{a(o)&&i(Qe)})}var ae=u(se,2);{var ze=i=>{var h=Ls(),f=d(h),y=u(d(f),2),M=d(y,!0);l(y);var _=u(y,2),P=d(_);l(_),l(f);var S=u(f,2),T=u(d(S),2),b=d(T,!0);l(T),ht(2),l(S);var R=u(S,2),I=u(d(R),2),N=d(I);l(I),ht(2),l(R);var j=u(R,2),et=u(d(j),2),Dt=d(et,!0);l(et),ht(2),l(j),l(h),V((st,dt,It)=>{k(M,a(s).totalActive),k(P,`${a(s).newThisMonth>0?"+":""}${a(s).newThisMonth??""} this month`),k(b,st),k(N,`${dt??""}%`),k(Dt,It)},[()=>bt(a(s).monthlyRecurringRevenue),()=>a(s).churnRate.toFixed(1),()=>bt(a(s).averageLifetimeValue)]),C(i,h)};O(ae,i=>{a(s)&&i(ze)})}var re=u(ae,2);{var Je=i=>{var h=Ds(),f=d(h),y=u(d(f));l(f);var M=u(f,2);Gt(M,21,()=>a(c).slice(0,3),Yt,(_,P)=>{var S=$s(),T=d(S),b=d(T,!0);l(T);var R=u(T,2);R.__click=()=>qe(a(P).subscriptionId,a(P).id),l(S),V(()=>k(b,a(P).subscriptionId)),C(_,S)}),l(M),l(h),V(()=>k(y,` ${a(c).length??""} Failed Payment${a(c).length>1?"s":""}`)),C(i,h)};O(re,i=>{a(c).length>0&&i(Je)})}var ie=u(re,2);{var Be=i=>{var h=Os(),f=d(h),y=u(d(f));l(f);var M=u(f,2);Gt(M,21,()=>a(n).slice(0,3),Yt,(_,P)=>{var S=Is(),T=d(S),b=d(T,!0);l(T);var R=u(T,2),I=d(R,!0);l(R),l(S),V(N=>{k(b,a(P).productName),k(I,N)},[()=>Zt(a(P).nextPaymentDate)]),C(_,S)}),l(M),l(h),V(()=>k(y,` ${a(n).length??""} Renewal${a(n).length>1?"s":""} in Next 7 Days`)),C(i,h)};O(ie,i=>{a(n).length>0&&i(Be)})}var gt=u(ie,2),ne=d(gt),yt=d(ne),xt=u(d(yt),2);ye(xt),xt.__input=$e,l(yt);var _t=u(yt,2),ct=u(d(_t),2);ct.__change=q;var wt=d(ct);wt.value=wt.__value="all";var St=u(wt);St.value=St.__value="active";var kt=u(St);kt.value=kt.__value="pending";var Pt=u(kt);Pt.value=Pt.__value="on-hold";var Rt=u(Pt);Rt.value=Rt.__value="cancelled";var Ct=u(Rt);Ct.value=Ct.__value="expired";var oe=u(Ct);oe.value=oe.__value="pending-cancel",l(ct),l(_t);var Tt=u(_t,2),ut=u(d(Tt),2);ut.__change=q;var At=d(ut);At.value=At.__value="all";var Mt=u(At);Mt.value=Mt.__value="monthly";var Ft=u(Mt);Ft.value=Ft.__value="quarterly";var le=u(Ft);le.value=le.__value="yearly",l(ut),l(Tt);var ce=u(Tt,2),Et=u(d(ce),2),Lt=d(Et);Lt.value=Lt.__value="date";var $t=u(Lt);$t.value=$t.__value="price";var ue=u($t);ue.value=ue.__value="status",l(Et),l(ce),l(ne),l(gt);var de=u(gt,2),pe=d(de),he=d(pe),ve=u(d(he)),He=d(ve);{var Ge=i=>{var h=Ns();C(i,h)},Ye=i=>{var h=vt(),f=G(h);{var y=_=>{var P=js();C(_,P)},M=_=>{var P=vt(),S=G(P);Gt(S,17,()=>a(Kt),Yt,(T,b)=>{var R=Qs(),I=d(R),N=d(I),j=d(N,!0);l(N);var et=u(N,2),Dt=d(et);l(et),l(I);var st=u(I),dt=d(st),It=d(dt);l(dt),l(st);var Ot=u(st),Nt=d(Ot),Ze=d(Nt,!0);l(Nt),l(Ot);var jt=u(Ot),ts=d(jt,!0);l(jt);var qt=u(jt),es=d(qt,!0);l(qt);var Vt=u(qt),ss=d(Vt,!0);l(Vt);var be=u(Vt),fe=d(be),as=d(fe);{var rs=U=>{var H=qs(),K=G(H);K.__click=()=>De(a(b));var at=u(K,2);at.__click=()=>Xt(a(b)),C(U,H)},is=U=>{var H=vt(),K=G(H);{var at=Q=>{var rt=Vs(),pt=G(rt);pt.__click=()=>Oe(a(b));var Qt=u(pt,2);Qt.__click=()=>Xt(a(b)),C(Q,rt)},Ut=Q=>{var rt=vt(),pt=G(rt);{var Qt=zt=>{var ge=Us();ge.__click=()=>je(a(b)),C(zt,ge)};O(pt,zt=>{a(b).status==="cancelled"&&zt(Qt)},!0)}C(Q,rt)};O(K,Q=>{a(b).status==="on-hold"?Q(at):Q(Ut,!1)},!0)}C(U,H)};O(as,U=>{a(b).status==="active"?U(rs):U(is,!1)})}l(fe),l(be),l(R),V((U,H,K,at,Ut,Q)=>{k(j,a(b).productName),k(Dt,`${U??""}...`),k(It,`${H??""}...`),gs(Nt,1,`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${K??""}`,"svelte-1v4qcr5"),k(Ze,a(b).status),k(ts,at),k(es,Ut),k(ss,Q)},[()=>a(b).id.slice(0,8),()=>a(b).userId.slice(0,8),()=>Ve(a(b).status),()=>Ue(a(b).interval),()=>bt(a(b).price),()=>Zt(a(b).nextPaymentDate)]),C(T,R)}),C(_,P)};O(f,_=>{a(Kt).length===0?_(y):_(M,!1)},!0)}C(i,h)};O(He,i=>{a(r)?i(Ge):i(Ye,!1)})}l(ve),l(he),l(pe),l(de),l(ee),l(ft);var me=u(ft,2);{var We=i=>{var h=zs(),f=d(h),y=u(d(f),2),M=d(y);l(y);var _=u(y,2),P=u(d(_),2);xe(P),l(_);var S=u(_,2),T=d(S);T.__click=()=>{m(lt,!1),m(B,""),m(L,null)};var b=u(T,2);b.__click=Ie,l(S),l(f),l(h),V(R=>{k(M,`Are you sure you want to pause ${a(L).productName??""}?`),b.disabled=R},[()=>!a(B).trim()]),Bt(P,()=>a(B),R=>m(B,R)),C(i,h)};O(me,i=>{a(lt)&&a(L)&&i(We)})}var Ke=u(me,2);{var Xe=i=>{var h=Js(),f=d(h),y=u(d(f),2),M=d(y);l(y);var _=u(y,2),P=u(d(_),2);xe(P),l(_);var S=u(_,2),T=d(S),b=d(T);ye(b),ht(2),l(T),l(S);var R=u(S,2),I=d(R);I.__click=()=>{m(ot,!1),m(J,""),m(Z,!1),m(L,null)};var N=u(I,2);N.__click=Ne,l(R),l(f),l(h),V(j=>{k(M,`Are you sure you want to cancel ${a(L).productName??""}?`),N.disabled=j},[()=>!a(J).trim()]),Bt(P,()=>a(J),j=>m(J,j)),fs(b,()=>a(Z),j=>m(Z,j)),C(i,h)};O(Ke,i=>{a(ot)&&a(L)&&i(Xe)})}Bt(xt,()=>a(g),i=>m(g,i)),Ht(ct,()=>a(v),i=>m(v,i)),Ht(ut,()=>a(W),i=>m(W,i)),Ht(Et,()=>a(nt),i=>m(nt,i)),C(p,te),hs()}ls(["click","input","change"]);export{Ks as component};
