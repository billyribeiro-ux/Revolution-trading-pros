import{z as ja,p as Ba,s as y,A as Pe,o as Ga,f as _,a9 as Ia,i as w,h as n,j as Wa,E as Ya,as as Xa,e as s,q as t,c as v,B as Za,at as $a,r as e,g as a,R as et,n as na,db as Ee,H as f,w as N,k as X,d as U,U as Fe,aR as He,cY as at,aH as tt,K as r,x as o,O as se,ao as st,bH as lt,N as Qe,Q as nt,bJ as it,bG as rt,_ as vt,J as ot,bU as dt,bV as ct}from"../chunks/C_QN0JMx.js";import{a as qe}from"../chunks/lN6oCIqA.js";import{c as bt,e as ut}from"../chunks/KfBlM_pv.js";import{A as _t}from"../chunks/BvIese_r.js";import{S as pt}from"../chunks/szWSpB32.js";var mt=_('<div class="header-actions svelte-eb331n"><button class="btn-refresh svelte-eb331n"><!></button> <button class="btn-primary svelte-eb331n"><!> Add Contact</button></div>'),ft=_("<option> </option>"),ht=_('<div class="loading-state svelte-eb331n"><div class="spinner svelte-eb331n"></div> <p>Loading contacts...</p></div>'),gt=_('<div class="error-state svelte-eb331n"><p> </p> <button>Try Again</button></div>'),Ct=_('<div class="empty-state svelte-eb331n"><!> <h3 class="svelte-eb331n">No contacts found</h3> <p class="svelte-eb331n">Add your first contact to get started with CRM</p> <button class="btn-primary svelte-eb331n"><!> Add Contact</button></div>'),yt=_('<tr class="svelte-eb331n"><td class="svelte-eb331n"><div class="contact-cell svelte-eb331n"><div class="contact-avatar svelte-eb331n"> </div> <div class="contact-info svelte-eb331n"><span class="contact-name svelte-eb331n"> </span> <span class="contact-email svelte-eb331n"> </span></div></div></td><td class="svelte-eb331n"> </td><td class="svelte-eb331n"><span> </span></td><td class="svelte-eb331n"> </td><td class="svelte-eb331n"> </td><td class="svelte-eb331n"><div class="action-buttons svelte-eb331n"><button class="btn-icon svelte-eb331n" title="View"><!></button> <button class="btn-icon svelte-eb331n" title="Edit"><!></button> <button class="btn-icon danger svelte-eb331n" title="Delete"><!></button></div></td></tr>'),wt=_('<div class="table-container svelte-eb331n"><table class="data-table svelte-eb331n" data-entity="contacts" aria-label="Contacts List"><thead><tr><th class="svelte-eb331n">Contact</th><th class="svelte-eb331n">Company</th><th class="svelte-eb331n">Status</th><th class="svelte-eb331n">Last Activity</th><th class="svelte-eb331n">Value</th><th class="svelte-eb331n">Actions</th></tr></thead><tbody class="svelte-eb331n"></tbody></table></div>'),xt=_('<div class="filters-bar svelte-eb331n" data-component="filters" aria-label="Contact Filters"><div class="search-box svelte-eb331n"><!> <input type="text" placeholder="Search contacts..." aria-label="Search contacts" data-filter="search" class="svelte-eb331n"/></div> <select class="filter-select svelte-eb331n" aria-label="Filter by status" data-filter="status"></select></div> <div data-component="contacts-table"><!></div>',1),Mt=_('<div class="empty-state svelte-eb331n"><!> <h3 class="svelte-eb331n">Deals Management</h3> <p class="svelte-eb331n">Track and manage your sales deals</p></div>'),zt=_('<div class="pipeline-column svelte-eb331n"><div class="pipeline-header svelte-eb331n"><span class="pipeline-name svelte-eb331n"> </span> <span class="pipeline-count svelte-eb331n">0</span></div> <div class="pipeline-cards svelte-eb331n"><div class="pipeline-empty svelte-eb331n">No deals</div></div></div>'),Dt=_('<div class="pipeline-view svelte-eb331n" data-component="pipeline" aria-label="Sales Pipeline"></div>'),Lt=_('<section class="stats-grid svelte-eb331n" data-section="statistics" aria-label="CRM Statistics"><div class="stat-card svelte-eb331n" data-stat="total-contacts" aria-label="Total Contacts"><div class="stat-icon blue svelte-eb331n"><!></div> <div class="stat-content svelte-eb331n"><span class="stat-value svelte-eb331n"> </span> <span class="stat-label svelte-eb331n">Total Contacts</span></div></div> <div class="stat-card svelte-eb331n" data-stat="new-this-month" aria-label="New Contacts This Month"><div class="stat-icon green svelte-eb331n"><!></div> <div class="stat-content svelte-eb331n"><span class="stat-value svelte-eb331n"> </span> <span class="stat-label svelte-eb331n">New This Month</span></div></div> <div class="stat-card svelte-eb331n" data-stat="active-deals" aria-label="Active Deals"><div class="stat-icon purple svelte-eb331n"><!></div> <div class="stat-content svelte-eb331n"><span class="stat-value svelte-eb331n"> </span> <span class="stat-label svelte-eb331n">Active Deals</span></div></div> <div class="stat-card svelte-eb331n" data-stat="pipeline-value" aria-label="Pipeline Value"><div class="stat-icon amber svelte-eb331n"><!></div> <div class="stat-content svelte-eb331n"><span class="stat-value svelte-eb331n" data-currency="USD"> </span> <span class="stat-label svelte-eb331n">Pipeline Value</span></div></div></section> <div class="tabs svelte-eb331n" data-section="navigation" aria-label="CRM Navigation Tabs" role="tablist"><button role="tab" data-tab="contacts"><!> Contacts</button> <button role="tab" data-tab="deals"><!> Deals</button> <button role="tab" data-tab="pipeline"><!> Pipeline</button></div> <section data-section="content" aria-label="CRM Content"><!></section>',1),Rt=_('<div class="crm-page svelte-eb331n" data-page="crm" data-module="customer-relationship-management" role="main" aria-label="CRM Dashboard"><header class="page-header svelte-eb331n" data-section="header" aria-label="Page Header"><div><h1 class="svelte-eb331n">Customer Relationship Management</h1> <p class="page-description svelte-eb331n">Manage contacts, deals, and customer relationships</p></div> <!></header> <!></div>');function Ut(ia,ra){Ba(ra,!0);const le=()=>Za(ut,"$isCrmConnected",va),[va,oa]=Ya();let ne=y(Pe([])),Je=y(Pe([])),R=y(!0),Ke=y(!0),J=y(""),V=y(""),d=y("contacts"),Z=y("all"),g=y(Pe({totalContacts:0,newThisMonth:0,activeDeals:0,dealValue:0}));const da=[{value:"all",label:"All Contacts"},{value:"lead",label:"Leads"},{value:"prospect",label:"Prospects"},{value:"customer",label:"Customers"},{value:"churned",label:"Churned"}],ca=[{id:"lead",name:"Lead",color:"#94a3b8"},{id:"qualified",name:"Qualified",color:"#60a5fa"},{id:"proposal",name:"Proposal",color:"#a78bfa"},{id:"negotiation",name:"Negotiation",color:"#fbbf24"},{id:"closed",name:"Closed Won",color:"#4ade80"}];async function ie(){v(R,!0),v(J,"");try{const[l,p,c]=await Promise.allSettled([qe.get("/api/admin/crm/contacts"),qe.get("/api/admin/crm/deals"),qe.get("/api/admin/crm/stats")]);if(l.status==="fulfilled"&&v(ne,l.value?.data||l.value?.contacts||[],!0),p.status==="fulfilled"&&v(Je,p.value?.data||p.value?.deals||[],!0),c.status==="fulfilled"){const x=c.value?.data||c.value;v(g,{totalContacts:x?.total_contacts||a(ne).length,newThisMonth:x?.new_this_month||0,activeDeals:x?.active_deals||a(Je).length,dealValue:x?.deal_value||0},!0)}}catch(l){v(J,l instanceof Error?l.message:"Failed to load CRM data",!0)}finally{v(R,!1)}}function Oe(l){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(l)}function ba(l){return l?new Date(l).toLocaleDateString():"N/A"}let $=na(()=>a(ne).filter(l=>{const p=!a(V)||l.name?.toLowerCase().includes(a(V).toLowerCase())||l.email?.toLowerCase().includes(a(V).toLowerCase())||l.company?.toLowerCase().includes(a(V).toLowerCase()),c=a(Z)==="all"||l.status===a(Z);return p&&c}));Ga(async()=>{await bt.load(),v(Ke,!1),le()?await ie():v(R,!1)});var re=Rt();Ia("eb331n",l=>{Xa(()=>{$a.title="CRM - Admin Dashboard"})});var ve=t(re),ua=s(t(ve),2);{var _a=l=>{var p=mt(),c=t(p);c.__click=ie;var x=t(c);{let ae=na(()=>a(R)?"spinning":"");et(x,{size:18,get class(){return a(ae)}})}e(c);var ee=s(c,2),M=t(ee);Ee(M,{size:18}),f(),e(ee),e(p),N(()=>c.disabled=a(R)),n(l,p)};w(ua,l=>{le()&&l(_a)})}e(ve);var pa=s(ve,2);{var ma=l=>{pt(l,{variant:"dashboard"})},fa=l=>{var p=X(),c=U(p);{var x=M=>{_t(M,{serviceName:"CRM",description:"Connect a CRM platform to manage contacts, track deals, and streamline your customer relationships.",serviceKey:"hubspot",icon:"ðŸ‘¥",color:"#f97316",features:["Centralized contact management","Track deals through your pipeline","Log activities and communications","Automated follow-up reminders","Revenue forecasting and reporting"]})},ee=M=>{var ae=Lt(),oe=U(ae),de=t(oe),ce=t(de),ha=t(ce);Fe(ha,{size:24}),e(ce);var je=s(ce,2),be=t(je),ga=t(be,!0);e(be),f(2),e(je),e(de);var ue=s(de,2),_e=t(ue),Ca=t(_e);Ee(Ca,{size:24}),e(_e);var Be=s(_e,2),pe=t(Be),ya=t(pe,!0);e(pe),f(2),e(Be),e(ue);var me=s(ue,2),fe=t(me),wa=t(fe);He(wa,{size:24}),e(fe);var Ge=s(fe,2),he=t(Ge),xa=t(he,!0);e(he),f(2),e(Ge),e(me);var Ie=s(me,2),ge=t(Ie),Ma=t(ge);at(Ma,{size:24}),e(ge);var We=s(ge,2),Ce=t(We),za=t(Ce,!0);e(Ce),f(2),e(We),e(Ie),e(oe);var ye=s(oe,2),P=t(ye);let Ye;P.__click=()=>v(d,"contacts");var Da=t(P);Fe(Da,{size:18}),f(),e(P);var E=s(P,2);let Xe;E.__click=()=>v(d,"deals");var La=t(E);He(La,{size:18}),f(),e(E);var K=s(E,2);let Ze;K.__click=()=>v(d,"pipeline");var Ra=t(K);tt(Ra,{size:18}),f(),e(K),e(ye);var we=s(ye,2),Sa=t(we);{var Aa=z=>{var S=xt(),O=U(S),j=t(O),te=t(j);st(te,{size:18});var C=s(te,2);lt(C),e(j);var h=s(j,2);Qe(h,21,()=>da,nt,(i,b)=>{var u=ft(),A=t(u,!0);e(u);var T={};N(()=>{o(A,a(b).label),T!==(T=a(b).value)&&(u.value=(u.__value=a(b).value)??"")}),n(i,u)}),e(h),e(O);var D=s(O,2),xe=t(D);{var B=i=>{var b=ht();n(i,b)},G=i=>{var b=X(),u=U(b);{var A=L=>{var F=gt(),I=t(F),Me=t(I,!0);e(I);var ze=s(I,2);ze.__click=ie,e(F),N(()=>o(Me,a(J))),n(L,F)},T=L=>{var F=X(),I=U(F);{var Me=H=>{var k=Ct(),W=t(k);Fe(W,{size:48});var Y=s(W,6),Q=t(Y);Ee(Q,{size:18}),f(),e(Y),e(k),n(H,k)},ze=H=>{var k=wt(),W=t(k),Y=s(t(W));Qe(Y,21,()=>a($),Q=>Q.id||Q.email,(Q,m)=>{var q=yt(),De=t(q),$e=t(De),Le=t($e),ka=t(Le,!0);e(Le);var ea=s(Le,2),Re=t(ea),Na=t(Re,!0);e(Re);var aa=s(Re,2),Ua=t(aa,!0);e(aa),e(ea),e($e),e(De);var Se=s(De),Va=t(Se,!0);e(Se);var Ae=s(Se),Te=t(Ae),Pa=t(Te,!0);e(Te),e(Ae);var ke=s(Ae),Ea=t(ke,!0);e(ke);var Ne=s(ke),Fa=t(Ne,!0);e(Ne);var ta=s(Ne),sa=t(ta),Ue=t(sa),Ha=t(Ue);ot(Ha,{size:16}),e(Ue);var Ve=s(Ue,2),Qa=t(Ve);dt(Qa,{size:16}),e(Ve);var la=s(Ve,2),qa=t(la);ct(qa,{size:16}),e(la),e(sa),e(ta),e(q),N((Ja,Ka,Oa)=>{r(q,"data-contact-id",a(m).id),r(q,"data-contact-email",a(m).email),r(q,"data-contact-status",a(m).status||"lead"),o(ka,Ja),o(Na,a(m).name||"Unknown"),o(Ua,a(m).email||"No email"),o(Va,a(m).company||"-"),se(Te,1,`status-badge ${(a(m).status||"lead")??""}`,"svelte-eb331n"),o(Pa,a(m).status||"Lead"),o(Ea,Ka),o(Fa,Oa)},[()=>a(m).name?.charAt(0).toUpperCase()||"?",()=>ba(a(m).last_activity_at),()=>a(m).lifetime_value?Oe(a(m).lifetime_value):"-"]),n(Q,q)}),e(Y),e(W),e(k),n(H,k)};w(I,H=>{a($).length===0?H(Me):H(ze,!1)},!0)}n(L,F)};w(u,L=>{a(J)?L(A):L(T,!1)},!0)}n(i,b)};w(xe,i=>{a(R)?i(B):i(G,!1)})}e(D),N(()=>{r(D,"data-state",a(R)?"loading":a(J)?"error":a($).length===0?"empty":"loaded"),r(D,"data-count",a($).length)}),it(C,()=>a(V),i=>v(V,i)),rt(h,()=>a(Z),i=>v(Z,i)),n(z,S)},Ta=z=>{var S=X(),O=U(S);{var j=C=>{var h=Mt(),D=t(h);He(D,{size:48}),f(4),e(h),n(C,h)},te=C=>{var h=X(),D=U(h);{var xe=B=>{var G=Dt();Qe(G,21,()=>ca,i=>i.id,(i,b)=>{var u=zt(),A=t(u),T=t(A),L=t(T,!0);e(T),f(2),e(A),f(2),e(u),N(()=>{r(u,"data-stage-id",a(b).id),r(u,"data-stage-name",a(b).name),vt(A,`border-color: ${a(b).color??""}`),o(L,a(b).name)}),n(i,u)}),e(G),n(B,G)};w(D,B=>{a(d)==="pipeline"&&B(xe)},!0)}n(C,h)};w(O,C=>{a(d)==="deals"?C(j):C(te,!1)},!0)}n(z,S)};w(Sa,z=>{a(d)==="contacts"?z(Aa):z(Ta,!1)})}e(we),N((z,S)=>{r(be,"data-value",a(g).totalContacts),o(ga,z),r(pe,"data-value",a(g).newThisMonth),o(ya,a(g).newThisMonth),r(he,"data-value",a(g).activeDeals),o(xa,a(g).activeDeals),r(Ce,"data-value",a(g).dealValue),o(za,S),Ye=se(P,1,"tab svelte-eb331n",null,Ye,{active:a(d)==="contacts"}),r(P,"aria-selected",a(d)==="contacts"),Xe=se(E,1,"tab svelte-eb331n",null,Xe,{active:a(d)==="deals"}),r(E,"aria-selected",a(d)==="deals"),Ze=se(K,1,"tab svelte-eb331n",null,Ze,{active:a(d)==="pipeline"}),r(K,"aria-selected",a(d)==="pipeline"),r(we,"data-active-tab",a(d))},[()=>a(g).totalContacts.toLocaleString(),()=>Oe(a(g).dealValue)]),n(M,ae)};w(c,M=>{le()?M(ee,!1):M(x)},!0)}n(l,p)};w(pa,l=>{a(Ke)?l(ma):l(fa,!1)})}e(re),n(ia,re),Wa(),oa()}ja(["click"]);export{Ut as component};
