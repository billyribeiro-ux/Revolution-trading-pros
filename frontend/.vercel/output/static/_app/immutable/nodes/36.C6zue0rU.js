import{z as ze,p as Se,s as x,A as Ot,o as Le,f as p,a9 as ke,q as e,R as Ee,bM as jt,cd as ut,aW as Re,U as Te,aH as Ue,ao as Oe,N as Nt,i as gt,w as N,bJ as je,g as s,bG as Ne,h as d,j as De,c,as as Pe,e as r,n as Dt,x as n,at as He,r as t,H as A,bH as Je,Q as Pt,k as Ht,d as Jt,J as Me,bU as $e,bZ as Be,bC as Qe,bV as Ve,O as qe,K as Mt}from"../chunks/C_QN0JMx.js";import{c as D}from"../chunks/L2eW2QSs.js";var Ge=p("<option> </option>"),Ie=p('<div class="loading-state svelte-14s6w0g"><div class="spinner svelte-14s6w0g"></div> <p>Loading automations...</p></div>'),Ke=p('<div class="error-state svelte-14s6w0g"><p> </p> <button>Try Again</button></div>'),We=p('<div class="empty-state svelte-14s6w0g"><!> <h3 class="svelte-14s6w0g">No automations found</h3> <p class="svelte-14s6w0g">Create your first automation to engage contacts automatically</p> <a href="/admin/crm/automations/new" class="btn-primary svelte-14s6w0g"><!> Create Automation</a></div>'),Ze=p('<tr class="svelte-14s6w0g"><td class="svelte-14s6w0g"><div class="funnel-cell svelte-14s6w0g"><div class="funnel-icon svelte-14s6w0g"><!></div> <div class="funnel-info svelte-14s6w0g"><span class="funnel-title svelte-14s6w0g"> </span> <span class="funnel-meta svelte-14s6w0g"> </span></div></div></td><td class="svelte-14s6w0g"><span> </span></td><td class="svelte-14s6w0g"><span class="trigger-badge svelte-14s6w0g"> </span></td><td class="svelte-14s6w0g"> </td><td class="svelte-14s6w0g"> </td><td class="svelte-14s6w0g"> </td><td class="svelte-14s6w0g"><div class="action-buttons svelte-14s6w0g"><a class="btn-icon svelte-14s6w0g" title="View"><!></a> <a class="btn-icon svelte-14s6w0g" title="Edit"><!></a> <button class="btn-icon svelte-14s6w0g" title="Duplicate"><!></button> <button class="btn-icon svelte-14s6w0g" title="Export"><!></button> <button class="btn-icon danger svelte-14s6w0g" title="Delete"><!></button></div></td></tr>'),Xe=p('<div class="table-container svelte-14s6w0g"><table class="data-table svelte-14s6w0g"><thead><tr><th class="svelte-14s6w0g">Automation</th><th class="svelte-14s6w0g">Status</th><th class="svelte-14s6w0g">Trigger</th><th class="svelte-14s6w0g">Contacts</th><th class="svelte-14s6w0g">Completed</th><th class="svelte-14s6w0g">Completion Rate</th><th class="svelte-14s6w0g">Actions</th></tr></thead><tbody class="svelte-14s6w0g"></tbody></table></div>'),Ye=p('<div class="automations-page svelte-14s6w0g"><div class="page-header svelte-14s6w0g"><div><h1 class="svelte-14s6w0g">Automation Funnels</h1> <p class="page-description svelte-14s6w0g">Create powerful marketing automations triggered by events</p></div> <div class="header-actions svelte-14s6w0g"><button class="btn-refresh svelte-14s6w0g"><!></button> <a href="/admin/crm/automations/new" class="btn-primary svelte-14s6w0g"><!> New Automation</a></div></div> <div class="stats-grid svelte-14s6w0g"><div class="stat-card svelte-14s6w0g"><div class="stat-icon blue svelte-14s6w0g"><!></div> <div class="stat-content svelte-14s6w0g"><span class="stat-value svelte-14s6w0g"> </span> <span class="stat-label svelte-14s6w0g">Total Automations</span></div></div> <div class="stat-card svelte-14s6w0g"><div class="stat-icon green svelte-14s6w0g"><!></div> <div class="stat-content svelte-14s6w0g"><span class="stat-value svelte-14s6w0g"> </span> <span class="stat-label svelte-14s6w0g">Active</span></div></div> <div class="stat-card svelte-14s6w0g"><div class="stat-icon purple svelte-14s6w0g"><!></div> <div class="stat-content svelte-14s6w0g"><span class="stat-value svelte-14s6w0g"> </span> <span class="stat-label svelte-14s6w0g">Total Contacts</span></div></div> <div class="stat-card svelte-14s6w0g"><div class="stat-icon amber svelte-14s6w0g"><!></div> <div class="stat-content svelte-14s6w0g"><span class="stat-value svelte-14s6w0g"> </span> <span class="stat-label svelte-14s6w0g">Completed</span></div></div></div> <div class="filters-bar svelte-14s6w0g"><div class="search-box svelte-14s6w0g"><!> <input type="text" placeholder="Search automations..." class="svelte-14s6w0g"/></div> <select class="filter-select svelte-14s6w0g"></select></div> <!></div>');function ss($t,Bt){Se(Bt,!0);let m=x(Ot([])),C=x(!0),g=x(""),F=x(""),b=x("all"),P="all",z=x(Ot({total:0,active:0,totalSubscribers:0,completed:0}));const Qt=[{value:"all",label:"All Automations"},{value:"draft",label:"Draft"},{value:"active",label:"Active"},{value:"paused",label:"Paused"}],Vt={contact_created:"Contact Created",tag_applied:"Tag Applied",tag_removed:"Tag Removed",list_applied:"List Applied",list_removed:"List Removed",form_submitted:"Form Submitted",order_completed:"Order Completed",subscription_started:"Subscription Started",user_login:"User Login",custom_event:"Custom Event"};async function S(){c(C,!0),c(g,"");try{const a={search:s(F)||void 0,status:s(b)!=="all"?s(b):void 0,trigger_type:P!=="all"?P:void 0},l=await D.getAutomationFunnels(a);c(m,l.data||[],!0),c(z,{total:s(m).length,active:s(m).filter(i=>i.status==="active").length,totalSubscribers:s(m).reduce((i,o)=>i+o.subscribers_count,0),completed:s(m).reduce((i,o)=>i+o.completed_count,0)},!0)}catch(a){c(g,a instanceof Error?a.message:"Failed to load automations",!0)}finally{c(C,!1)}}async function qt(a){try{await D.duplicateAutomationFunnel(a),await S()}catch(l){c(g,l instanceof Error?l.message:"Failed to duplicate automation",!0)}}async function Gt(a){if(confirm("Are you sure you want to delete this automation?"))try{await D.deleteAutomationFunnel(a),await S()}catch(l){c(g,l instanceof Error?l.message:"Failed to delete automation",!0)}}async function It(a){try{const l=await D.exportAutomationFunnel(a),i=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),o=URL.createObjectURL(i),u=document.createElement("a");u.href=o,u.download=`automation-${a}.json`,u.click(),URL.revokeObjectURL(o)}catch(l){c(g,l instanceof Error?l.message:"Failed to export automation",!0)}}function w(a){return a.toLocaleString()}function Kt(a){return{draft:"bg-slate-500/20 text-slate-400",active:"bg-emerald-500/20 text-emerald-400",paused:"bg-amber-500/20 text-amber-400"}[a]}let _t=Dt(()=>s(m).filter(a=>{const l=!s(F)||a.title.toLowerCase().includes(s(F).toLowerCase()),i=s(b)==="all"||a.status===s(b);return l&&i&&P==="all"}));Le(()=>{S()});var H=Ye();ke("14s6w0g",a=>{Pe(()=>{He.title="Automation Funnels - FluentCRM Pro"})});var J=e(H),pt=r(e(J),2),L=e(pt);L.__click=()=>S();var Wt=e(L);{let a=Dt(()=>s(C)?"spinning":"");Ee(Wt,{size:18,get class(){return s(a)}})}t(L);var mt=r(L,2),Zt=e(mt);jt(Zt,{size:18}),A(),t(mt),t(pt),t(J);var M=r(J,2),$=e(M),B=e($),Xt=e(B);ut(Xt,{size:24}),t(B);var bt=r(B,2),wt=e(bt),Yt=e(wt,!0);t(wt),A(2),t(bt),t($);var Q=r($,2),V=e(Q),te=e(V);Re(te,{size:24}),t(V);var ht=r(V,2),ft=e(ht),ee=e(ft,!0);t(ft),A(2),t(ht),t(Q);var q=r(Q,2),G=e(q),se=e(G);Te(se,{size:24}),t(G);var yt=r(G,2),xt=e(yt),ae=e(xt,!0);t(xt),A(2),t(yt),t(q);var At=r(q,2),I=e(At),re=e(I);Ue(re,{size:24}),t(I);var Ct=r(I,2),Ft=e(Ct),le=e(Ft,!0);t(Ft),A(2),t(Ct),t(At),t(M);var K=r(M,2),W=e(K),zt=e(W);Oe(zt,{size:18});var St=r(zt,2);Je(St),t(W);var Z=r(W,2);Nt(Z,21,()=>Qt,Pt,(a,l)=>{var i=Ge(),o=e(i,!0);t(i);var u={};N(()=>{n(o,s(l).label),u!==(u=s(l).value)&&(i.value=(i.__value=s(l).value)??"")}),d(a,i)}),t(Z),t(K);var ie=r(K,2);{var ve=a=>{var l=Ie();d(a,l)},oe=a=>{var l=Ht(),i=Jt(l);{var o=h=>{var f=Ke(),k=e(f),X=e(k,!0);t(k);var Y=r(k,2);Y.__click=()=>S(),t(f),N(()=>n(X,s(g))),d(h,f)},u=h=>{var f=Ht(),k=Jt(f);{var X=y=>{var _=We(),E=e(_);ut(E,{size:48});var R=r(E,6),tt=e(R);jt(tt,{size:18}),A(),t(R),t(_),d(y,_)},Y=y=>{var _=Xe(),E=e(_),R=r(e(E));Nt(R,21,()=>s(_t),Pt,(tt,v)=>{var et=Ze(),st=e(et),Lt=e(st),at=e(Lt),ne=e(at);ut(ne,{size:20}),t(at);var kt=r(at,2),rt=e(kt),ce=e(rt,!0);t(rt);var Et=r(rt,2),de=e(Et);t(Et),t(kt),t(Lt),t(st);var lt=r(st),it=e(lt),ue=e(it,!0);t(it),t(lt);var vt=r(lt),Rt=e(vt),ge=e(Rt,!0);t(Rt),t(vt);var ot=r(vt),_e=e(ot,!0);t(ot);var nt=r(ot),pe=e(nt,!0);t(nt);var ct=r(nt),me=e(ct,!0);t(ct);var Tt=r(ct),Ut=e(Tt),T=e(Ut),be=e(T);Me(be,{size:16}),t(T);var U=r(T,2),we=e(U);$e(we,{size:16}),t(U);var O=r(U,2);O.__click=()=>qt(s(v).id);var he=e(O);Be(he,{size:16}),t(O);var j=r(O,2);j.__click=()=>It(s(v).id);var fe=e(j);Qe(fe,{size:16}),t(j);var dt=r(j,2);dt.__click=()=>Gt(s(v).id);var ye=e(dt);Ve(ye,{size:16}),t(dt),t(Ut),t(Tt),t(et),N((xe,Ae,Ce,Fe)=>{n(ce,s(v).title),n(de,`${(s(v).actions?.length||0)??""} actions`),qe(it,1,`status-badge ${xe??""}`,"svelte-14s6w0g"),n(ue,s(v).status),n(ge,Vt[s(v).trigger_type]||s(v).trigger_type),n(_e,Ae),n(pe,Ce),n(me,Fe),Mt(T,"href",`/admin/crm/automations/${s(v).id??""}`),Mt(U,"href",`/admin/crm/automations/${s(v).id??""}/edit`)},[()=>Kt(s(v).status),()=>w(s(v).subscribers_count),()=>w(s(v).completed_count),()=>s(v).subscribers_count>0?(s(v).completed_count/s(v).subscribers_count*100).toFixed(1)+"%":"0%"]),d(tt,et)}),t(R),t(E),t(_),d(y,_)};gt(k,y=>{s(_t).length===0?y(X):y(Y,!1)},!0)}d(h,f)};gt(i,h=>{s(g)?h(o):h(u,!1)},!0)}d(a,l)};gt(ie,a=>{s(C)?a(ve):a(oe,!1)})}t(H),N((a,l,i,o)=>{L.disabled=s(C),n(Yt,a),n(ee,l),n(ae,i),n(le,o)},[()=>w(s(z).total),()=>w(s(z).active),()=>w(s(z).totalSubscribers),()=>w(s(z).completed)]),je(St,()=>s(F),a=>c(F,a)),Ne(Z,()=>s(b),a=>c(b,a)),d($t,H),De()}ze(["click"]);export{ss as component};
