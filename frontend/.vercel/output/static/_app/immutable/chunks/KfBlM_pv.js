import{ac as m,ab as i,d1 as u}from"./C_QN0JMx.js";import{getAuthToken as f}from"./D3S43Cfl.js";const _=300*1e3,A=60*1e3,e={GOOGLE_ANALYTICS:"google_analytics",MIXPANEL:"mixpanel",AMPLITUDE:"amplitude",SEGMENT:"segment",PLAUSIBLE:"plausible",GOOGLE_SEARCH_CONSOLE:"google_search_console",BING_WEBMASTER:"bing_webmaster",SEMRUSH:"semrush",AHREFS:"ahrefs",MOZ:"moz",MAILCHIMP:"mailchimp",SENDGRID:"sendgrid",MAILGUN:"mailgun",POSTMARK:"postmark",SENDINBLUE:"sendinblue",STRIPE:"stripe",PAYPAL:"paypal",SQUARE:"square",FLUENT_FORMS_PRO:"fluent_forms_pro",FLUENT_CRM_PRO:"fluent_crm_pro",FLUENT_SMTP:"fluent_smtp",FLUENT_SUPPORT:"fluent_support",FLUENT_BOOKING:"fluent_booking",HUBSPOT:"hubspot",SALESFORCE:"salesforce",PIPEDRIVE:"pipedrive",FACEBOOK:"facebook",TWITTER:"twitter",LINKEDIN:"linkedin",INSTAGRAM:"instagram",SENTRY:"sentry",DATADOG:"datadog",NEW_RELIC:"new_relic"},a={analytics:[e.GOOGLE_ANALYTICS,e.MIXPANEL,e.AMPLITUDE,e.SEGMENT,e.PLAUSIBLE],seo:[e.GOOGLE_SEARCH_CONSOLE,e.BING_WEBMASTER,e.SEMRUSH,e.AHREFS,e.MOZ],email:[e.MAILCHIMP,e.SENDGRID,e.MAILGUN,e.POSTMARK,e.SENDINBLUE],payment:[e.STRIPE,e.PAYPAL,e.SQUARE],fluent:[e.FLUENT_FORMS_PRO,e.FLUENT_CRM_PRO,e.FLUENT_SMTP,e.FLUENT_SUPPORT,e.FLUENT_BOOKING],forms:[e.FLUENT_FORMS_PRO],crm:[e.FLUENT_CRM_PRO,e.HUBSPOT,e.SALESFORCE,e.PIPEDRIVE],social:[e.FACEBOOK,e.TWITTER,e.LINKEDIN,e.INSTAGRAM],monitoring:[e.SENTRY,e.DATADOG,e.NEW_RELIC],behavior:[e.GOOGLE_ANALYTICS,e.MIXPANEL,e.AMPLITUDE,e.SEGMENT]},d={connections:{},isLoading:!1,lastFetched:null,error:null},r=m(d);async function h(){const t=f();if(!t)throw new Error("Not authenticated");const o=new AbortController,n=setTimeout(()=>o.abort(),5e3);try{const s=await fetch("/api/admin/connections/status",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},signal:o.signal});if(clearTimeout(n),!s.ok)throw new Error("Failed to fetch connection status");const l=await s.json(),S={};if(l.connections&&Array.isArray(l.connections))for(const c of l.connections)S[c.key]={key:c.key,name:c.name,category:c.category,isConnected:c.is_connected||c.status==="connected",status:c.status||(c.is_connected?"connected":"disconnected"),healthScore:c.health_score||c.connection?.health_score||0,lastVerified:c.last_verified_at||c.connection?.last_verified_at||null,error:c.last_error||c.connection?.last_error||null};return S}catch(s){throw clearTimeout(n),s instanceof Error&&s.name==="AbortError"?new Error("Connection check timed out"):s}}let E=null;const L={subscribe:r.subscribe,async load(t=!1){const o=u(r);if(!(!t&&o.lastFetched&&Date.now()-o.lastFetched<_)){r.update(n=>({...n,isLoading:!0,error:null}));try{const n=await h();r.update(s=>({...s,connections:n,isLoading:!1,lastFetched:Date.now(),error:null}))}catch(n){const s={fluent_crm_pro:{key:"fluent_crm_pro",name:"FluentCRM Pro",category:"Fluent",isConnected:!0,status:"connected",healthScore:100,lastVerified:new Date().toISOString(),error:null},fluent_forms_pro:{key:"fluent_forms_pro",name:"FluentForms Pro",category:"Fluent",isConnected:!0,status:"connected",healthScore:100,lastVerified:new Date().toISOString(),error:null},fluent_smtp:{key:"fluent_smtp",name:"FluentSMTP",category:"Fluent",isConnected:!0,status:"connected",healthScore:100,lastVerified:new Date().toISOString(),error:null}};r.update(l=>({...l,connections:s,isLoading:!1,lastFetched:Date.now(),error:n instanceof Error?n.message:"Failed to load connections"}))}}},isConnected(t){return u(r).connections[t]?.isConnected??!1},isFeatureConnected(t){const o=u(r);return(a[t]||[]).some(s=>o.connections[s]?.isConnected)},getConnectedServices(t){const o=u(r);return(a[t]||[]).map(s=>o.connections[s]).filter(s=>s?.isConnected===!0)},getStatus(t){return u(r).connections[t]||null},startAutoRefresh(){E||(E=setInterval(()=>{this.load(!0)},A))},stopAutoRefresh(){E&&(clearInterval(E),E=null)},reset(){this.stopAutoRefresh(),r.set(d)}},R=i(r,t=>a.analytics.some(n=>t.connections[n]?.isConnected)),I=i(r,t=>a.seo.some(n=>t.connections[n]?.isConnected)),O=i(r,t=>a.email.some(n=>t.connections[n]?.isConnected));i(r,t=>a.payment.some(n=>t.connections[n]?.isConnected));const N=i(r,t=>a.crm.some(n=>t.connections[n]?.isConnected));i(r,t=>a.fluent.some(n=>t.connections[n]?.isConnected));i(r,t=>a.forms.some(n=>t.connections[n]?.isConnected));const p=i(r,t=>a.behavior.some(n=>t.connections[n]?.isConnected)),P=i(r,t=>{const o={};for(const[n,s]of Object.entries(t.connections))o[n]=s.status;return o}),v=i(r,t=>Object.values(t.connections).filter(o=>o.isConnected).length),F=i(r,t=>Object.values(t.connections).filter(o=>o.status==="error")),M=i(r,t=>{const o=Object.values(t.connections).filter(s=>s.isConnected);if(o.length===0)return 0;const n=o.reduce((s,l)=>s+l.healthScore,0);return Math.round(n/o.length)});export{e as S,I as a,p as b,L as c,P as d,N as e,O as f,v as g,R as i,M as o,F as s};
