import{authStore as p}from"./D3S43Cfl.js";const m="http://localhost:8000/api";class h{getAuthHeaders(){const e=p.getToken(),t={Accept:"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}async request(e,t,r,a,s=!1){let i=`${m}${t}`;if(a){const u=new URLSearchParams;Object.entries(a).forEach(([o,l])=>{l!=null&&u.append(o,String(l))});const c=u.toString();c&&(i+=`?${c}`)}const n=this.getAuthHeaders();s||(n["Content-Type"]="application/json");const d=await fetch(i,{method:e,headers:n,body:s?r:r?JSON.stringify(r):void 0});if(!d.ok){const u=await d.json().catch(()=>({message:"Request failed"}));throw new Error(u.message||`HTTP ${d.status}`)}return d.json()}async getFiles(e){return this.request("GET","/admin/media/files",void 0,e)}async getFile(e){return this.request("GET",`/admin/media/files/${e}`)}async updateFile(e,t){return this.request("PUT",`/admin/media/files/${e}`,t)}async deleteFile(e,t=!1){return this.request("DELETE",`/admin/media/files/${e}`,void 0,{force:t})}async bulkDelete(e,t=!1){return this.request("POST","/admin/media/bulk/delete",{ids:e,force:t})}async bulkMove(e,t){return this.request("POST","/admin/media/bulk/move",{ids:e,folder_id:t})}async bulkTag(e,t){return this.request("POST","/admin/media/bulk/tag",{ids:e,tags:t})}async uploadFile(e,t,r){const a=new FormData;return a.append("file",e),t?.folder_id&&a.append("folder_id",t.folder_id),t?.title&&a.append("title",t.title),t?.alt_text&&a.append("alt_text",t.alt_text),t?.tags&&a.append("tags",JSON.stringify(t.tags)),t?.optimize!==void 0&&a.append("optimize",String(t.optimize)),t?.generate_webp!==void 0&&a.append("generate_webp",String(t.generate_webp)),r?this.uploadWithProgress(a,r):this.request("POST","/admin/media/upload",a,void 0,!0)}uploadWithProgress(e,t){return new Promise((r,a)=>{const s=new XMLHttpRequest,i=p.getToken();s.upload.addEventListener("progress",n=>{if(n.lengthComputable){const d=n.loaded/n.total*100;t(d)}}),s.addEventListener("load",()=>{s.status>=200&&s.status<300?r(JSON.parse(s.responseText)):a(new Error(`Upload failed: ${s.status}`))}),s.addEventListener("error",()=>{a(new Error("Upload failed"))}),s.open("POST",`${m}/admin/media/upload`),i&&s.setRequestHeader("Authorization",`Bearer ${i}`),s.send(e)})}async uploadChunk(e,t,r,a,s){const i=new FormData;return i.append("chunk",s),i.append("chunk_index",String(t)),i.append("total_chunks",String(r)),i.append("upload_id",a),i.append("filename",e.name),i.append("file_size",String(e.size)),this.request("POST","/admin/media/upload/chunk",i,void 0,!0)}async getFolders(){return this.request("GET","/admin/media/folders")}async getFolder(e){return this.request("GET",`/admin/media/folders/${e}`)}async createFolder(e){return this.request("POST","/admin/media/folders",e)}async updateFolder(e,t){return this.request("PUT",`/admin/media/folders/${e}`,t)}async deleteFolder(e,t=!1){return this.request("DELETE",`/admin/media/folders/${e}`,void 0,{delete_files:t})}async generateAIMetadata(e){return this.request("POST",`/admin/media/files/${e}/ai-metadata`)}async applyAIMetadata(e,t){return this.request("POST",`/admin/media/files/${e}/apply-ai-metadata`,{fields:t})}async bulkGenerateAI(e){return this.request("POST","/admin/media/bulk/generate-ai",{ids:e})}async optimizeFile(e){return this.request("POST",`/admin/media/files/${e}/optimize`)}async generateWebP(e){return this.request("POST",`/admin/media/files/${e}/webp`)}async generateThumbnails(e,t){return this.request("POST",`/admin/media/files/${e}/thumbnails`,{sizes:t})}async bulkOptimize(e,t={}){return this.request("POST","/admin/media/bulk/optimize",{ids:e,...t})}async getVersions(e){return this.request("GET",`/admin/media/files/${e}/versions`)}async createVersion(e,t,r){const a=new FormData;return a.append("file",t),a.append("changes",r),this.request("POST",`/admin/media/files/${e}/versions`,a,void 0,!0)}async restoreVersion(e,t){return this.request("POST",`/admin/media/files/${e}/versions/${t}/restore`)}async getUsage(e){return this.request("GET",`/admin/media/files/${e}/usage`)}async trackUsage(e){return this.request("POST","/admin/media/usage",e)}async removeUsage(e){return this.request("DELETE",`/admin/media/usage/${e}`)}async getUnusedFiles(e=90){return this.request("GET","/admin/media/unused",void 0,{days:e})}async getStats(){return this.request("GET","/admin/media/stats")}async getMostUsed(e=10){return this.request("GET","/admin/media/most-used",void 0,{limit:e})}async search(e,t){return this.request("GET","/admin/media/search",void 0,{query:e,...t})}async findSimilar(e,t=10){return this.request("GET",`/admin/media/files/${e}/similar`,void 0,{limit:t})}async findDuplicates(){return this.request("GET","/admin/media/duplicates")}async optimizeImage(e,t={}){return this.request("POST",`/admin/media/files/${e}/optimize`,t)}async optimizeAll(e={}){return this.request("POST","/admin/media/optimize-all",e)}async regenerateVariants(e,t){return this.request("POST",`/admin/media/files/${e}/regenerate`,{preset:t})}async getOptimizationJob(e){return this.request("GET",`/admin/media/jobs/${e}`)}async getQueueStatus(){return this.request("GET","/admin/media/queue/status")}async getOptimizationStatistics(){return this.request("GET","/admin/media/statistics")}async getOptimizationPresets(){return this.request("GET","/admin/media/presets")}async getVariants(e){return this.request("GET",`/admin/media/files/${e}/variants`)}async upload(e,t={}){const r=await this.uploadFile(e,t);return{success:r.success,data:r.file}}async list(e={}){const t=await this.getFiles({page:e.page,per_page:e.per_page,search:e.search,file_type:e.type,sort:e.sort_by,order:e.sort_dir});return{data:t.files,meta:{current_page:t.pagination.page,last_page:t.pagination.total_pages,total:t.pagination.total}}}async delete(e){return this.deleteFile(e)}async optimize(e,t={}){const r=await this.optimizeImage(e,t);return{success:r.success,data:r.data}}async update(e,t){const r=await this.updateFile(e,t);return{success:r.success,data:r.file}}async getStatistics(){return this.getOptimizationStatistics()}async getPresets(){return this.getOptimizationPresets()}async checkSharpHealth(){return this.request("GET","/sharp/health")}async sharpUpload(e,t={},r){const a=new FormData;return a.append("image",e),t.collection&&a.append("collection",t.collection),t.preset&&a.append("preset",t.preset),t.alt_text&&a.append("alt_text",t.alt_text),t.title&&a.append("title",t.title),t.generate_webp!==void 0&&a.append("generate_webp",String(t.generate_webp)),t.generate_avif!==void 0&&a.append("generate_avif",String(t.generate_avif)),t.generate_responsive!==void 0&&a.append("generate_responsive",String(t.generate_responsive)),t.generate_thumbnail!==void 0&&a.append("generate_thumbnail",String(t.generate_thumbnail)),t.generate_blurhash!==void 0&&a.append("generate_blurhash",String(t.generate_blurhash)),t.generate_retina!==void 0&&a.append("generate_retina",String(t.generate_retina)),r?this.sharpUploadWithProgress(a,r):this.request("POST","/admin/sharp/upload",a,void 0,!0)}sharpUploadWithProgress(e,t){return new Promise((r,a)=>{const s=new XMLHttpRequest,i=p.getToken();s.upload.addEventListener("progress",n=>{if(n.lengthComputable){const d=n.loaded/n.total*100;t(d)}}),s.addEventListener("load",()=>{s.status>=200&&s.status<300?r(JSON.parse(s.responseText)):a(new Error(`Upload failed: ${s.status}`))}),s.addEventListener("error",()=>{a(new Error("Upload failed"))}),s.open("POST",`${m}/admin/sharp/upload`),i&&s.setRequestHeader("Authorization",`Bearer ${i}`),s.send(e)})}async sharpBulkUpload(e,t={}){const r=new FormData;return e.forEach(a=>r.append("images[]",a)),t.collection&&r.append("collection",t.collection),t.preset&&r.append("preset",t.preset),this.request("POST","/admin/sharp/bulk-upload",r,void 0,!0)}async sharpProcessUrl(e,t={}){return this.request("POST","/admin/sharp/process-url",{url:e,...t})}async sharpOptimize(e,t="balanced"){return this.request("POST",`/admin/sharp/optimize/${e}`,{preset:t})}async sharpGetMedia(e){return this.request("GET",`/admin/sharp/media/${e}`)}async getSharpStatistics(){return this.request("GET","/admin/sharp/statistics")}}const y=new h;export{y as m};
