import{ab as c,ac as m,d1 as o}from"./C_QN0JMx.js";import{m as l}from"./B9ryIA8i.js";const g={members:[],stats:null,services:[],pagination:null,filters:{per_page:25,page:1,sort_by:"created_at",sort_dir:"desc"},loading:!1,error:null,selectedMember:null,selectedMemberEngagement:0,selectedMemberTimeline:[]},u={members:[],stats:null,pagination:null,filters:{per_page:25,page:1},loading:!1,error:null},b={service:null,stats:null,members:[],pagination:null,loading:!1,error:null},p={templates:[],presetTemplates:[],loading:!1,sending:!1,error:null};function f(){const{subscribe:a,set:i,update:t}=m(g);return{subscribe:a,async loadMembers(s){t(e=>({...e,loading:!0,error:null,filters:s?{...e.filters,...s}:e.filters}));try{const e=o({subscribe:a}),r=await l.getMembers(e.filters);t(n=>({...n,members:r.members,pagination:r.pagination,loading:!1}))}catch(e){t(r=>({...r,error:e instanceof Error?e.message:"Failed to load members",loading:!1}))}},async loadStats(){try{const s=await l.getStats();t(e=>({...e,stats:s}))}catch{}},async loadServices(){try{const s=await l.getServices();t(e=>({...e,services:s.services}))}catch{}},async loadMember(s){t(e=>({...e,loading:!0,error:null}));try{const e=await l.getMember(s);t(r=>({...r,selectedMember:e.member,selectedMemberEngagement:e.engagement_score,selectedMemberTimeline:e.timeline,loading:!1}))}catch(e){t(r=>({...r,error:e instanceof Error?e.message:"Failed to load member",loading:!1}))}},async setFilters(s){const r={...o({subscribe:a}).filters,...s,page:1};await this.loadMembers(r)},async goToPage(s){await this.loadMembers({page:s})},clearSelectedMember(){t(s=>({...s,selectedMember:null,selectedMemberEngagement:0,selectedMemberTimeline:[]}))},reset(){i(g)}}}function M(){const{subscribe:a,set:i,update:t}=m(u);return{subscribe:a,async loadChurnedMembers(s){t(e=>({...e,loading:!0,error:null,filters:s?{...e.filters,...s}:e.filters}));try{const e=o({subscribe:a}),r=await l.getChurnedMembers(e.filters);t(n=>({...n,members:r.members,stats:r.stats,pagination:r.pagination,loading:!1}))}catch(e){t(r=>({...r,error:e instanceof Error?e.message:"Failed to load churned members",loading:!1}))}},async setFilters(s){const r={...o({subscribe:a}).filters,...s,page:1};await this.loadChurnedMembers(r)},async goToPage(s){await this.loadChurnedMembers({page:s})},reset(){i(u)}}}function S(){const{subscribe:a,set:i,update:t}=m(b);return{subscribe:a,async loadServiceMembers(s,e){t(r=>({...r,loading:!0,error:null}));try{const r=await l.getMembersByService(s,e);t(n=>({...n,service:r.service,stats:r.stats,members:r.members,pagination:r.pagination,loading:!1}))}catch(r){t(n=>({...n,error:r instanceof Error?r.message:"Failed to load service members",loading:!1}))}},reset(){i(b)}}}function h(){const{subscribe:a,set:i,update:t}=m(p);return{subscribe:a,async loadTemplates(){t(s=>({...s,loading:!0,error:null}));try{const s=await l.getEmailTemplates();t(e=>({...e,templates:s.templates,presetTemplates:s.preset_templates,loading:!1}))}catch(s){t(e=>({...e,error:s instanceof Error?s.message:"Failed to load templates",loading:!1}))}},async sendEmail(s,e){t(r=>({...r,sending:!0,error:null}));try{const r=await l.sendEmail(s,e);return t(n=>({...n,sending:!1})),r}catch(r){throw t(n=>({...n,error:r instanceof Error?r.message:"Failed to send email",sending:!1})),r}},async sendBulkEmail(s){t(e=>({...e,sending:!0,error:null}));try{const e=await l.sendBulkEmail(s);return t(r=>({...r,sending:!1})),e}catch(e){throw t(r=>({...r,error:e instanceof Error?e.message:"Failed to send emails",sending:!1})),e}},reset(){i(p)}}}const d=f(),w=M(),E=S(),F=h();c(d,a=>a.stats?a.stats.subscriptions.active:0);c(d,a=>a.stats?a.stats.overview.total_members:0);c(d,a=>a.stats?a.stats.revenue.mrr:0);c(d,a=>a.stats?a.stats.subscriptions.churn_rate:0);export{w as c,F as e,d as m,E as s};
