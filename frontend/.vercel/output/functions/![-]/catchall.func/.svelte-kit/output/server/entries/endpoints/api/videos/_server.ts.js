import{json as o,error as n}from"@sveltejs/kit";const l="http://localhost:8000/api";function u(a){const t=a.headers.get("Authorization"),e={"Content-Type":"application/json",Accept:"application/json"};return t&&(e.Authorization=t),e}const v=async({url:a,request:t})=>{try{const e=new URLSearchParams,s=a.searchParams.get("page"),r=a.searchParams.get("limit")||a.searchParams.get("per_page"),d=a.searchParams.get("membership_id"),p=a.searchParams.get("category"),h=a.searchParams.get("search"),m=a.searchParams.get("platform"),g=a.searchParams.get("published");s&&e.set("page",s),r&&e.set("per_page",r),d&&e.set("membership_id",d),p&&e.set("category",p),h&&e.set("search",h),m&&e.set("platform",m),g&&e.set("is_published",g);const f=`${l}/videos${e.toString()?"?"+e.toString():""}`,c=await fetch(f,{method:"GET",headers:u(t)});if(!c.ok){const _=await c.json().catch(()=>({message:"Failed to fetch videos"}));return o({success:!1,error:_.message||"Failed to fetch videos",data:{videos:[],pagination:{page:1,limit:12,total:0,total_pages:0}}},{status:c.status})}const i=await c.json();return o({success:!0,data:{videos:i.data||[],pagination:{page:i.current_page||1,limit:i.per_page||12,total:i.total||0,total_pages:i.last_page||0}}})}catch{return o({success:!1,error:"Failed to connect to backend",data:{videos:[],pagination:{page:1,limit:12,total:0,total_pages:0}}},{status:503})}},w=async({request:a})=>{try{const t=await a.json();if(!t.title)throw n(400,"Title is required");if(!t.url)throw n(400,"Video URL is required");const e=await fetch(`${l}/admin/videos`,{method:"POST",headers:u(a),body:JSON.stringify({title:t.title,description:t.description||"",url:t.video_url||t.url,platform:t.platform||"html5",thumbnail_url:t.thumbnail_url||"",duration:t.duration||0,video_id:t.video_id||"",metadata:{categories:t.categories||[],tags:t.tags||[],instructor:t.instructor,membership_id:t.membership_id,is_premium:t.is_premium??!0}})});if(!e.ok){const r=await e.json().catch(()=>({message:"Failed to create video"}));return o({success:!1,error:r.message||"Failed to create video",errors:r.errors},{status:e.status})}const s=await e.json();return o({success:!0,data:s.video||s},{status:201})}catch(t){throw t instanceof Error&&"status"in t?t:n(500,"Failed to create video")}};export{v as GET,w as POST};
