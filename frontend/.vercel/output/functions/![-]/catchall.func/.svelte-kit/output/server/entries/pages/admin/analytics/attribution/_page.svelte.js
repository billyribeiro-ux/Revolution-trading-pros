import{e,d as b,a as C,b as L,f as y,k as R}from"../../../../../chunks/vendor-svelte.js";import{P as j,a as M}from"../../../../../chunks/PeriodSelector.js";function k(w,F){w.component(t=>{let{channels:i=[],title:v="Channel Attribution",model:u="linear"}=F;const x={organic:"bg-green-500",paid:"bg-blue-500",social:"bg-purple-500",email:"bg-orange-500",direct:"bg-gray-500",referral:"bg-cyan-500",affiliate:"bg-pink-500"};let h=i.reduce((a,o)=>a+o.attributed_conversions,0),p=i.reduce((a,o)=>a+o.attributed_revenue,0);function f(a){return a>=1e6?"$"+(a/1e6).toFixed(1)+"M":a>=1e3?"$"+(a/1e3).toFixed(1)+"K":"$"+a.toFixed(0)}const A={first_touch:"First Touch",last_touch:"Last Touch",linear:"Linear",time_decay:"Time Decay",position_based:"Position Based"};t.push(`<div class="bg-white rounded-xl border border-gray-200 p-6"><div class="flex items-center justify-between mb-6"><div><h3 class="text-lg font-semibold text-gray-900">${e(v)}</h3> <p class="text-sm text-gray-500">Attribution Model: ${e(A[u]||u)}</p></div> <div class="text-right"><div class="text-2xl font-bold text-gray-900">${e(f(p))}</div> <div class="text-sm text-gray-500">${e(h.toFixed(0))} conversions</div></div></div> <div class="space-y-4"><!--[-->`);const c=b(i);for(let a=0,o=c.length;a<o;a++){let d=c[a];const g=p>0?d.attributed_revenue/p*100:0;t.push(`<div class="space-y-2"><div class="flex items-center justify-between text-sm"><div class="flex items-center gap-2"><div${C(`w-3 h-3 rounded-full ${y(x[d.channel]||"bg-gray-400")}`)}></div> <span class="font-medium capitalize">${e(d.channel)}</span></div> <div class="flex items-center gap-4 text-gray-600"><span>${e(d.attributed_conversions.toFixed(1))} conv</span> <span class="font-semibold text-gray-900">${e(f(d.attributed_revenue))}</span></div></div> <div class="relative h-6 bg-gray-100 rounded-full overflow-hidden"><div${C(`${y(x[d.channel]||"bg-gray-400")} h-full rounded-full transition-all duration-500 ease-out`)}${L(`width: ${y(g)}%`)}>`),g>15?(t.push("<!--[-->"),t.push(`<span class="absolute inset-0 flex items-center justify-center text-xs text-white font-medium">${e(d.revenue_share.toFixed(1))}%</span>`)):t.push("<!--[!-->"),t.push("<!--]--></div> "),g<=15?(t.push("<!--[-->"),t.push(`<span class="absolute right-2 top-1/2 transform -translate-y-1/2 text-xs text-gray-500">${e(d.revenue_share.toFixed(1))}%</span>`)):t.push("<!--[!-->"),t.push("<!--]--></div></div>")}t.push(`<!--]--></div> <div class="mt-6 pt-4 border-t border-gray-100 grid grid-cols-3 gap-4 text-center"><div><div class="text-lg font-bold text-gray-900">${e(i.reduce((a,o)=>a+o.touchpoints,0).toLocaleString())}</div> <div class="text-xs text-gray-500">Total Touchpoints</div></div> <div><div class="text-lg font-bold text-gray-900">${e(i.reduce((a,o)=>a+o.assisted_conversions,0).toLocaleString())}</div> <div class="text-xs text-gray-500">Assisted Conversions</div></div> <div><div class="text-lg font-bold text-gray-900">${e(h>0?(p/h).toFixed(0):0)}</div> <div class="text-xs text-gray-500">Avg Conv Value</div></div></div></div>`)})}function E(w,F){w.component(t=>{let i=null,v=!0,u=null,x="30d",h="linear";const p=[{value:"first_touch",label:"First Touch",description:"Credits the first interaction"},{value:"last_touch",label:"Last Touch",description:"Credits the last interaction"},{value:"linear",label:"Linear",description:"Equal credit to all touchpoints"},{value:"time_decay",label:"Time Decay",description:"More credit to recent touchpoints"},{value:"position_based",label:"Position Based",description:"40% first, 40% last, 20% middle"}];async function f(){v=!0,u=null;try{i=await M.getChannelAttribution(h,x)}catch(s){u=s instanceof Error?s.message:"Failed to load attribution data"}finally{v=!1}}function A(s){x=s,f()}function c(s){return s>=1e6?"$"+(s/1e6).toFixed(1)+"M":s>=1e3?"$"+(s/1e3).toFixed(1)+"K":"$"+s.toFixed(0)}const a=i?.channels?.reduce((s,l)=>s+l.attributed_revenue,0)||0,o=i?.channels?.reduce((s,l)=>s+l.attributed_conversions,0)||0,d=i?.channels?.reduce((s,l)=>s+l.touchpoints,0)||0;R("1fmswtx",t,s=>{s.title(l=>{l.push("<title>Attribution Report | Analytics</title>")})}),t.push('<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="flex items-center justify-between mb-8"><div><h1 class="text-2xl font-bold text-gray-900">Attribution Analysis</h1> <p class="text-sm text-gray-500 mt-1">Multi-touch attribution across marketing channels</p></div> <div class="flex items-center gap-4">'),j(t,{value:x,onchange:A}),t.push('<!----> <button class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 text-sm">Export Report</button></div></div> <div class="bg-white rounded-xl border border-gray-200 p-6 mb-8"><h3 class="text-lg font-semibold text-gray-900 mb-4">Attribution Model</h3> <div class="grid grid-cols-1 md:grid-cols-5 gap-4"><!--[-->');const g=b(p);for(let s=0,l=g.length;s<l;s++){let n=g[s];t.push(`<button${C(`p-4 rounded-xl border-2 text-left transition-all ${y(h===n.value?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300")}`)}><div class="font-medium text-gray-900 mb-1">${e(n.label)}</div> <div class="text-xs text-gray-500">${e(n.description)}</div></button>`)}if(t.push("<!--]--></div></div> "),v)t.push("<!--[-->"),t.push('<div class="flex items-center justify-center py-20"><div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>');else{if(t.push("<!--[!-->"),u)t.push("<!--[-->"),t.push(`<div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center"><p class="text-red-600">${e(u)}</p> <button class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Retry</button></div>`);else{if(t.push("<!--[!-->"),i){if(t.push("<!--[-->"),t.push(`<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8"><div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">Attributed Revenue</div> <div class="text-3xl font-bold text-gray-900">${e(c(a))}</div></div> <div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">Total Conversions</div> <div class="text-3xl font-bold text-gray-900">${e(o.toLocaleString())}</div></div> <div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">Total Touchpoints</div> <div class="text-3xl font-bold text-gray-900">${e(d.toLocaleString())}</div></div> <div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">Avg Touchpoints/Conv</div> <div class="text-3xl font-bold text-gray-900">${e(o>0?(d/o).toFixed(1):"0")}</div></div></div> `),i.channels&&i.channels.length>0){t.push("<!--[-->"),t.push('<div class="mb-8">'),k(t,{channels:i.channels,model:h}),t.push('<!----></div> <div class="bg-white rounded-xl border border-gray-200 overflow-hidden mb-8"><div class="p-4 border-b border-gray-100"><h3 class="font-semibold text-gray-900">Channel Performance</h3></div> <div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-gray-50"><tr><th class="text-left py-3 px-4 font-medium text-gray-600">Channel</th><th class="text-right py-3 px-4 font-medium text-gray-600">Touchpoints</th><th class="text-right py-3 px-4 font-medium text-gray-600">Conversions</th><th class="text-right py-3 px-4 font-medium text-gray-600">Revenue</th><th class="text-right py-3 px-4 font-medium text-gray-600">Revenue Share</th><th class="text-right py-3 px-4 font-medium text-gray-600">Avg Order Value</th><th class="text-right py-3 px-4 font-medium text-gray-600">Assisted Conv.</th></tr></thead><tbody class="divide-y divide-gray-100"><!--[-->');const s=b(i.channels);for(let l=0,n=s.length;l<n;l++){let r=s[l];t.push(`<tr class="hover:bg-gray-50"><td class="py-3 px-4"><span class="font-medium text-gray-900 capitalize">${e(r.channel)}</span></td><td class="py-3 px-4 text-right text-gray-600">${e(r.touchpoints.toLocaleString())}</td><td class="py-3 px-4 text-right text-gray-600">${e(r.attributed_conversions.toFixed(1))}</td><td class="py-3 px-4 text-right font-medium text-gray-900">${e(c(r.attributed_revenue))}</td><td class="py-3 px-4 text-right"><div class="flex items-center justify-end gap-2"><div class="w-16 h-2 bg-gray-100 rounded-full overflow-hidden"><div class="h-full bg-blue-500 rounded-full"${L(`width: ${y(r.revenue_share)}%`)}></div></div> <span class="text-gray-600">${e(r.revenue_share.toFixed(1))}%</span></div></td><td class="py-3 px-4 text-right text-gray-600">${e(r.attributed_conversions>0?c(r.attributed_revenue/r.attributed_conversions):"-")}</td><td class="py-3 px-4 text-right text-gray-600">${e(r.assisted_conversions.toLocaleString())}</td></tr>`)}if(t.push(`<!--]--></tbody><tfoot class="bg-gray-50 font-medium"><tr><td class="py-3 px-4 text-gray-900">Total</td><td class="py-3 px-4 text-right text-gray-900">${e(d.toLocaleString())}</td><td class="py-3 px-4 text-right text-gray-900">${e(o.toFixed(1))}</td><td class="py-3 px-4 text-right text-gray-900">${e(c(a))}</td><td class="py-3 px-4 text-right text-gray-900">100%</td><td class="py-3 px-4 text-right text-gray-900">${e(o>0?c(a/o):"-")}</td><td class="py-3 px-4 text-right text-gray-900">${e(i.channels.reduce((l,n)=>l+n.assisted_conversions,0).toLocaleString())}</td></tr></tfoot></table></div></div> `),i.conversion_paths&&i.conversion_paths.length>0){t.push("<!--[-->"),t.push('<div class="bg-white rounded-xl border border-gray-200 p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4">Top Conversion Paths</h3> <div class="space-y-3"><!--[-->');const l=b(i.conversion_paths.slice(0,10));for(let n=0,r=l.length;n<r;n++){let m=l[n];t.push(`<div class="flex items-center gap-4 p-3 bg-gray-50 rounded-lg"><span class="text-sm text-gray-400 w-6">${e(n+1)}.</span> <div class="flex-1 flex items-center gap-2 flex-wrap"><!--[-->`);const T=b(m.channels);for(let _=0,S=T.length;_<S;_++){let P=T[_];t.push(`<span class="px-2 py-1 bg-white border border-gray-200 rounded text-sm capitalize">${e(P)}</span> `),_<m.channels.length-1?(t.push("<!--[-->"),t.push('<span class="text-gray-400">‚Üí</span>')):t.push("<!--[!-->"),t.push("<!--]-->")}t.push(`<!--]--></div> <div class="text-right"><div class="font-medium text-gray-900">${e(m.conversions)} conv</div> <div class="text-sm text-gray-500">${e(c(m.revenue))}</div></div></div>`)}t.push("<!--]--></div></div>")}else t.push("<!--[!-->");t.push("<!--]-->")}else t.push("<!--[!-->"),t.push('<div class="bg-white rounded-xl border border-gray-200 p-12 text-center"><div class="text-4xl mb-4">üìç</div> <h3 class="text-lg font-medium text-gray-900 mb-2">No Attribution Data</h3> <p class="text-gray-500">Attribution data will appear once conversions are tracked</p></div>');t.push("<!--]-->")}else t.push("<!--[!-->");t.push("<!--]-->")}t.push("<!--]-->")}t.push("<!--]--></div>")})}export{E as default};
