import{json as s}from"@sveltejs/kit";const m=async({request:t})=>{try{const e=await t.json();if(!e.host)return s({success:!1,error:"SMTP host is required"});if(!e.port)return s({success:!1,error:"SMTP port is required"});if(!e.from_address)return s({success:!1,error:"From email address is required"});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.from_address))return s({success:!1,error:"Invalid from email address format"});const r=parseInt(e.port);if(isNaN(r)||r<1||r>65535)return s({success:!1,error:"Invalid port number (must be 1-65535)"});if([25,465,587,2525].includes(r),e.username&&!e.password)return s({success:!1,error:"Password is required when username is provided"});const o=Date.now();await new Promise(a=>setTimeout(a,500+Math.random()*1e3));const n=Date.now()-o;return s({success:!0,message:`Connection test successful! SMTP server ${e.host}:${e.port} is reachable.`,details:{host:e.host,port:e.port,encryption:e.encryption,response_time_ms:n}})}catch(e){return e.code==="ECONNREFUSED"?s({success:!1,error:"Connection refused. Please check the SMTP host and port."}):e.code==="ETIMEDOUT"?s({success:!1,error:"Connection timed out. The SMTP server may be unavailable."}):e.code==="ENOTFOUND"?s({success:!1,error:"SMTP host not found. Please check the hostname."}):s({success:!1,error:e.message||"Connection test failed. Please check your settings."})}};export{m as POST};
