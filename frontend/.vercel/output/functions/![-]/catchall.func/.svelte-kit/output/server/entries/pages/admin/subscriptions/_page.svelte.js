import{z as w,A as y,an as S,a3 as U,k as z,e as p,d as R,c as J,a as B,f as Q}from"../../../../chunks/vendor-svelte.js";import"../../../../chunks/auth.js";const L={subscriptions:[],filters:{},loading:!1,error:null};function H(){const{subscribe:o,set:e,update:t}=y(L);return{subscribe:o,loadSubscriptions:async s=>{t(i=>({...i,loading:!0,error:null}));try{const{getSubscriptions:i}=await Promise.resolve().then(()=>b),r=await i(s);t(a=>({...a,subscriptions:r,filters:s||{},loading:!1}))}catch{t(r=>({...r,error:"Failed to load subscriptions",loading:!1}))}},updateStatus:async(s,i,r)=>{t(a=>({...a,loading:!0}));try{const{updateSubscription:a}=await Promise.resolve().then(()=>b),n=await a(s,{status:i,...r&&{cancellationReason:r,pauseReason:r}});t(u=>({...u,subscriptions:u.subscriptions.map(h=>h.id===s?{...h,...n}:h),loading:!1}))}catch{t(n=>({...n,error:"Failed to update subscription",loading:!1}))}},pauseSubscription:async(s,i)=>{t(r=>({...r,loading:!0}));try{const{pauseSubscription:r}=await Promise.resolve().then(()=>b),a=await r(s,i);t(n=>({...n,subscriptions:n.subscriptions.map(u=>u.id===s?{...u,...a}:u),loading:!1}))}catch{t(a=>({...a,error:"Failed to pause subscription",loading:!1}))}},resumeSubscription:async s=>{t(i=>({...i,loading:!0}));try{const{resumeSubscription:i}=await Promise.resolve().then(()=>b),r=await i(s);t(a=>({...a,subscriptions:a.subscriptions.map(n=>n.id===s?{...n,...r}:n),loading:!1}))}catch{t(r=>({...r,error:"Failed to resume subscription",loading:!1}))}},cancelSubscription:async(s,i,r=!1)=>{t(a=>({...a,loading:!0}));try{const{cancelSubscription:a}=await Promise.resolve().then(()=>b),n=await a(s,i,r);t(u=>({...u,subscriptions:u.subscriptions.map(h=>h.id===s?{...h,...n}:h),loading:!1}))}catch{t(n=>({...n,error:"Failed to cancel subscription",loading:!1}))}},reactivateSubscription:async s=>{t(i=>({...i,loading:!0}));try{const{reactivateSubscription:i}=await Promise.resolve().then(()=>b),r=await i(s);t(a=>({...a,subscriptions:a.subscriptions.map(n=>n.id===s?{...n,...r}:n),loading:!1}))}catch{t(r=>({...r,error:"Failed to reactivate subscription",loading:!1}))}},retryPayment:async(s,i)=>{t(r=>({...r,loading:!0}));try{const{retryPayment:r}=await Promise.resolve().then(()=>b);await r(s,i);const{getSubscriptions:a}=await Promise.resolve().then(()=>b),n=await a();t(u=>({...u,subscriptions:n,loading:!1}))}catch{t(a=>({...a,error:"Failed to retry payment",loading:!1}))}},updatePaymentMethod:async(s,i)=>{t(r=>({...r,loading:!0}));try{const{updatePaymentMethod:r}=await Promise.resolve().then(()=>b),a=await r(s,i);t(n=>({...n,subscriptions:n.subscriptions.map(u=>u.id===s?{...u,...a}:u),loading:!1}))}catch{t(a=>({...a,error:"Failed to update payment method",loading:!1}))}},processRenewal:async s=>{t(i=>({...i,loading:!0}));try{const{processPayment:i}=await Promise.resolve().then(()=>b);await i(s);const{getSubscriptions:r}=await Promise.resolve().then(()=>b),a=await r();t(n=>({...n,subscriptions:a,loading:!1}))}catch{t(r=>({...r,error:"Failed to process renewal",loading:!1}))}},recordPaymentFailure:async(s,i)=>{t(r=>({...r,loading:!0}));try{const{getSubscriptions:r}=await Promise.resolve().then(()=>b),a=await r();t(n=>({...n,subscriptions:a,loading:!1}))}catch{t(a=>({...a,error:"Failed to record payment failure",loading:!1}))}},setFilters:s=>{t(i=>({...i,filters:s}))},clearFilters:()=>{t(s=>({...s,filters:{}}))},reset:()=>{e(L)}}}const _=H();w(_,o=>{let e=o.subscriptions;if(o.filters.status&&o.filters.status.length>0&&(e=e.filter(t=>o.filters.status.includes(t.status))),o.filters.interval&&o.filters.interval.length>0&&(e=e.filter(t=>o.filters.interval.includes(t.interval))),o.filters.searchQuery){const t=o.filters.searchQuery.toLowerCase();e=e.filter(s=>s.productName.toLowerCase().includes(t)||s.userId.toLowerCase().includes(t)||s.id.toLowerCase().includes(t))}return o.filters.dateFrom&&(e=e.filter(t=>t.createdAt>=o.filters.dateFrom)),o.filters.dateTo&&(e=e.filter(t=>t.createdAt<=o.filters.dateTo)),e});w(_,o=>{const e=o.subscriptions,t=e.filter(a=>a.status==="active").length,s=new Date;s.setDate(1),s.setHours(0,0,0,0);const i=e.filter(a=>new Date(a.createdAt)>=s&&a.status==="active").length;return{total:e.length,active:t,totalActive:t,newThisMonth:i,onHold:e.filter(a=>a.status==="on-hold").length,cancelled:e.filter(a=>a.status==="cancelled").length,expired:e.filter(a=>a.status==="expired").length,pendingCancel:e.filter(a=>a.status==="pending-cancel").length,monthlyRecurringRevenue:V(e),churnRate:Y(e),averageLifetimeValue:G(e)}});function V(o){return o.filter(e=>e.status==="active"||e.status==="pending-cancel").reduce((e,t)=>{let s=t.price;return t.interval==="quarterly"?s=t.price/3:t.interval==="yearly"&&(s=t.price/12),e+s},0)}function Y(o){const e=o.filter(s=>s.status==="active").length,t=o.filter(s=>s.status==="cancelled").length;return e===0?0:t/(e+t)*100}function G(o){return o.length===0?0:o.reduce((t,s)=>t+s.totalPaid,0)/o.length}const m="",v="",K=3e5,W=3,X=1e3,Z=3e4;class x{static instance;cache=new Map;wsConnection;metricsInterval;pendingRequests=new Map;retryQueue=[];subscriptions=y([]);currentSubscription=y(null);stats=y(null);revenueMetrics=y(null);churnMetrics=y(null);isLoading=y(!1);error=y(null);activeSubscriptions=w(this.subscriptions,e=>e.filter(t=>t.status==="active"));atRiskSubscriptions=w(this.subscriptions,e=>e.filter(t=>t.health?.status==="at-risk"));upcomingRenewals=w(this.subscriptions,e=>e.filter(t=>{if(!t.billingCycle?.currentPeriodEnd)return!1;const s=(new Date(t.billingCycle.currentPeriodEnd).getTime()-Date.now())/864e5;return s<=7&&s>=0}));constructor(){this.initialize()}static getInstance(){return x.instance||(x.instance=new x),x.instance}initialize(){}getAuthToken(){return""}async authFetch(e,t={}){const{skipCache:s=!1,cacheTTL:i=K,retryable:r=!0,...a}=t,n=`${a.method||"GET"}:${e}`;if(!s&&(!a.method||a.method==="GET")){const h=this.getFromCache(n);if(h)return h}if(this.pendingRequests.has(n)&&!a.method)return this.pendingRequests.get(n);const u=this.executeRequest(e,a,r);(!a.method||a.method==="GET")&&this.pendingRequests.set(n,u);try{const h=await u;return(!a.method||a.method==="GET")&&this.setCache(n,h,i),h}finally{this.pendingRequests.delete(n)}}async executeRequest(e,t,s,i=1){const r=new AbortController,a=setTimeout(()=>r.abort(),Z);try{const n=await fetch(e,{...t,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${this.getAuthToken()}`,"X-Request-ID":this.generateRequestId(),"X-Idempotency-Key":this.generateIdempotencyKey(e,t),...t.headers},credentials:"include",signal:r.signal});if(clearTimeout(a),!n.ok){const u=await n.json().catch(()=>({message:"Request failed"}));if(n.status===402)throw new $(u.message);if(n.status===429){const h=parseInt(n.headers.get("Retry-After")||"60",10);throw new tt(u.message,h)}throw new Error(u.message||`HTTP ${n.status}`)}return n.json()}catch(n){if(clearTimeout(a),s&&i<W&&this.shouldRetry(n)){const u=X*Math.pow(2,i-1);return await new Promise(h=>setTimeout(h,u)),this.executeRequest(e,t,s,i+1)}throw this.isCriticalOperation(e,t)&&this.addToRetryQueue({url:e,options:t,error:n,timestamp:Date.now(),attempts:0}),n}}setupWebSocket(){}authenticate(){this.wsConnection?.send(JSON.stringify({type:"auth",token:this.getAuthToken()}))}subscribeToUpdates(){this.wsConnection?.send(JSON.stringify({type:"subscribe",channels:["subscriptions","payments","metrics"]}))}handleWebSocketMessage(e){try{const t=JSON.parse(e.data);switch(t.type){case"subscription_updated":this.handleSubscriptionUpdate(t.data);break;case"payment_processed":this.handlePaymentUpdate(t.data);break;case"metrics_update":this.handleMetricsUpdate(t.data);break;case"alert":this.handleAlert(t.data);break}}catch{}}handleSubscriptionUpdate(e){this.subscriptions.update(s=>{const i=s.findIndex(r=>r.id===e.id);return i>=0?s[i]=e:s.push(e),s}),S(this.currentSubscription)?.id===e.id&&this.currentSubscription.set(e),this.showNotification(`Subscription ${e.id} updated`)}handlePaymentUpdate(e){this.subscriptions.update(t=>{const s=t.find(i=>i.id===e.metadata?.subscriptionId);if(s){const i={id:e.id,amount:e.amount,status:e.status==="succeeded"?"paid":e.status==="failed"?"failed":"pending",paymentDate:e.createdAt,dueDate:e.createdAt,paymentMethod:typeof e.method=="string"?e.method:e.method.type,failureReason:e.attempts.find(r=>r.error)?.error,retryCount:e.attempts.length-1};s.paymentHistory=[...s.paymentHistory||[],i]}return t}),e.status==="failed"&&this.showNotification(`Payment failed for subscription ${e.metadata?.subscriptionId}`,"error")}handleMetricsUpdate(e){this.revenueMetrics.update(t=>({...t,...e}))}handleAlert(e){this.showNotification(e.message,e.severity)}startMetricsCollection(){}async loadMetrics(){try{const[e,t,s]=await Promise.all([this.getRevenueMetrics().catch(()=>null),this.getChurnMetrics().catch(()=>null),this.getStats().catch(()=>null)]);e&&this.revenueMetrics.set(e),t&&this.churnMetrics.set(t),s&&this.stats.set(s)}catch{}}addToRetryQueue(e){this.retryQueue.push({...e,timestamp:Date.now(),attempts:0})}async processRetryQueue(){}getFromCache(e){const t=this.cache.get(e);return t&&Date.now()<t.expiry?t.data:null}setCache(e,t,s){this.cache.set(e,{data:t,expiry:Date.now()+s})}clearCache(e){if(e)for(const t of this.cache.keys())t.includes(e)&&this.cache.delete(t);else this.cache.clear()}generateRequestId(){return`req_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}generateIdempotencyKey(e,t){const s=`${e}${JSON.stringify(t.body||{})}`;return btoa(s).replace(/[^a-zA-Z0-9]/g,"").substring(0,32)}shouldRetry(e){return!(e.status>=400&&e.status<500)}isCriticalOperation(e,t){return!!(e.includes("/payment")||e.includes("/charge")||t.method==="POST"&&e.includes("/subscriptions"))}showNotification(e,t="info"){}async getSubscriptions(e,t=!1){this.isLoading.set(!0),this.error.set(null);try{const s=this.buildFilterParams(e),i=t?`${m}/admin/subscriptions`:`${m}/my/subscriptions`,r=await this.authFetch(`${i}?${s}`),a=r.subscriptions||r.data||[];return this.subscriptions.set(a),a}catch(s){throw this.error.set(s.message),s}finally{this.isLoading.set(!1)}}async getSubscription(e){this.isLoading.set(!0),this.error.set(null);try{const t=await this.authFetch(`${m}/my/subscriptions/${e}`);return this.currentSubscription.set(t),t}catch(t){throw this.error.set(t.message),t}finally{this.isLoading.set(!1)}}async createSubscription(e){this.isLoading.set(!0),this.error.set(null);try{const t=await this.authFetch(`${m}/my/subscriptions`,{method:"POST",body:JSON.stringify(e),skipCache:!0});return this.subscriptions.update(s=>[...s,t]),this.clearCache("/subscriptions"),this.trackEvent("subscription_created",{subscription_id:t.id,plan:t.planId,mrr:t.mrr}),t}catch(t){throw this.error.set(t.message),t}finally{this.isLoading.set(!1)}}async updateSubscription(e,t){this.isLoading.set(!0),this.error.set(null);try{const s=await this.authFetch(`${m}/my/subscriptions/${e}`,{method:"PATCH",body:JSON.stringify(t),skipCache:!0});return this.handleSubscriptionUpdate(s),this.clearCache(`/subscriptions/${e}`),s}catch(s){throw this.error.set(s.message),s}finally{this.isLoading.set(!1)}}async pauseSubscription(e,t){return this.updateSubscriptionStatus(e,"on-hold",{reason:t})}async resumeSubscription(e){return this.updateSubscriptionStatus(e,"active")}async cancelSubscription(e,t,s=!1){return this.updateSubscriptionStatus(e,s?"cancelled":"pending-cancel",{reason:t,immediate:s})}async reactivateSubscription(e){return this.updateSubscriptionStatus(e,"active",{reactivated:!0})}async updateSubscriptionStatus(e,t,s){this.isLoading.set(!0),this.error.set(null);try{const i=await this.authFetch(`${m}/my/subscriptions/${e}/cancel`,{method:"PUT",body:JSON.stringify({status:t,...s}),skipCache:!0});return this.handleSubscriptionUpdate(i),this.trackEvent("subscription_status_changed",{subscription_id:e,old_status:S(this.currentSubscription)?.status,new_status:t,...s}),i}catch(i){throw this.error.set(i.message),i}finally{this.isLoading.set(!1)}}async processPayment(e,t){this.isLoading.set(!0),this.error.set(null);try{const s=await this.authFetch(`${m}/my/subscriptions/${e}/charge`,{method:"POST",body:JSON.stringify({amount:t}),skipCache:!0,retryable:!0});return this.handlePaymentUpdate(s),s}catch(s){throw this.error.set(s.message),this.trackEvent("payment_failed",{subscription_id:e,amount:t,error:s.message}),s}finally{this.isLoading.set(!1)}}async retryPayment(e,t){return this.authFetch(`${m}/my/subscriptions/${e}/retry-payment`,{method:"POST",skipCache:!0})}async updatePaymentMethod(e,t){return this.authFetch(`${m}/my/subscriptions/${e}/payment-method`,{method:"PUT",body:JSON.stringify({paymentMethod:t}),skipCache:!0})}async getPaymentHistory(e){return(await this.authFetch(`${m}/my/subscriptions/${e}/payments`)).payments}async getStats(){return this.authFetch(`${m}/my/subscriptions/metrics`)}async getRevenueMetrics(){return this.authFetch(`${v}/revenue/metrics`)}async getChurnMetrics(){return this.authFetch(`${v}/churn/metrics`)}async getCohortAnalysis(e){return this.authFetch(`${v}/cohorts/${e}`)}async getChurnPredictions(){return(await this.authFetch(`${v}/churn/predictions`)).predictions}async getUpsellRecommendations(e){return(await this.authFetch(`${v}/upsell/recommendations/${e}`)).recommendations}async configureDunning(e){await this.authFetch(`${m}/dunning/configure`,{method:"POST",body:JSON.stringify(e),skipCache:!0})}async getDunningCampaigns(){return(await this.authFetch(`${m}/dunning/campaigns`)).campaigns}async pauseDunning(e){await this.authFetch(`${m}/my/subscriptions/${e}/dunning/pause`,{method:"POST",skipCache:!0})}async generateInvoice(e){return this.authFetch(`${m}/my/subscriptions/${e}/invoices/generate`,{method:"POST",skipCache:!0})}async getInvoices(e){return(await this.authFetch(`${m}/my/subscriptions/${e}/invoices`)).invoices}async downloadInvoice(e){const t=await fetch(`${m}/invoices/${e}/download`,{headers:{Authorization:`Bearer ${this.getAuthToken()}`}});if(!t.ok)throw new Error("Failed to download invoice");return t.blob()}async exportSubscriptions(e="csv"){const t=await fetch(`${m}/subscriptions/export?format=${e}`,{headers:{Authorization:`Bearer ${this.getAuthToken()}`}});if(!t.ok)throw new Error("Export failed");return t.blob()}async generateReport(e,t){return this.authFetch(`${m}/reports/generate`,{method:"POST",body:JSON.stringify({type:e,params:t}),skipCache:!0})}async configureWebhook(e){await this.authFetch(`${m}/webhooks/configure`,{method:"POST",body:JSON.stringify(e),skipCache:!0})}async testWebhook(e,t){return(await this.authFetch(`${m}/webhooks/test`,{method:"POST",body:JSON.stringify({url:e,event:t}),skipCache:!0})).success}buildFilterParams(e){const t=new URLSearchParams;return e&&(e.status&&e.status.forEach(s=>t.append("status[]",s)),e.interval&&e.interval.forEach(s=>t.append("interval[]",s)),e.searchQuery&&t.append("search",e.searchQuery),e.dateFrom&&t.append("date_from",e.dateFrom),e.dateTo&&t.append("date_to",e.dateTo)),t.toString()}trackEvent(e,t){this.authFetch(`${v}/events/track`,{method:"POST",body:JSON.stringify({event:e,data:t,timestamp:Date.now()}),skipCache:!0}).catch(s=>{})}}class $ extends Error{constructor(e){super(e),this.name="PaymentRequiredError"}}class tt extends Error{constructor(e,t){super(e),this.retryAfter=t,this.name="RateLimitError"}}const d=x.getInstance();d.subscriptions;d.currentSubscription;d.activeSubscriptions;d.atRiskSubscriptions;d.upcomingRenewals;d.stats;d.revenueMetrics;d.churnMetrics;d.isLoading;d.error;const D=(o,e=!1)=>d.getSubscriptions(o,e),et=(o,e)=>d.updateSubscription(o,e),st=(o,e)=>d.pauseSubscription(o,e),at=o=>d.resumeSubscription(o),it=(o,e,t)=>d.cancelSubscription(o,e,t),rt=o=>d.reactivateSubscription(o),nt=(o,e)=>d.processPayment(o,e),ot=(o,e)=>d.retryPayment(o,e),ct=(o,e)=>d.updatePaymentMethod(o,e),O=()=>d.getStats(),E=()=>S(d.upcomingRenewals),N=()=>S(d.subscriptions).filter(e=>e.failedAttempts>0||e.dunningStatus?.stage==="cancelled"||e.status==="on-hold"),b=Object.freeze(Object.defineProperty({__proto__:null,cancelSubscription:it,getFailedPayments:N,getSubscriptionStats:O,getSubscriptions:D,getUpcomingRenewals:E,pauseSubscription:st,processPayment:nt,reactivateSubscription:rt,resumeSubscription:at,retryPayment:ot,updatePaymentMethod:ct,updateSubscription:et},Symbol.toStringTag,{value:"Module"}));function dt(o,e){o.component(t=>{let s=[],i=null,r=[],a=[],n=!0,u="",h="all",C="",k="all",I="date";U(()=>{});async function T(){n=!0,u="";try{const l=await Promise.allSettled([D({status:h==="all"?void 0:[h],interval:k==="all"?void 0:[k],searchQuery:C||void 0},!0),O(),E(),N()]),[c,g,f,A]=l;s=c.status==="fulfilled"?c.value:[],i=g.status==="fulfilled"?g.value:{total:0,active:0,totalActive:0,newThisMonth:0,onHold:0,cancelled:0,expired:0,pendingCancel:0,monthlyRecurringRevenue:0,churnRate:0,averageLifetimeValue:0},r=f.status==="fulfilled"?f.value:[],a=A.status==="fulfilled"?A.value:[],c.status==="rejected"&&(u="Failed to load subscriptions. Some data may be unavailable.")}catch{u="Failed to load subscription data"}finally{n=!1}}let F=s.filter(l=>!0).sort((l,c)=>new Date(c.startDate).getTime()-new Date(l.startDate).getTime());function j(l){switch(l){case"active":return"bg-emerald-500/10 text-emerald-400 border-emerald-500/20";case"pending":return"bg-yellow-500/10 text-yellow-400 border-yellow-500/20";case"on-hold":return"bg-orange-500/10 text-orange-400 border-orange-500/20";case"cancelled":return"bg-red-500/10 text-red-400 border-red-500/20";case"expired":return"bg-slate-500/10 text-slate-400 border-slate-500/20";case"pending-cancel":return"bg-pink-500/10 text-pink-400 border-pink-500/20";default:return"bg-slate-500/10 text-slate-400 border-slate-500/20"}}function P(l){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l)}function M(l){return new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function q(l){return l.charAt(0).toUpperCase()+l.slice(1)}if(z("1v4qcr5",t,l=>{l.title(c=>{c.push("<title>Subscription Management - Admin</title>")})}),t.push('<div class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 py-12 px-4"><div class="max-w-7xl mx-auto"><div class="mb-8"><h1 class="text-4xl font-bold text-white mb-2">Subscription Management</h1> <p class="text-slate-400">Monitor and manage all customer subscriptions</p></div> '),u?(t.push("<!--[-->"),t.push(`<div class="bg-red-500/10 border border-red-500/20 rounded-xl p-4 mb-6"><p class="text-red-400">${p(u)}</p></div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),i?(t.push("<!--[-->"),t.push(`<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"><div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Active Subscriptions</h3> <div class="w-10 h-10 bg-emerald-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div> <p class="text-3xl font-bold text-white">${p(i.totalActive)}</p> <p class="text-sm text-emerald-400 mt-2">${p(i.newThisMonth>0?"+":"")}${p(i.newThisMonth)} this month</p></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Monthly Revenue</h3> <div class="w-10 h-10 bg-blue-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div></div> <p class="text-3xl font-bold text-white">${p(P(i.monthlyRecurringRevenue))}</p> <p class="text-sm text-slate-400 mt-2">MRR</p></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Churn Rate</h3> <div class="w-10 h-10 bg-orange-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg></div></div> <p class="text-3xl font-bold text-white">${p(i.churnRate.toFixed(1))}%</p> <p class="text-sm text-slate-400 mt-2">Last 30 days</p></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6"><div class="flex items-center justify-between mb-2"><h3 class="text-slate-400 text-sm font-medium">Avg Lifetime Value</h3> <div class="w-10 h-10 bg-purple-500/10 rounded-lg flex items-center justify-center"><svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg></div></div> <p class="text-3xl font-bold text-white">${p(P(i.averageLifetimeValue))}</p> <p class="text-sm text-slate-400 mt-2">Per customer</p></div></div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),a.length>0){t.push("<!--[-->"),t.push(`<div class="bg-red-500/10 border border-red-500/20 rounded-xl p-6 mb-6"><h3 class="text-red-400 font-semibold mb-3 flex items-center gap-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> ${p(a.length)} Failed Payment${p(a.length>1?"s":"")}</h3> <div class="space-y-2"><!--[-->`);const l=R(a.slice(0,3));for(let c=0,g=l.length;c<g;c++){let f=l[c];t.push(`<div class="flex items-center justify-between text-sm"><span class="text-slate-300">${p(f.subscriptionId)}</span> <button class="text-emerald-400 hover:text-emerald-300 font-medium">Retry Payment</button></div>`)}t.push("<!--]--></div></div>")}else t.push("<!--[!-->");if(t.push("<!--]--> "),r.length>0){t.push("<!--[-->"),t.push(`<div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-6 mb-6"><h3 class="text-blue-400 font-semibold mb-3 flex items-center gap-2"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg> ${p(r.length)} Renewal${p(r.length>1?"s":"")} in Next 7 Days</h3> <div class="space-y-2"><!--[-->`);const l=R(r.slice(0,3));for(let c=0,g=l.length;c<g;c++){let f=l[c];t.push(`<div class="flex items-center justify-between text-sm"><span class="text-slate-300">${p(f.productName)}</span> <span class="text-blue-400">${p(M(f.nextPaymentDate))}</span></div>`)}t.push("<!--]--></div></div>")}else t.push("<!--[!-->");if(t.push(`<!--]--> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-6 mb-6"><div class="grid grid-cols-1 md:grid-cols-4 gap-4"><div><label for="search" class="block text-sm font-medium text-slate-400 mb-2">Search</label> <input type="text" id="search"${J("value",C)} placeholder="Search subscriptions..." class="w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500"/></div> <div><label for="status" class="block text-sm font-medium text-slate-400 mb-2">Status</label> `),t.select({id:"status",value:h,onchange:T,class:"w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"},l=>{l.option({value:"all"},c=>{c.push("All Statuses")}),l.option({value:"active"},c=>{c.push("Active")}),l.option({value:"pending"},c=>{c.push("Pending")}),l.option({value:"on-hold"},c=>{c.push("On Hold")}),l.option({value:"cancelled"},c=>{c.push("Cancelled")}),l.option({value:"expired"},c=>{c.push("Expired")}),l.option({value:"pending-cancel"},c=>{c.push("Pending Cancel")})}),t.push('</div> <div><label for="interval" class="block text-sm font-medium text-slate-400 mb-2">Interval</label> '),t.select({id:"interval",value:k,onchange:T,class:"w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"},l=>{l.option({value:"all"},c=>{c.push("All Intervals")}),l.option({value:"monthly"},c=>{c.push("Monthly")}),l.option({value:"quarterly"},c=>{c.push("Quarterly")}),l.option({value:"yearly"},c=>{c.push("Yearly")})}),t.push('</div> <div><label for="sort" class="block text-sm font-medium text-slate-400 mb-2">Sort By</label> '),t.select({id:"sort",value:I,class:"w-full px-4 py-2 bg-slate-900 border border-slate-600 rounded-lg text-white focus:outline-none focus:border-emerald-500"},l=>{l.option({value:"date"},c=>{c.push("Date")}),l.option({value:"price"},c=>{c.push("Price")}),l.option({value:"status"},c=>{c.push("Status")})}),t.push('</div></div></div> <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl overflow-hidden"><div class="overflow-x-auto svelte-1v4qcr5"><table class="w-full"><thead class="bg-slate-900/50"><tr><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Product</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Customer</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Status</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Interval</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Price</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Next Payment</th><th class="px-6 py-4 text-left text-xs font-medium text-slate-400 uppercase tracking-wider">Actions</th></tr></thead><tbody class="divide-y divide-slate-700">'),n)t.push("<!--[-->"),t.push('<tr><td colspan="7" class="px-6 py-12 text-center text-slate-400"><div class="flex items-center justify-center gap-3"><div class="w-5 h-5 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"></div> Loading subscriptions...</div></td></tr>');else{if(t.push("<!--[!-->"),F.length===0)t.push("<!--[-->"),t.push('<tr><td colspan="7" class="px-6 py-12 text-center text-slate-400">No subscriptions found</td></tr>');else{t.push("<!--[!-->"),t.push("<!--[-->");const l=R(F);for(let c=0,g=l.length;c<g;c++){let f=l[c];t.push(`<tr class="hover:bg-slate-700/30 transition-colors"><td class="px-6 py-4"><div class="text-white font-medium">${p(f.productName)}</div> <div class="text-sm text-slate-400">${p(f.id.slice(0,8))}...</div></td><td class="px-6 py-4"><div class="text-slate-300">${p(f.userId.slice(0,8))}...</div></td><td class="px-6 py-4"><span${B(`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${Q(j(f.status))}`,"svelte-1v4qcr5")}>${p(f.status)}</span></td><td class="px-6 py-4 text-slate-300">${p(q(f.interval))}</td><td class="px-6 py-4 text-white font-medium">${p(P(f.price))}</td><td class="px-6 py-4 text-slate-300">${p(M(f.nextPaymentDate))}</td><td class="px-6 py-4"><div class="flex items-center gap-2">`),f.status==="active"?(t.push("<!--[-->"),t.push('<button class="text-orange-400 hover:text-orange-300 text-sm font-medium" title="Pause">Pause</button> <button class="text-red-400 hover:text-red-300 text-sm font-medium" title="Cancel">Cancel</button>')):(t.push("<!--[!-->"),f.status==="on-hold"?(t.push("<!--[-->"),t.push('<button class="text-emerald-400 hover:text-emerald-300 text-sm font-medium" title="Resume">Resume</button> <button class="text-red-400 hover:text-red-300 text-sm font-medium" title="Cancel">Cancel</button>')):(t.push("<!--[!-->"),f.status==="cancelled"?(t.push("<!--[-->"),t.push('<button class="text-emerald-400 hover:text-emerald-300 text-sm font-medium" title="Reactivate">Reactivate</button>')):t.push("<!--[!-->"),t.push("<!--]-->")),t.push("<!--]-->")),t.push("<!--]--></div></td></tr>")}t.push("<!--]-->")}t.push("<!--]-->")}t.push("<!--]--></tbody></table></div></div></div></div> "),t.push("<!--[!-->"),t.push("<!--]--> "),t.push("<!--[!-->"),t.push("<!--]-->")})}export{dt as default};
