import{z as p,A as h,an as N}from"./vendor-svelte.js";import"clsx";import"@sveltejs/kit/internal";import"@sveltejs/kit/internal/server";const b=100;function C(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function O(){const t=()=>({notifications:[],isLoading:!1,hasNewNotifications:!1}),{subscribe:n,set:c,update:s}=h(t());function g(e){}function A(){}function o(e){const i={id:e.id||C(),type:e.type||"info",priority:e.priority||"normal",title:e.title,message:e.message,timestamp:e.timestamp||new Date,read:e.read??!1,dismissed:e.dismissed??!1,action:e.action,metadata:e.metadata};return s(r=>({...r,notifications:[i,...r.notifications].slice(0,b),hasNewNotifications:!0})),i.id}function d(e){s(i=>({...i,notifications:i.notifications.map(a=>a.id===e?{...a,read:!0}:a),hasNewNotifications:i.notifications.some(a=>a.id!==e&&!a.read)}))}function l(){s(e=>({...e,notifications:e.notifications.map(r=>({...r,read:!0})),hasNewNotifications:!1}))}function u(e){s(i=>({...i,notifications:i.notifications.map(a=>a.id===e?{...a,dismissed:!0,read:!0}:a)}))}function S(e){s(i=>({...i,notifications:i.notifications.filter(a=>a.id!==e),hasNewNotifications:i.notifications.some(a=>a.id!==e&&!a.read)}))}function m(){c({notifications:[],isLoading:!1,hasNewNotifications:!1})}return{subscribe:n,add:o,markAsRead:d,markAllAsRead:l,dismiss:u,remove:S,clear:m,initWebSocket:g,destroyWebSocket:A,info:(e,i,r)=>o({...r,type:"info",title:e,message:i}),success:(e,i,r)=>o({...r,type:"success",title:e,message:i}),warning:(e,i,r)=>o({...r,type:"warning",title:e,message:i}),error:(e,i,r)=>o({...r,type:"error",title:e,message:i}),system:(e,i,r)=>o({...r,type:"system",title:e,message:i})}}const y=O(),T=p(y,t=>t.notifications),I=p(y,t=>t.notifications.filter(n=>!n.read&&!n.dismissed)),x=p(I,t=>t.length);p(y,t=>t.hasNewNotifications);p(y,t=>t.notifications.filter(n=>n.priority==="urgent"&&!n.dismissed));const P={shortcuts:[],isHelpOpen:!1,activeContext:"global"},f=h(P),z={subscribe:f.subscribe,init(t={}){},destroy(){},register(t){f.update(n=>({...n,shortcuts:[...n.shortcuts.filter(c=>c.id!==t.id),{...t,enabled:!0}]}))},registerAction(t,n){f.update(c=>({...c,shortcuts:c.shortcuts.map(s=>s.id===t?{...s,action:n,enabled:!0}:s)}))},unregister(t){f.update(n=>({...n,shortcuts:n.shortcuts.filter(c=>c.id!==t)}))},setEnabled(t,n){f.update(c=>({...c,shortcuts:c.shortcuts.map(s=>s.id===t?{...s,enabled:n}:s)}))},setContext(t){f.update(n=>({...n,activeContext:t}))},toggleHelp(){f.update(t=>({...t,isHelpOpen:!t.isHelpOpen}))},openHelp(){f.update(t=>({...t,isHelpOpen:!0}))},closeHelp(){f.update(t=>({...t,isHelpOpen:!1}))},formatKeys(t){const n={Meta:navigator?.platform?.includes("Mac")?"⌘":"Ctrl",Control:"Ctrl",Shift:"⇧",Alt:navigator?.platform?.includes("Mac")?"⌥":"Alt",Escape:"Esc",ArrowUp:"↑",ArrowDown:"↓",ArrowLeft:"←",ArrowRight:"→"};return t.map(c=>n[c]||c.toUpperCase()).join(" + ")}};function k(){return[]}function v(){const t={isOnline:!0,lastOnline:null,serviceWorkerStatus:null,cacheSize:0,pendingActions:k(),syncInProgress:!1},{subscribe:n,set:c,update:s}=h(t);async function g(){const o=N({subscribe:n});if(!o.isOnline||o.syncInProgress||o.pendingActions.length===0)return;s(u=>({...u,syncInProgress:!0}));const d=[...o.pendingActions],l=[];for(const u of d)try{await A(u)}catch{u.retryCount<3&&l.push({...u,retryCount:u.retryCount+1})}s(u=>({...u,pendingActions:l,syncInProgress:!1}))}async function A(o){return new Promise((d,l)=>{setTimeout(()=>{Math.random()>.1?d():l(new Error("Sync failed"))},500)})}return{subscribe:n,queueAction(o,d,l){const u={id:crypto.randomUUID(),type:o,resource:d,data:l,timestamp:Date.now(),retryCount:0};s(m=>{const e=[...m.pendingActions,u];return{...m,pendingActions:e}}),N({subscribe:n}).isOnline&&g()},removeAction(o){s(d=>{const l=d.pendingActions.filter(u=>u.id!==o);return{...d,pendingActions:l}})},clearPendingActions(){s(o=>({...o,pendingActions:[]}))},sync:g,updateCacheSize(o){s(d=>({...d,cacheSize:o}))},async clearCache(){}}}const w=v(),R=p(w,t=>t.isOnline),U=p(w,t=>t.pendingActions.length>0),L=p(w,t=>t.pendingActions.length),W=p(w,t=>t.syncInProgress);export{W as a,U as h,R as i,z as k,T as n,L as p,x as u};
