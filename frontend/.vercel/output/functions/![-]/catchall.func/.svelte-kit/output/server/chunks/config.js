import{getAuthToken as w}from"./auth.js";const b={},y=b.VITE_API_URL||"http://localhost:8000",T={auth:{login:"/api/auth/login",register:"/api/auth/register",logout:"/api/auth/logout",refresh:"/api/auth/refresh",me:"/api/auth/me",forgotPassword:"/api/auth/forgot-password",resetPassword:"/api/auth/reset-password"},posts:{list:"/api/posts",single:e=>`/api/posts/${e}`,create:"/api/posts",update:e=>`/api/posts/${e}`,delete:e=>`/api/posts/${e}`,like:e=>`/api/posts/${e}/like`,unlike:e=>`/api/posts/${e}/unlike`},products:{list:"/api/products",single:e=>`/api/products/${e}`,categories:"/api/products/categories"},indicators:{list:"/api/indicators",single:e=>`/api/indicators/${e}`,download:(e,t)=>`/api/indicators/${e}/download/${t}`,purchased:"/api/indicators/purchased"},memberships:{plans:"/api/memberships/plans",current:"/api/memberships/current",subscribe:"/api/memberships/subscribe",cancel:"/api/memberships/cancel",update:"/api/memberships/update"},user:{profile:"/api/user/profile",update:"/api/user/profile",memberships:"/api/user/memberships",products:"/api/user/products",notifications:"/api/user/notifications",preferences:"/api/user/preferences"},newsletter:{subscribe:"/api/newsletter/subscribe",unsubscribe:"/api/newsletter/unsubscribe"},cart:{checkout:"/api/cart/checkout",add:"/api/cart/add",remove:"/api/cart/remove",clear:"/api/cart/clear"},tradingRoom:{sessions:"/api/trading-room/sessions",join:e=>`/api/trading-room/sessions/${e}/join`,leave:e=>`/api/trading-room/sessions/${e}/leave`,signals:"/api/trading-room/signals"},analytics:{dashboard:"/api/analytics/dashboard",performance:"/api/analytics/performance",trades:"/api/analytics/trades"},admin:{users:"/api/admin/users",stats:"/api/admin/stats",settings:"/api/admin/settings"},upload:"/api/upload",search:"/api/search",time:{now:"/api/time/now"},timers:{events:"/api/timers/events"}},d={timeout:3e4,retries:3,retryDelay:1e3,headers:{"Content-Type":"application/json",Accept:"application/json"}},i={NETWORK_ERROR:"Network error. Please check your connection.",TIMEOUT_ERROR:"Request timed out. Please try again.",UNAUTHORIZED:"You are not authorized. Please login.",FORBIDDEN:"You do not have permission to access this resource.",NOT_FOUND:"The requested resource was not found.",SERVER_ERROR:"Server error. Please try again later.",VALIDATION_ERROR:"Please check your input and try again."};async function n(e,t={}){const s=t.fetch||(typeof window<"u"?window.fetch:fetch);let p=`${y}${e}`;if(t.params){const o=new URLSearchParams(t.params).toString();p+=`?${o}`}const h=typeof window<"u"?w():null,m={...d.headers,...t.headers};h&&(m.Authorization=`Bearer ${h}`);const E=t.retries??d.retries,g=t.retryDelay??d.retryDelay;let R=null;for(let o=0;o<E;o++)try{const r=new AbortController,l=setTimeout(()=>r.abort(),d.timeout),a=await s(p,{...t,headers:m,signal:r.signal});if(clearTimeout(l),!a.ok){const u=await a.json().catch(()=>({}));throw a.status>=400&&a.status<500&&a.status!==429?new c(u.message||f(a.status),a.status,u):new c(u.message||f(a.status),a.status,u)}return await a.json()}catch(r){if(R=r,r instanceof Error){if(r.name==="AbortError")throw new c(i.TIMEOUT_ERROR,0);if(r instanceof c&&r.status>=400&&r.status<500&&r.status!==429)throw r}o<E-1&&await new Promise(l=>setTimeout(l,g*Math.pow(2,o)))}throw R||new c(i.NETWORK_ERROR,0)}class c extends Error{constructor(t,s,p){super(t),this.status=s,this.data=p,this.name="ApiError"}}function f(e){switch(e){case 401:return i.UNAUTHORIZED;case 403:return i.FORBIDDEN;case 404:return i.NOT_FOUND;case 422:return i.VALIDATION_ERROR;case 500:case 502:case 503:return i.SERVER_ERROR;default:return`API Error: ${e}`}}const _={get:(e,t)=>n(e,t?{method:"GET",params:t}:{method:"GET"}),post:(e,t,s)=>n(e,{method:"POST",...t?{body:JSON.stringify(t)}:{},...s?{params:s}:{}}),put:(e,t,s)=>n(e,{method:"PUT",...t?{body:JSON.stringify(t)}:{},...s?{params:s}:{}}),patch:(e,t,s)=>n(e,{method:"PATCH",...t?{body:JSON.stringify(t)}:{},...s?{params:s}:{}}),delete:(e,t)=>n(e,t?{method:"DELETE",params:t}:{method:"DELETE"})};export{y as A,T as a,_ as b,n as c};
