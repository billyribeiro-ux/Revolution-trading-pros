import{e as a,d as y,a as k,c as F,f as b,k as A}from"../../../../../chunks/vendor-svelte.js";import{P as D,a as R}from"../../../../../chunks/PeriodSelector.js";function S(f,C){f.component(t=>{let{data:r=[],title:g="Cohort Retention",metricType:p="retention",maxPeriods:h=12}=C;function x(e){return e>=80?"bg-green-500":e>=60?"bg-green-400":e>=40?"bg-yellow-400":e>=20?"bg-orange-400":e>0?"bg-red-400":"bg-gray-100"}function o(e){return e>=40?"text-white":"text-gray-700"}function m(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"})}let v=Array.from({length:h},(e,i)=>i),w=v.map(e=>{const i=r.filter(s=>s.periods&&s.periods[e]).map(s=>{const n=s.periods[e];return typeof n=="number"?n:n.retention_rate});return i.length===0?null:i.reduce((s,n)=>s+n,0)/i.length});t.push(`<div class="bg-white rounded-xl border border-gray-200 overflow-hidden"><div class="p-4 border-b border-gray-100"><h3 class="text-lg font-semibold text-gray-900">${a(g)}</h3> <p class="text-sm text-gray-500 mt-1">${a(p==="retention"?"User retention by cohort week":"Revenue by cohort")}</p></div> <div class="overflow-x-auto"><table class="w-full text-sm"><thead><tr class="bg-gray-50"><th class="px-3 py-2 text-left font-medium text-gray-600 sticky left-0 bg-gray-50 z-10">Cohort</th><th class="px-3 py-2 text-center font-medium text-gray-600">Size</th><!--[-->`);const c=y(v);for(let e=0,i=c.length;e<i;e++){let s=c[e];t.push(`<th class="px-2 py-2 text-center font-medium text-gray-600 min-w-[60px]">${a(s===0?"Day 0":`Week ${s}`)}</th>`)}t.push("<!--]--></tr></thead><tbody><!--[-->");const u=y(r);for(let e=0,i=u.length;e<i;e++){let s=u[e];t.push(`<tr class="border-t border-gray-100 hover:bg-gray-50/50"><td class="px-3 py-2 font-medium text-gray-900 sticky left-0 bg-white z-10">${a(m(s.cohort_date))}</td><td class="px-3 py-2 text-center text-gray-600">${a(s.cohort_size.toLocaleString())}</td><!--[-->`);const n=y(v);for(let _=0,z=n.length;_<z;_++){let W=n[_];const d=s.periods?s.periods[W]:null;t.push('<td class="px-1 py-1">'),d&&typeof d=="object"?(t.push("<!--[-->"),p==="retention"?d.retention_rate:d.total_revenue,t.push(`<div${k(`w-full h-8 rounded flex items-center justify-center text-xs font-medium ${b(x(d.retention_rate))} ${b(o(d.retention_rate))}`)}${F("title",p==="retention"?`${d.active_users} users (${d.retention_rate.toFixed(1)}%)`:`$${d.total_revenue.toFixed(0)}`)}>${a(p==="retention"?`${d.retention_rate.toFixed(0)}%`:`$${d.total_revenue.toFixed(0)}`)}</div>`)):(t.push("<!--[!-->"),t.push('<div class="w-full h-8 rounded bg-gray-50"></div>')),t.push("<!--]--></td>")}t.push("<!--]--></tr>")}t.push(`<!--]--><tr class="border-t-2 border-gray-200 bg-gray-50"><td class="px-3 py-2 font-semibold text-gray-900 sticky left-0 bg-gray-50 z-10">Average</td><td class="px-3 py-2 text-center text-gray-600">${a(Math.round(r.reduce((e,i)=>e+(i.cohort_size||i.size||0),0)/r.length).toLocaleString())}</td><!--[-->`);const l=y(w);for(let e=0,i=l.length;e<i;e++){let s=l[e];t.push('<td class="px-1 py-1">'),s!==null?(t.push("<!--[-->"),t.push(`<div${k(`w-full h-8 rounded flex items-center justify-center text-xs font-bold ${b(x(s))} ${b(o(s))}`)}>${a(s.toFixed(0))}%</div>`)):(t.push("<!--[!-->"),t.push('<div class="w-full h-8 rounded bg-gray-100"></div>')),t.push("<!--]--></td>")}t.push('<!--]--></tr></tbody></table></div> <div class="p-4 border-t border-gray-100 flex items-center gap-4 text-xs"><span class="text-gray-500">Retention:</span> <div class="flex items-center gap-2"><div class="flex items-center gap-1"><div class="w-4 h-4 rounded bg-green-500"></div> <span>80%+</span></div> <div class="flex items-center gap-1"><div class="w-4 h-4 rounded bg-green-400"></div> <span>60-80%</span></div> <div class="flex items-center gap-1"><div class="w-4 h-4 rounded bg-yellow-400"></div> <span>40-60%</span></div> <div class="flex items-center gap-1"><div class="w-4 h-4 rounded bg-orange-400"></div> <span>20-40%</span></div> <div class="flex items-center gap-1"><div class="w-4 h-4 rounded bg-red-400"></div> <span>&lt;20%</span></div></div></div></div>')})}function T(f,C){f.component(t=>{let r=[],g=!0,p=null,h="90d",x="weekly",o=null;async function m(){g=!0,p=null;try{r=(await R.getCohorts({period:h,granularity:x})).cohorts||[],r.length>0&&!o&&(o=r[0])}catch(l){p=l instanceof Error?l.message:"Failed to load cohorts"}finally{g=!1}}function v(l){h=l,m()}function w(){m()}const c=o?{avgWeek1:u(o.retention_matrix,0),avgWeek4:u(o.retention_matrix,3),avgWeek8:u(o.retention_matrix,7)}:null;function u(l,e){const i=l.filter(s=>s.periods[e]!==void 0).map(s=>s.periods[e]);return i.length===0?0:i.reduce((s,n)=>s+n,0)/i.length}if(A("1vpcc3i",t,l=>{l.title(e=>{e.push("<title>Cohort Analysis | Analytics</title>")})}),t.push('<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><div class="flex items-center justify-between mb-8"><div><h1 class="text-2xl font-bold text-gray-900">Cohort Analysis</h1> <p class="text-sm text-gray-500 mt-1">Analyze user retention patterns over time</p></div> <div class="flex items-center gap-4">'),D(t,{value:h,onchange:v}),t.push("<!----> "),t.select({value:x,onchange:w,class:"px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"},l=>{l.option({value:"daily"},e=>{e.push("Daily")}),l.option({value:"weekly"},e=>{e.push("Weekly")}),l.option({value:"monthly"},e=>{e.push("Monthly")})}),t.push(' <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium">Create Cohort</button></div></div> '),g)t.push("<!--[-->"),t.push('<div class="flex items-center justify-center py-20"><div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div></div>');else{if(t.push("<!--[!-->"),p)t.push("<!--[-->"),t.push(`<div class="bg-red-50 border border-red-200 rounded-xl p-6 text-center"><p class="text-red-600">${a(p)}</p> <button class="mt-4 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">Retry</button></div>`);else{if(t.push("<!--[!-->"),r.length===0)t.push("<!--[-->"),t.push('<div class="bg-white rounded-xl border border-gray-200 p-12 text-center"><div class="text-4xl mb-4">ðŸ‘¥</div> <h3 class="text-lg font-medium text-gray-900 mb-2">No Cohorts Yet</h3> <p class="text-gray-500 mb-6">Create your first cohort to analyze user retention</p> <button class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 inline-block">Create Your First Cohort</button></div>');else{t.push("<!--[!-->"),t.push('<div class="flex gap-2 mb-8 overflow-x-auto pb-2"><!--[-->');const l=y(r);for(let e=0,i=l.length;e<i;e++){let s=l[e];t.push(`<button${k(`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap transition-all ${b(o?.key===s.key?"bg-blue-600 text-white":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50")}`)}>${a(s.name)}</button>`)}t.push("<!--]--></div> "),o?(t.push("<!--[-->"),c?(t.push("<!--[-->"),t.push(`<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"><div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">${a("Week 1")} Retention</div> <div class="text-3xl font-bold text-gray-900">${a(c.avgWeek1.toFixed(1))}%</div></div> <div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">${a("Week 4")} Retention</div> <div class="text-3xl font-bold text-gray-900">${a(c.avgWeek4.toFixed(1))}%</div></div> <div class="bg-white rounded-xl border border-gray-200 p-6"><div class="text-sm text-gray-500 mb-1">${a("Week 8")} Retention</div> <div class="text-3xl font-bold text-gray-900">${a(c.avgWeek8.toFixed(1))}%</div></div></div>`)):t.push("<!--[!-->"),t.push("<!--]--> "),S(t,{data:o.retention_matrix,title:o.name}),t.push(`<!----> <div class="mt-8 bg-white rounded-xl border border-gray-200 p-6"><h3 class="text-lg font-semibold text-gray-900 mb-4">Cohort Details</h3> <div class="grid grid-cols-2 md:grid-cols-4 gap-6"><div><div class="text-xs font-medium text-gray-400 uppercase mb-1">Type</div> <div class="text-sm text-gray-900 capitalize">${a(o.type.replace("_"," "))}</div></div> <div><div class="text-xs font-medium text-gray-400 uppercase mb-1">Granularity</div> <div class="text-sm text-gray-900 capitalize">${a(o.granularity)}</div></div> <div><div class="text-xs font-medium text-gray-400 uppercase mb-1">Total Cohorts</div> <div class="text-sm text-gray-900">${a(o.retention_matrix.length)}</div></div> <div><div class="text-xs font-medium text-gray-400 uppercase mb-1">Total Users</div> <div class="text-sm text-gray-900">${a(o.retention_matrix.reduce((e,i)=>e+i.size,0).toLocaleString())}</div></div></div> `),o.description?(t.push("<!--[-->"),t.push(`<div class="mt-4 pt-4 border-t border-gray-100"><div class="text-xs font-medium text-gray-400 uppercase mb-1">Description</div> <p class="text-sm text-gray-600">${a(o.description)}</p></div>`)):t.push("<!--[!-->"),t.push("<!--]--></div>")):t.push("<!--[!-->"),t.push("<!--]-->")}t.push("<!--]-->")}t.push("<!--]-->")}t.push("<!--]--></div> "),t.push("<!--[!-->"),t.push("<!--]-->")})}export{T as default};
