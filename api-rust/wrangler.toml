# Revolution Trading Pros - Cloudflare Workers Configuration
# Ultimate Backend - December 2025

name = "revolution-trading-pros-api"
main = "build/worker/shim.mjs"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

[build]
command = "cargo install -q worker-build && worker-build --release"

[vars]
ENVIRONMENT = "production"
JWT_ISSUER = "revolution-trading-pros"
JWT_AUDIENCE = "revolution-trading-pros-api"

# Secrets (set via wrangler secret put):
# - DATABASE_URL (Neon PostgreSQL)
# - REDIS_URL (Upstash)
# - JWT_SECRET
# - STRIPE_SECRET_KEY
# - STRIPE_WEBHOOK_SECRET
# - POSTMARK_API_KEY
# - MEILISEARCH_URL
# - MEILISEARCH_API_KEY
# - R2_ACCESS_KEY_ID
# - R2_SECRET_ACCESS_KEY

# R2 Storage Binding
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "revolution-trading-media"

# KV Namespace for caching
[[kv_namespaces]]
binding = "CACHE"
id = "revolution-cache"

# D1 Database (optional, for edge-native SQL)
# [[d1_databases]]
# binding = "DB"
# database_name = "revolution-db"
# database_id = "xxx"

[env.preview]
[env.preview.vars]
ENVIRONMENT = "preview"

[env.production]
[env.production.vars]
ENVIRONMENT = "production"
